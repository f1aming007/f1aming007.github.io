[{"categories":["æ–‡æ¡£"],"content":"Kubernetes çš„ Limits å’Œ Requests åœ¨k8sé€‚åº”å®¹å™¨æ—¶ï¼Œ è¦çŸ¥é“æ‰€æ¶‰åŠçš„èµ„æºæ—¶ä»€ä¹ˆä»¥åŠå¦‚ä½•éœ€è¦ä»–ä»¬ï¼Œæœ‰äº›è¿›ç¨‹æ¯”å…¶ä»–è¿›ç¨‹éœ€è¦æ›´å¤šçš„CPUå’Œå†…å­˜ çŸ¥é“è¿™äº›ä¹‹åï¼Œ æ‰èƒ½æ­£ç¡®çš„é…ç½®æˆ‘ä»¬çš„å®¹å™¨å’Œpod Kubernetes çš„Limitså’ŒRequestsä»‹ç» å®è·µæ¡ˆä¾‹ Kubernetes Requests Kubernetes Limits CPUçš„ç‰¹æ®Šæ€§ å†…å­˜çš„ç‰¹æ®Šæ€§ Namespace ResourceQuta Namespace LimitRange æ€»ç»“ ","date":"2023-10-24","objectID":"/k8s_limit_quests/:0:0","tags":["k8s"],"title":"K8s_limit_quests","uri":"/k8s_limit_quests/"},{"categories":["æ–‡æ¡£"],"content":"Jsonparser å¼€æºçš„JSONåŒ… å·ç§°æ¯”JSONåŒ…æ€§èƒ½é«˜10å€ï¼Œå†…å­˜åˆ†é…ä¼˜åŒ–åˆ°0ï¼Œæé«˜JSONæ“ä½œçš„æ€§èƒ½ jsonparser çš„æ€§èƒ½åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºä½¿ç”¨æƒ…å†µï¼Œå½“ä¸éœ€è¦å¤„ç†å®Œæˆè®°å½•è€Œåªéœ€è¦å¤„ç†æŸå‡ ä¸ªå­—æ®µæ—¶ï¼ˆå°¤å…¶æ˜¯è®¿é—®ç¬¬ä¸‰æ–¹æ¥å£æ—¶ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹åªéœ€è¦å‡ ä¸ªå­—æ®µï¼‰æ€§èƒ½è¡¨ç°çš„éå¸¸å¥½ ","date":"2023-08-11","objectID":"/golang-jsonparser/:0:0","tags":["golang","goç¬¬ä¸‰æ–¹åº“"],"title":"Golang Jsonparser","uri":"/golang-jsonparser/"},{"categories":["æ–‡æ¡£"],"content":"æ–¹æ³•å¯¹åº”å…³ç³» jsonparseræ ‡å‡†åº“JSONå·¥ä½œæ–¹å¼ä¸åŒï¼Œä¸ä¼š ç¼–ç /è§£ç  æ•´ä¸ªæ•°æ®ç»“æ„ï¼Œ è€Œæ˜¯æŒ‰éœ€æ“ä½œ æ ‡å‡†åº“ jsonparser ç¼–ç  Marshal Set è§£ç  Unmarshal Get jsonparser åœ¨Get çš„åŸºç¡€ä¸Šå°è£…äº†å¾ˆå¤šé’ˆå¯¹å•ä¸ªå­—æ®µçš„ä½¿ç”¨æ–¹æ³•ï¼Œä¾‹å¦‚ package main import ( \"fmt\" \"log\" \"github.com/buger/jsonparser\" ) var ( // JSON å­—ç¬¦ä¸² dataJson = []byte(` { \"person\": { \"name\": { \"first\": \"Leonid\", \"last\": \"Bugaev\", \"fullName\": \"Leonid Bugaev\" }, \"github\": { \"handle\": \"buger\", \"followers\": 109 }, \"avatars\": [ { \"url\": \"https://avatars1.githubusercontent.com/u/14009?v=3\u0026s=460\", \"type\": \"thumbnail\" } ] }, \"company\": { \"name\": \"Acme\" } } `) ) func main() { // è§£æå¯¹è±¡ github := struct { Handle string `json:\"handle\"` Followers int `json:\"followers\"` }{} err := jsonparser.ObjectEach(dataJson, func(key []byte, value []byte, dataType jsonparser.ValueType, offset int) error { switch string(key) { case \"handle\": github.Handle = string(value) case \"followers\": followers, _ := jsonparser.ParseInt(value) github.Followers = int(followers) } return nil }, \"person\", \"github\") if err != nil { log.Fatal(err) } fmt.Printf(\"github = %+v\\n\\n\", github) // ç¼–ç ç»“æ„ä½“ githubJson, err := jsonparser.Set([]byte(`{}`), []byte(fmt.Sprintf(`{\"handle: %s\", \"followers\": \"%d\"}`, github.Handle, github.Followers)), \"github\") if err != nil { log.Fatal(err) } fmt.Printf(\"github json = %s\\n\\n\", githubJson) // è§£æå¤šä¸ª key paths := [][]string{ {\"person\", \"name\", \"fullName\"}, {\"person\", \"avatars\", \"[0]\", \"url\"}, {\"company\", \"name\"}, } jsonparser.EachKey(dataJson, func(i int, bytes []byte, valueType jsonparser.ValueType, err error) { switch i { case 0: fmt.Printf(\"fullName = %s\\n\", bytes) case 1: fmt.Printf(\"avatars[0].url = %s\\n\", bytes) case 2: fmt.Printf(\"company.name = %s\\n\\n\", bytes) } }, paths...) // è§£ææ•´æ•° n, err := jsonparser.GetInt(dataJson, \"person\", \"github\", \"followers\") if err != nil { log.Fatal(err) } fmt.Printf(\"n = %d\\n\\n\", n) // è§£æå­—ç¬¦ä¸² name, err := jsonparser.GetString(dataJson, \"company\", \"name\") if err != nil { log.Fatal(err) } fmt.Printf(\"name = %s\\n\", name) } ","date":"2023-08-11","objectID":"/golang-jsonparser/:1:0","tags":["golang","goç¬¬ä¸‰æ–¹åº“"],"title":"Golang Jsonparser","uri":"/golang-jsonparser/"},{"categories":["æ–‡æ¡£"],"content":"ä»£ç å®ç° jsonparser çš„æ ¸å¿ƒä»£ç å…¨éƒ¨æ”¾åœ¨äº†ä¸€ä¸ªæ–‡ä»¶ä¸­ parser.go, æˆ‘ä»¬ä¸»è¦å…³æ³¨ä¸¤ç§æ“ä½œçš„å®ç°: è§£ç GET å’Œ ç¼–ç Set ","date":"2023-08-11","objectID":"/golang-jsonparser/:2:0","tags":["golang","goç¬¬ä¸‰æ–¹åº“"],"title":"Golang Jsonparser","uri":"/golang-jsonparser/"},{"categories":["æ–‡æ¡£"],"content":"æ•°æ®ç±»å‹ jsonparser å°†åˆæ³•çš„JSONæ•°æ®ç±»å‹ç®€å•è¿›è¡Œå¸¸é‡æ˜ å°„ // JSON æ•°æ®ç±»å‹å¸¸é‡ type ValueType int const ( NotExist = ValueType(iota) String Number Object Array Boolean Null Unknown ) ä¸ºäº†è§„é¿ GC, ç”¨äº JSON å­—ç¬¦ä¸²è½¬ä¹‰åˆ†é…çš„ []byte åˆ‡ç‰‡å®¹é‡ä¸Šé™ï¼Œè¶…è¿‡è¿™ä¸ªä¸Šé™å€¼åï¼Œè½¬ä¹‰ç»“æœä¼šè¢«åˆ†é…åˆ° å †ä¸Š å¼•å‘ GCï¼Œ ä¹Ÿå°±æ˜¯ []byte åˆ‡ç‰‡çš„é•¿åº¦è¶…è¿‡ 64 ä¹‹åï¼Œä¼šè¢«åˆ†é…åˆ° å †ä¸Š // è§„é¿ GC çš„åˆ‡ç‰‡å®¹é‡ä¸Šé™å¸¸é‡ const unescapeStackBufSize = 64 ","date":"2023-08-11","objectID":"/golang-jsonparser/:2:1","tags":["golang","goç¬¬ä¸‰æ–¹åº“"],"title":"Golang Jsonparser","uri":"/golang-jsonparser/"},{"categories":["æ–‡æ¡£"],"content":"è¾…åŠ©æ–¹æ³• stringEnd å°è¯•å¯»æ‰¾å½“å‰å­—ç¬¦ä¸²çš„ç»“å°¾ï¼Œä¹Ÿå°±æ˜¯ â€œ, æ”¯æŒè½¬ä¹‰çš„æƒ…å†µï¼Œä¾‹å¦‚ \" func stringEnd(data []byte) (int, bool) {} blockEnd å°è¯•å¯»æ‰¾å½“å‰æ•°ç»„æˆ–å¯¹è±¡çš„ç»“å°¾ï¼Œæ•°ç»„çš„å¼€å§‹å’Œç»“å°¾è¡¨ç¤ºä¸º [ å’Œ ], å¯¹è±¡çš„å¼€å§‹å’Œç»“å°¾è¡¨ç¤ºä¸º { å’Œ }ã€‚ func blockEnd(data []byte, openSym byte, closeSym byte) int {} ","date":"2023-08-11","objectID":"/golang-jsonparser/:3:0","tags":["golang","goç¬¬ä¸‰æ–¹åº“"],"title":"Golang Jsonparser","uri":"/golang-jsonparser/"},{"categories":["æ–‡æ¡£"],"content":"searchKeys çŠ¶æ€æœº searchKeys æ–¹æ³•æ˜¯æ•´ä¸ª è§£ææ“ä½œ çš„æ ¸å¿ƒæ–¹æ³•ï¼Œå†…éƒ¨å®ç°ç±»ä¼¼äº æœ‰é™çŠ¶æ€æœº æœºåˆ¶ï¼Œé€šè¿‡å°† JSON å­—ç¬¦ä¸²ä½œä¸ºè¾“å…¥å‚æ•°ï¼Œå¹¶æ ¹æ®å®šä¹‰çš„çŠ¶æ€è½¬æ¢è§„åˆ™é€ä¸ªè§£æå­—ç¬¦ï¼Œ ç»“æœè¿”å›è§£æåˆ°çš„ç´¢å¼•ï¼Œæˆ–è€… -1 (è§£æå¤±è´¥)ã€‚ ","date":"2023-08-11","objectID":"/golang-jsonparser/:4:0","tags":["golang","goç¬¬ä¸‰æ–¹åº“"],"title":"Golang Jsonparser","uri":"/golang-jsonparser/"},{"categories":["æ–‡æ¡£"],"content":"çŠ¶æ€æœºç»„æˆéƒ¨åˆ† è¾“å…¥å‚æ•°ï¼š å­˜å‚¨è§£æçš„JSONå­—ç¬¦ä¸² è§£æå™¨ï¼š è§£æ JSON å­—ç¬¦ä¸²å¹¶è¿”å›ç›¸åº”çš„æ•°æ®ç»“æ„ (searchKeys æ–¹æ³•è¿”å›çš„æ˜¯ []byte) çŠ¶æ€è½¬ç§»è¡¨ï¼š å®šä¹‰çŠ¶æ€è½¬æ¢è§„åˆ™ï¼ŒåŒ…æ‹¬å½“å‰çŠ¶æ€ã€ä¸‹ä¸€ä¸ªå­—ç¬¦ä»¥åŠä¸‹ä¸€ä¸ªçŠ¶æ€ (searchKeys ä¸»è¦æ˜¯é€šè¿‡ä¸Šé¢æåˆ°çš„è¾…åŠ©æ–¹æ³•æ¥å®Œæˆçš„) çŠ¶æ€æ ˆ : è®°å½•çŠ¶æ€è½¬æ¢è¿‡ç¨‹ä¸­çš„çŠ¶æ€ (searchKeys ç”¨äº†å‡ ä¸ªå˜é‡æ¥è®°å½•çŠ¶æ€ï¼Œä¾‹å¦‚ keyLevel, level, ln, lk ç­‰) ","date":"2023-08-11","objectID":"/golang-jsonparser/:4:1","tags":["golang","goç¬¬ä¸‰æ–¹åº“"],"title":"Golang Jsonparser","uri":"/golang-jsonparser/"},{"categories":["æ–‡æ¡£"],"content":"å•ä¾‹æ¨¡å¼ å•ä¾‹æ¨¡å¼å®è§‚ä»‹ç» é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼å®ç°æ€è·¯ æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼å®ç°æ¨æ¼” Golang å•ä¾‹å·¥å…· sync.Once æºç è§£æ å•ä¾‹æ¨¡å¼èƒŒæ™¯ åœ¨å•ä¾‹æ¨¡å¼ä¸‹ï¼Œ å£°æ˜ä¸€ä¸ªç±»å¹¶ä¿è¯è¿™ä¸ªç±»åªå­˜åœ¨å…¨å±€å”¯ä¸€çš„å®ä¾‹ä¾›å¤–éƒ¨åå¤ä½¿ç”¨ å•ä¾‹æ¨¡å¼çš„é€‚ç”¨åœºæ™¯ ä¸€äº›åªå…è®¸å­˜åœ¨ä¸€ä¸ªå®ä¾‹çš„ç±»ï¼Œæ¯”å¦‚å…¨å±€ç»Ÿä¸€çš„ç›‘æ§ç»Ÿè®¡æ¨¡å—ã€‚ ä¸€äº›å®ä¾‹åŒ–å¾ˆè€—è´¹èµ„æºçš„ç±»ï¼Œæ¯”å¦‚åç¨‹æ± ã€è¿æ¥æ± ã€å’Œç¬¬ä¸‰æ–¹äº¤äº’çš„å®¢æˆ·ç«¯ç­‰ ä¸€äº›å…¥å‚å¤æ‚çš„ç³»ç»Ÿæ¨¡å—ç»„ä»¶ï¼Œæ¯”å¦‚ controllerã€serviceã€daoç­‰ ","date":"2023-08-05","objectID":"/golang-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/:0:0","tags":["golang"],"title":"Golang è®¾è®¡æ¨¡å¼ å•ä¾‹æ¨¡å¼","uri":"/golang-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/"},{"categories":["æ–‡æ¡£"],"content":"å®ç°æ¨¡å¼ åœ¨å•ä¾‹æ¨¡å¼çš„å®ç°ä¸Šï¼Œ å¯ä»¥åˆ†ä¸ºé¥¿æ±‰å¼å’Œæ‡’æ±‰å¼ä¸¤ç§ç±»å‹ é¥¿æ±‰å¼ï¼š ä»ä¸€å¼€å§‹å°±å®Œæˆå•ä¾‹çš„åˆå§‹åŒ–å·¥ä½œï¼Œ ä»¥å¤‡ä¸æ—¶åªéœ€ æ‡’æ±‰å¼ï¼š è´¯å½»ä½›ç³»æ€æƒ³ï¼Œä¸åˆ°é€¼ä¸å¾—å·²ï¼ˆéœ€è¦è¢«ä½¿ç”¨äº†ï¼‰ï¼Œä¸æ‰§è¡Œå•ä¾‹çš„åˆå§‹åŒ–å·¥ä½œ ","date":"2023-08-05","objectID":"/golang-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/:1:0","tags":["golang"],"title":"Golang è®¾è®¡æ¨¡å¼ å•ä¾‹æ¨¡å¼","uri":"/golang-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/"},{"categories":["æ–‡æ¡£"],"content":"é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼ â€œé¥¿â€ æŒ‡çš„æ˜¯ï¼Œå¯¹äºå•ä¾‹å¯¹è±¡è€Œè¨€ï¼Œä¸è®ºå…¶åç»­æœ‰æ²¡æœ‰è¢«ä½¿ç”¨åˆ°ä»¥åŠä½•æ—¶æ‰ä¼šè¢«ä½¿ç”¨åˆ°ï¼Œéƒ½ä¼šåœ¨ç¨‹åºå¯åŠ¨ä¹‹åˆå®Œæˆå…¶åˆå§‹åŒ–å·¥ä½œ. é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼çš„æ‰§è¡Œæ­¥éª¤ å•ä¾‹ç±»å’Œæ„å»ºæ–¹æ³•å£°æ˜ä¸ºä¸å¯å¯¼å‡ºç±»å‹ï¼Œé¿å…è¢«å¤–éƒ¨ç›´æ¥è·å–åˆ° åœ¨ä»£ç å¯åŠ¨ä¹‹åˆï¼Œé…’åˆå§‹åŒ–ä¸€ä¸ªå…¨å±€å•ä¸€çš„å®ä¾‹ï¼Œ ä½œä¸ºåç»­æ‰€è°“çš„â€œå•ä¾‹â€ æš´éœ²ä¸€ä¸ªå¯å€’å‡ºçš„å•ä¾‹è·å–æ–¹æ³•ï¼ŒGetXXX()ï¼Œç”¨äºè¿”å›è¿™ä¸ªå•ä¾‹å¯¹è±¡ ","date":"2023-08-05","objectID":"/golang-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/:2:0","tags":["golang"],"title":"Golang è®¾è®¡æ¨¡å¼ å•ä¾‹æ¨¡å¼","uri":"/golang-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/"},{"categories":["æ–‡æ¡£"],"content":"Iota ä»‹ç» åœ¨å¸¸é‡å£°æ˜ä¸­ï¼Œé¢„å…ˆå£°æ˜çš„æ ‡è¯†ç¬¦iotaä»£è¡¨è¿ç»­çš„æ— ç±»å‹çš„æ•´æ•°å¸¸é‡ï¼Œ ä»–çš„å€¼æ˜¯è¯¥å¸¸é‡å£°æ˜ä¸­å¯¹åº”ConstSpecçš„ç´¢å¼•ï¼Œä»é›¶å¼€å§‹è®¡æ•°ã€‚ iotaï¼š å¯ä»¥åœ¨å¸¸é‡å£°æ˜ä¸­è‡ªåŠ¨åˆ›å»ºä¸€ç³»åˆ—è¿ç»­çš„æ•´æ•°å€¼ï¼Œå€¼ä»é›¶å¼€å§‹ï¼Œ ä¸éœ€è¦æ‰‹åŠ¨æŒ‡å®šæ¯ä¸ªå¸¸é‡çš„å€¼ ","date":"2023-08-05","objectID":"/golang-iota/:0:0","tags":["golang"],"title":"Golang Iota","uri":"/golang-iota/"},{"categories":["æ–‡æ¡£"],"content":"iotaçš„åº”ç”¨åœºæ™¯ ","date":"2023-08-05","objectID":"/golang-iota/:1:0","tags":["golang"],"title":"Golang Iota","uri":"/golang-iota/"},{"categories":["æ–‡æ¡£"],"content":"è‡ªåŠ¨ç”Ÿæˆé€’å¢çš„å¸¸é‡å€¼ iota å¯ä»¥æ–¹ä¾¿ç”Ÿæˆé€’å¢çš„å¸¸é‡å€¼ï¼Œ åœ¨å¸¸é‡å£°æ˜ä¸­çš„ç¬¬ä¸€ä¸ªä½¿ç”¨iotaçš„å¸¸é‡åˆå§‹åŒ–æœª0ï¼Œ è€Œåçš„å¸¸é‡éƒ½ä¼šè‡ªåŠ¨é€’å¢ï¼Œè¿™æ˜¯å¾—åœ¨å®šä¹‰ä¸€ç»„é€’å¢å¸¸é‡æ—¶æ— éœ€æ‰‹åŠ¨æŒ‡å®šæ¯ä¸ªå¸¸é‡çš„å€¼ï¼Œ æé«˜äº†ä»£ç çš„ å¯è¯»æ€§å’Œç»´æŠ¤æ€§ const ( Apple = iota // 0 Banana // 1 Cherry // 2 ) ","date":"2023-08-05","objectID":"/golang-iota/:1:1","tags":["golang"],"title":"Golang Iota","uri":"/golang-iota/"},{"categories":["æ–‡æ¡£"],"content":"æ„å»ºæšä¸¾ç±»å‹å¸¸é‡ ä½¿ç”¨iota å¯ä»¥è½»æ¾å®šä¹‰ä¸€ç³»åˆ—ç›¸å…³çš„æšä¸¾å€¼ï¼Œ è€Œæ— éœ€ä¸ºæ¯ä¸ªå€¼æ‰‹åŠ¨æŒ‡å®šå…·ä½“çš„æ•°å­—ï¼Œè¿™æ ·çš„æšä¸¾ç±»å‹å®šä¹‰æ›´åŠ ç®€æ´ï¼Œæ˜“äºæ‰©å±•å’Œä¿®æ”¹ type WeekDay int const ( Sunday WeekDay = iota // 0 Tuesday // 1 Wednesday // 2 Thursday // 3 Friday // 4 Saturday // 5 Monday // 6 ) ","date":"2023-08-05","objectID":"/golang-iota/:1:2","tags":["golang"],"title":"Golang Iota","uri":"/golang-iota/"},{"categories":["æ–‡æ¡£"],"content":"è¡¨è¾¾å¼è®¡ç®— é€šè¿‡åœ¨å¸¸é‡å£°æ˜ä¸­ä½¿ç”¨iotaï¼Œ å¯ä»¥åˆ›å»ºå¤æ‚çš„è¡¨è¾¾å¼ï¼Œ å¹¶åœ¨æ¯ä¸ªå¸¸é‡è¡¨è¾¾å¼ä¸­ï¼Œ æ ¹æ®éœ€è¦è°ƒæ•´iotaçš„å€¼ï¼Œ å¯ä»¥è½»æ¾ç”Ÿæˆä¸€ç»„å…·æœ‰ç‰¹å®šè§„å¾‹çš„å¸¸é‡ const ( _ = iota KB = 1 \u003c\u003c (10 * iota) // 1 \u003c\u003c (10 * 1) = 1024B = 1KB MB = 1 \u003c\u003c (10 * iota) // 1 \u003c\u003c (10 * 2) = 1048576B = 1MB GB = 1 \u003c\u003c (10 * iota) // 1 \u003c\u003c (10 * 3) = 1073741824B = 1GB TB = 1 \u003c\u003c (10 * iota) // 1 \u003c\u003c (10 * 4) = 1099511627776B = 1TB ) ","date":"2023-08-05","objectID":"/golang-iota/:1:3","tags":["golang"],"title":"Golang Iota","uri":"/golang-iota/"},{"categories":["æ–‡æ¡£"],"content":"ä½è¿ç®— é€šè¿‡å·¦ç§»è¿ç®—ç¬¦ ï¼ˆÂ«ï¼‰ä¸iotaé…åˆä½¿ç”¨ï¼Œæ–¹ä¾¿åœ°ç”Ÿæˆä¸€ç»„æŒ‰ä½è¿ç®—çš„å¸¸é‡ const ( FlagNone = 0 // 0 FlagRead = 1 \u003c\u003c iota // 1 FlagWrite // 2 FlagExec // 4 ) ","date":"2023-08-05","objectID":"/golang-iota/:1:4","tags":["golang"],"title":"Golang Iota","uri":"/golang-iota/"},{"categories":["æ–‡æ¡£"],"content":"Iota çš„ä½¿ç”¨æŠ€å·§å’Œæ³¨æ„äº‹é¡¹ ","date":"2023-08-05","objectID":"/golang-iota/:2:0","tags":["golang"],"title":"Golang Iota","uri":"/golang-iota/"},{"categories":["æ–‡æ¡£"],"content":"è·³å€¼ä½¿ç”¨ ä½¿ç”¨_ä¸‹åˆ’çº¿æ¥å¿½ç•¥æŸäº›å€¼ï¼Œ const ( Apple = iota // 0 _ Banana // 2 ) ","date":"2023-08-05","objectID":"/golang-iota/:2:1","tags":["golang"],"title":"Golang Iota","uri":"/golang-iota/"},{"categories":["æ–‡æ¡£"],"content":"ä¸åŒå¸¸é‡å—ï¼Œiotaæ˜¯ç‹¬ç«‹çš„ iota çš„ä½œç”¨èŒƒå›´æ˜¯æ•´ä¸ªå¸¸é‡å—ï¼Œ ä¸åŒå¸¸é‡å—çš„iotaæ˜¯ç‹¬ç«‹çš„ï¼Œ æ¯ä¸ªå¸¸é‡å—ä¸­ç¬¬ä¸€ä¸ªiotaçš„å€¼éƒ½æ˜¯0 const ( A = iota // 0 B // 1 ) const ( C = iota // 0 D // 1 ) ","date":"2023-08-05","objectID":"/golang-iota/:2:2","tags":["golang"],"title":"Golang Iota","uri":"/golang-iota/"},{"categories":["æ–‡æ¡£"],"content":"Redfish Api Redfish åˆ©ç”¨å¸¸è§çš„äº’è”ç½‘å’Œweb æœåŠ¡æ ‡å‡†å°†ä¿¡æ¯ç›´æ¥æä¾›ç»™ç›¸å…³çš„å·¥å…·é“¾ IPMI æ˜¯ä¸€ç§è¾ƒæ—©çš„å¸¦å¤–ç®¡ç†ç®¡ç†å·¥å…·ï¼Œä»…é™æœ€å°å…¬å…±é›†å‘½ä»¤é›†ï¼ˆå¼€æœº/å…³æœº/é‡å¯/æ¸©åº¦å€¼/æ–‡æœ¬æ§åˆ¶å°ï¼‰è¿˜æ˜¯éœ€è¦å¸¦å†…ç®¡ç†è½¯ä»¶ å½“ç®¡æ§è®¾å¤‡å¤šçš„æ—¶å€™ï¼Œ éœ€è¦ç»Ÿä¸€ç®¡ç†ï¼Œ éœ€è¦å¯¹æ¥ä¸åŒä¾›åº”å•†çš„APIï¼Œ åŸºç¡€çš„IMPIåŠŸèƒ½ä¸å¥½æ»¡è¶³æ¨ªå‘æ‰©å±•ç¯å¢ƒï¼Œéœ€è¦æ›´ä¾¿æ·çš„æ–¹å¼è°ƒç”¨æœåŠ¡å™¨é«˜çº§ç®¡ç†åŠŸèƒ½æ–°çš„éœ€æ±‚ Redfishå¯æ‰©å±•å¹³å°ç®¡ç†APIæ˜¯ä¸€ç§æ–°çš„è§„èŒƒï¼Œä½¿ç”¨RESTfulè¯­å¥æ¥è®¿é—®å®šä¹‰åœ¨æ¨¡å‹æ ¼å¼çš„æ•°æ®ï¼Œç”¨äºæ‰§è¡Œå¸¦å¤–ç³»ç»Ÿç®¡ç† ","date":"2023-07-08","objectID":"/redfish-api/:0:0","tags":["redfish-api"],"title":"Redfish Api","uri":"/redfish-api/"},{"categories":["æ–‡æ¡£"],"content":"Redfishåº”ç”¨åœºæ™¯ ç”¨æˆ·æœŸæœ›èƒ½å¤Ÿæ‰¹é‡ç®¡ç†æœåŠ¡å™¨ï¼Œæ¯”å¦‚ç¬”è€…æƒ³ä¸€æ¬¡æ€§ç»™100ä¸ªæœåŠ¡å™¨å®‰è£…ç³»ç»Ÿï¼Œå¹¶ä¸”è¿™100ä¸ªæœåŠ¡å™¨å¹¶ä¸éƒ½æ˜¯åŒä¸€å‚å•†ï¼Œä¸åŒå‚å•†çš„IPMIæ“ä½œéƒ½ä¸ä¸€æ ·ï¼Œæ¯”å¦‚Dellæ˜¯iDRACï¼Œä½ è¿˜éœ€è¦ä¸“é—¨å­¦ä¹ iDRACä½¿ç”¨å’Œå„ç§å¯¹æ¥ï¼Œè¿™ä¼šå¸¦æ¥å¾ˆå¤šå›°æ‰°ã€‚è€ŒRedfishæ ‡å‡†çš„å‡ºç°å½»åº•æ”¹å˜è¿™ç§æƒ…å†µï¼Œå®ƒæ˜¯å‡Œé©¾äºæ‰€æœ‰æœåŠ¡å™¨ä¹‹ä¸Šçš„ä¸€ä¸ªæ ‡å‡†ï¼Œå¯¹æœåŠ¡å™¨çš„åŸºæœ¬æ“ä½œéƒ½æ˜¯ç»Ÿä¸€çš„ï¼Œå¹¶ä¸”æ˜¯åŸºäºRestful APIçš„æ–¹å¼å®ç° ","date":"2023-07-08","objectID":"/redfish-api/:1:0","tags":["redfish-api"],"title":"Redfish Api","uri":"/redfish-api/"},{"categories":["æ–‡æ¡£"],"content":"é€‰æ‹©RESTã€HTTPä»¥åŠJSON é™¤äº†RESTã€HTTPå’ŒJSONä¹‹å¤–ï¼ŒRedfishè¿˜é‡‡ç”¨å¸¸è§çš„OData v4çº¦å®šæ¥æè¿°æ¨¡å¼ã€URLçº¦å®šå’Œå‘½åï¼Œä»¥åŠJSONæœ‰æ•ˆè´Ÿè½½ä¸­å¸¸è§å±æ€§çš„ç»“æ„ã€‚è¶Šæ¥è¶Šå¤šçš„é€šç”¨å®¢æˆ·ç«¯åº“ã€åº”ç”¨ç¨‹åºå’Œå·¥å…·ç”Ÿæ€ç³»ç»Ÿä½¿ç”¨Redfishã€‚ å®ƒæœ‰å¤šç®€å•?ä¸‹é¢æ˜¾ç¤ºäº†ä½¿ç”¨Redfishä»æœåŠ¡å™¨æ£€ç´¢åºåˆ—å·çš„ç¤ºä¾‹Pythonä»£ç ï¼šæ­¤ç¤ºä¾‹ä¸­çš„è¾“å‡ºå¦‚ä¸‹æ‰€ç¤º awData= urllib.urlopen(â€˜http://192.168.1.135/redfish/v1/Systems/1â€™) jsonData=json.loads(rawData) print(jsonData[â€˜SerialNumberâ€™]) 1A87CA442K ","date":"2023-07-08","objectID":"/redfish-api/:2:0","tags":["redfish-api"],"title":"Redfish Api","uri":"/redfish-api/"},{"categories":["æ–‡æ¡£"],"content":"golang çš„SDK https://github.com/Nordix/go-redfish å°è£…å®¢æˆ·ç«¯ cfg := \u0026redfish.Configuration{ BasePath: \"http://localhost:8000\", DefaultHeader: make(map[string]string), UserAgent: \"go-redfish/client\", } redfishApi := redfish.NewAPIClient(cfg).DefaultApi åˆ—å‡ºå¯ç”¨çš„è®¡ç®—æœºç³»ç»Ÿ sl, _, _ := redfishApi.ListSystems(context.Background()) é‡ç½®è®¡ç®—æœºç³»ç»Ÿ system_id := \"dd9fd064-263b-469c-91d4-d45f341fe2c5\" systemReq := redfish.ComputerSystem{ResetType: \"ForceRestart\"} reset_resp, _, _ = redfishApi.ResetSystem(context.Background(), system_id, reset_type) ç»™è®¡ç®—å™¨æ’å…¥è™šæ‹Ÿåª’ä½“ manager_id := \"58893887-8974-2487-2389-841168418919\" insertReq := redfish.InsertMediaRequestBody{} insertReq.Image = \"http://releases.ubuntu.com/19.04/ubuntu-19.04-live-server-amd64.iso\" insertReq.Inserted = true redfishApi.InsertVirtualMedia(context.Background(), manager_id, \"Cd\", insertReq) ä¸ºä¸‹æ¬¡å¯åŠ¨è®¾ç½®å¯åŠ¨è®¾å¤‡ system_id := \"dd9fd064-263b-469c-91d4-d45f341fe2c5\" systemReq := redfish.ComputerSystem{} systemReq.Boot.BootSourceOverrideTarget = \"Cd\" redfishApi.SetSystem(context.Background(), system_id, systemReq) ","date":"2023-07-08","objectID":"/redfish-api/:3:0","tags":["redfish-api"],"title":"Redfish Api","uri":"/redfish-api/"},{"categories":["æ–‡æ¡£"],"content":"Redfishå®è·µ The python-redfish project Pythonç¯å¢ƒredfishæ¥å£è·å–æ³°å±±æœåŠ¡å™¨å’Œé²²é¹CPUä¿¡æ¯ redfishæ˜¯å½“å‰ä¸»æµçš„æœåŠ¡å™¨ç›‘æ§åè®®ï¼Œé€šè¿‡redfishåè®®å¯ä»¥é€šè¿‡å¸¦å¤–ç®¡ç†é€šé“è·å–æœåŠ¡å™¨çŠ¶æ€å’Œè¯¦ç»†ç¡¬ä»¶ä¿¡æ¯ pip install python-redfish import redfish login_host=\"https://10.93.20.10\" login_account=\"ADMIN\" login_password=\"ADMIN\" REDFISH_OBJ = redfish.redfish_client(base_url=login_host, username=login_account, password=login_password, default_prefix='/redfish/v1') REDFISH_OBJ.login(auth=\"session\") response = REDFISH_OBJ.get(\"/redfish/v1/Systems/1\", None) print(response) REDFISH_OBJ.logout() å‚è€ƒé“¾æ¥ ","date":"2023-07-08","objectID":"/redfish-api/:4:0","tags":["redfish-api"],"title":"Redfish Api","uri":"/redfish-api/"},{"categories":["æ–‡æ¡£"],"content":"Supermicro Redfish ç‰¹ç‚¹ è·å–ç³»ç»Ÿ/æœºç®±ä¿¡æ¯ ç®¡ç†ç”¨æˆ·è´¦å·å’Œæƒé™ BMCé…ç½®ï¼ˆADã€LDAPã€SNMPã€SMTPã€RADIUSã€Fan modeã€Mouse modeã€NTPã€Snooping ç­‰ç­‰ï¼‰ BIOS é…ç½® å¼€æœºé¡ºåºå˜æ›´ RAID å‚¨å­˜è£…ç½®ç®¡ç†ï¼ˆFor Broadcom 3108, 3008, 3216, 3616 \u0026 Marvel SE9230ï¼‰ ç£ç›˜ç®¡ç† è·å– NIC MAC ä¿¡æ¯ï¼ˆNIC èµ„è®¯ï¼‰ BMCï¼BIOSï¼3108éŸ§ä½“æ›´æ–° è·å–æ¸©åº¦ï¼ç”µæºï¼ä¼ æ„Ÿå™¨è®¯æ¯ ","date":"2023-07-08","objectID":"/redfish-api/:5:0","tags":["redfish-api"],"title":"Redfish Api","uri":"/redfish-api/"},{"categories":["æ–‡æ¡£"],"content":" ğŸ”¥ gRpc æ•™ç¨‹- protobuf é€šä¿¡æ¨¡å¼ å››ç§é€šä¿¡æ¨¡å¼ Simple RPC Server-Streaming RPC Client-Streaming RPC Bidirectionnal-Streaming RPC ","date":"2023-07-01","objectID":"/golang-protobuf-messagemode/:0:0","tags":["golang","rpc","protobuf"],"title":"Golang Protobuf MessageMode","uri":"/golang-protobuf-messagemode/"},{"categories":["æ–‡æ¡£"],"content":"Simple RPC syntax = \"proto3\"; package ecommerce; import \"google/protobuf/wrappers.proto\"; option go_package = \"ecommerce/\"; message Order { string id = 1; repeated string items = 2; string description = 3; float price = 4; string destination = 5; } service OrderManagement { rpc getOrder(google.protobuf.StringValue) returns (Order); } æ³¨æ„äº‹é¡¹ ä½¿ç”¨protobufæœ€æ–°ç‰ˆæœ¬syntax = â€œproto3â€; protoc-gen-goè¦æ±‚ pb æ–‡ä»¶å¿…é¡»æŒ‡å®š go åŒ…çš„è·¯å¾„ã€‚å³option go_package = â€œecommerce/â€; å®šä¹‰çš„methodä»…èƒ½æœ‰ä¸€ä¸ªå…¥å‚å’Œå‡ºå‚æ•°ã€‚å¦‚æœéœ€è¦ä¼ é€’å¤šä¸ªå‚æ•°éœ€è¦å®šä¹‰æˆmessage ä½¿ç”¨importå¼•ç”¨å¦å¤–ä¸€ä¸ªæ–‡ä»¶çš„ pbã€‚google/protobuf/wrappers.protoæ˜¯ google å†…ç½®çš„ç±»å‹ ç”Ÿæˆ go å’Œ grpc çš„ä»£ç  $ protoc -I ./pb \\ --go_out ./ecommerce --go_opt paths=source_relative \\ --go-grpc_out ./ecommerce --go-grpc_opt paths=source_relative \\ ./pb/product.proto ","date":"2023-07-01","objectID":"/golang-protobuf-messagemode/:1:0","tags":["golang","rpc","protobuf"],"title":"Golang Protobuf MessageMode","uri":"/golang-protobuf-messagemode/"},{"categories":["æ–‡æ¡£"],"content":"serverå®ç°","date":"2023-07-01","objectID":"/golang-protobuf-messagemode/:1:1","tags":["golang","rpc","protobuf"],"title":"Golang Protobuf MessageMode","uri":"/golang-protobuf-messagemode/"},{"categories":["æ–‡æ¡£"],"content":" ğŸ”¥ gRpc æ•™ç¨‹- protobuf åŸºç¡€ åºåˆ—åŒ–åè®®ï¼š grpc ä½¿ç”¨ protobuf, é¦–å…ˆä½¿ç”¨protobuf å®šä¹‰æœåŠ¡ï¼Œç„¶åä½¿ç”¨è¿™ä¸ªæ–‡ä»¶æ¥ç”Ÿæˆå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„ä»£ç ï¼Œ å› ä¸ºpbæ˜¯è·¨è¯­è¨€çš„ï¼Œ å› æ­¤ä½¿ç”¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯è¯­è¨€å¹¶ä¸ä¸€è‡´ä¹Ÿå¯ä»¥ç›¸äº’åºåˆ—åŒ–å’Œååºåˆ—åŒ– ç½‘ç»œä¼ è¾“å±‚ï¼š grpcä½¿ç”¨çš„æ˜¯http2.0åè®®ï¼Œ ","date":"2023-07-01","objectID":"/golang-protobuf-base/:0:0","tags":["golang","rpc","protobuf"],"title":"Golang Protobuf Base","uri":"/golang-protobuf-base/"},{"categories":["æ–‡æ¡£"],"content":"Protobuf IDL åºåˆ—åŒ–é€šä¿—æ¥è¯´å°±æ˜¯æŠŠå†…å­˜çš„ä¸€æ®µæ•°æ®è½¬åŒ–ä¸ºäºŒè¿›åˆ¶å¹¶å­˜å‚¨æˆ–è€…é€šè¿‡ç½‘ç»œä¼ è¾“ï¼Œ è¯»å–ç£ç›˜æˆ–å¦ä¸€ç«¯æ”¶åˆ°åå¯ä»¥åœ¨å†…å­˜ä¸­é‡å»ºè¿™æ®µæ•°æ® protobuf åè®®æ˜¯è·¨è¯­è¨€è·¨å¹³å°çš„åºåˆ—åŒ–åè®® protobuf æœ¬èº«å¹¶ä¸æ˜¯å’ŒgPRCç»‘å®šçš„ï¼Œ å®ƒå¯ä»¥è¢«ç”¨äºéRPCåœºæ™¯ï¼Œ å¦‚å†…å­˜ç­‰ jsonã€xml éƒ½æ˜¯ä¸€ç§åºåˆ—åŒ–æ–¹å¼ï¼Œ åªæ˜¯ä»–ä»¬ä¸éœ€è¦æå‰é¢„å®šä¹‰ idlï¼Œ ä¸”å…·å¤‡å¯è¯»æ€§ï¼Œ https://protobuf.dev/programming-guides/proto3/ ","date":"2023-07-01","objectID":"/golang-protobuf-base/:1:0","tags":["golang","rpc","protobuf"],"title":"Golang Protobuf Base","uri":"/golang-protobuf-base/"},{"categories":["æ–‡æ¡£"],"content":"å®šä¹‰æ¶ˆæ¯ç±»å‹ protobufé‡Œæœ€åŸºç¡€çš„ç±»å‹å°±æ˜¯ message, æ¯ä¸€ä¸ªmessageéƒ½ä¼šæœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªå­—æ®µï¼ˆfieldï¼‰ï¼Œ å…¶ä¸­å­—æ®µåŒ…å«å¦‚ä¸‹å…ƒç´  ç±»å‹ï¼š ç±»å‹ä¸ä»…å¯ä»¥æ˜¯æ ‡é‡ç±»å‹ï¼ˆintã€stringç­‰ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤åˆç±»å‹ï¼ˆenumç­‰ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–message å­—æ®µåï¼š å­—æ®µåæ¯”è¾ƒæ¨èçš„æ˜¯ä½¿ç”¨ä¸‹åˆ’çº¿/åˆ†éš”åç§° å­—æ®µç¼–å·ï¼š ä¸€ä¸ªmessageå†…æ¯ä¸€ä¸ªå­—æ®µç¼–å·éƒ½å¿…é¡»å”¯ä¸€çš„ï¼Œåœ¨ç¼–ç åå…¶å®ä¼ é€’çš„æ˜¯è¿™ä¸ªç¼–å·è€Œä¸æ˜¯å­—æ®µå å­—æ®µè§„åˆ™ï¼šæ¶ˆæ¯å­—æ®µå¯ä»¥æ˜¯ä»¥ä¸‹å­—æ®µä¹‹ä¸€ singularï¼šæ ¼å¼æ­£ç¡®çš„æ¶ˆæ¯å¯ä»¥æœ‰é›¶ä¸ªæˆ–ä¸€ä¸ªå­—æ®µï¼ˆä½†ä¸èƒ½è¶…è¿‡ä¸€ä¸ªï¼‰ã€‚ä½¿ç”¨ proto3 è¯­æ³•æ—¶ï¼Œå¦‚æœæœªä¸ºç»™å®šå­—æ®µæŒ‡å®šå…¶ä»–å­—æ®µè§„åˆ™ï¼Œåˆ™è¿™æ˜¯é»˜è®¤å­—æ®µè§„åˆ™ optionalï¼šä¸ singular ç›¸åŒï¼Œä¸è¿‡æ‚¨å¯ä»¥æ£€æŸ¥è¯¥å€¼æ˜¯å¦æ˜ç¡®è®¾ç½® repeatedï¼šåœ¨æ ¼å¼æ­£ç¡®çš„æ¶ˆæ¯ä¸­ï¼Œæ­¤å­—æ®µç±»å‹å¯ä»¥é‡å¤é›¶æ¬¡æˆ–å¤šæ¬¡ã€‚ç³»ç»Ÿä¼šä¿ç•™é‡å¤å€¼çš„é¡ºåº mapï¼šè¿™æ˜¯ä¸€ä¸ªæˆå¯¹çš„é”®å€¼å¯¹å­—æ®µ ä¿ç•™å­—æ®µï¼šä¸ºäº†é¿å…å†æ¬¡ä½¿ç”¨åˆ°å·²ç§»é™¤çš„å­—æ®µå¯ä»¥è®¾å®šä¿ç•™å­—æ®µã€‚å¦‚æœä»»ä½•æœªæ¥ç”¨æˆ·å°è¯•ä½¿ç”¨è¿™äº›å­—æ®µæ ‡è¯†ç¬¦ï¼Œåè®®ç¼“å†²åŒºç¼–è¯‘å™¨å°±ä¼šæŠ¥é”™ ","date":"2023-07-01","objectID":"/golang-protobuf-base/:2:0","tags":["golang","rpc","protobuf"],"title":"Golang Protobuf Base","uri":"/golang-protobuf-base/"},{"categories":["æ–‡æ¡£"],"content":"å¤åˆç±»å‹ ","date":"2023-07-01","objectID":"/golang-protobuf-base/:3:0","tags":["golang","rpc","protobuf"],"title":"Golang Protobuf Base","uri":"/golang-protobuf-base/"},{"categories":["æ–‡æ¡£"],"content":"æ•°ç»„ message SearchResponse { repeated Result results = 1; } message Result { string url = 1; string title = 2; repeated string snippets = 3; } ","date":"2023-07-01","objectID":"/golang-protobuf-base/:3:1","tags":["golang","rpc","protobuf"],"title":"Golang Protobuf Base","uri":"/golang-protobuf-base/"},{"categories":["æ–‡æ¡£"],"content":"æšä¸¾ message SearchRequest { string query = 1; int32 page_number = 2; int32 result_per_page = 3; enum Corpus { UNIVERSAL = 0; WEB = 1; IMAGES = 2; LOCAL = 3; NEWS = 4; PRODUCTS = 5; VIDEO = 6; } Corpus corpus = 4; } ","date":"2023-07-01","objectID":"/golang-protobuf-base/:3:2","tags":["golang","rpc","protobuf"],"title":"Golang Protobuf Base","uri":"/golang-protobuf-base/"},{"categories":["æ–‡æ¡£"],"content":"æœåŠ¡ å®šä¹‰çš„methodä»…èƒ½æœ‰ä¸€ä¸ªå…¥å‚å’Œå‡ºå‚æ•°ã€‚å¦‚æœéœ€è¦ä¼ é€’å¤šä¸ªå‚æ•°éœ€è¦å®šä¹‰æˆmessage service SearchService { rpc Search(SearchRequest) returns (SearchResponse); } ","date":"2023-07-01","objectID":"/golang-protobuf-base/:3:3","tags":["golang","rpc","protobuf"],"title":"Golang Protobuf Base","uri":"/golang-protobuf-base/"},{"categories":["æ–‡æ¡£"],"content":"ä½¿ç”¨å…¶ä»–æ¶ˆæ¯ç±»å‹ ä½¿ç”¨importå¼•ç”¨å¦å¤–ä¸€ä¸ªæ–‡ä»¶çš„pb syntax = \"proto3\"; import \"google/protobuf/wrappers.proto\"; package ecommerce; message Order { string id = 1; repeated string items = 2; string description = 3; float price = 4; google.protobuf.StringValue destination = 5; } ","date":"2023-07-01","objectID":"/golang-protobuf-base/:3:4","tags":["golang","rpc","protobuf"],"title":"Golang Protobuf Base","uri":"/golang-protobuf-base/"},{"categories":["æ–‡æ¡£"],"content":"protocä½¿ç”¨ protocå°±æ˜¯protobufçš„ç¼–è¯‘å™¨ï¼Œå®ƒæŠŠprotoæ–‡ä»¶ç¼–è¯‘æˆä¸åŒçš„è¯­è¨€ ","date":"2023-07-01","objectID":"/golang-protobuf-base/:4:0","tags":["golang","rpc","protobuf"],"title":"Golang Protobuf Base","uri":"/golang-protobuf-base/"},{"categories":["æ–‡æ¡£"],"content":"å®‰è£… Linux, using apt or apt-get, for example: $ apt install -y protobuf-compiler $ protoc --version # Ensure compiler version is 3+ MacOS, using Homebrew[1]: $ brew install protobuf $ protoc --version # Ensure compiler version is 3+ ","date":"2023-07-01","objectID":"/golang-protobuf-base/:5:0","tags":["golang","rpc","protobuf"],"title":"Golang Protobuf Base","uri":"/golang-protobuf-base/"},{"categories":["æ–‡æ¡£"],"content":"ä½¿ç”¨ $ protoc --help Usage: protoc [OPTION] PROTO_FILES -IPATH, --proto_path=PATH æŒ‡å®šæœç´¢è·¯å¾„ --plugin=EXECUTABLE: .... --cpp_out=OUT_DIR Generate C++ header and source. --csharp_out=OUT_DIR Generate C# source file. --java_out=OUT_DIR Generate Java source file. --js_out=OUT_DIR Generate JavaScript source. --objc_out=OUT_DIR Generate Objective C header and source. --php_out=OUT_DIR Generate PHP source file. --python_out=OUT_DIR Generate Python source file. --ruby_out=OUT_DIR Generate Ruby source file @\u003cfilename\u003e protoæ–‡ä»¶çš„å…·ä½“ä½ç½® ","date":"2023-07-01","objectID":"/golang-protobuf-base/:5:1","tags":["golang","rpc","protobuf"],"title":"Golang Protobuf Base","uri":"/golang-protobuf-base/"},{"categories":["æ–‡æ¡£"],"content":"æœç´¢è·¯å¾„å‚æ•° ç¬¬ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„å‚æ•°å°±æ˜¯æœç´¢è·¯å¾„å‚æ•°ï¼Œå³ä¸Šè¿°å±•ç¤ºçš„-IPATH, â€“proto_path=PATHã€‚å®ƒè¡¨ç¤ºçš„æ˜¯æˆ‘ä»¬è¦åœ¨å“ªä¸ªè·¯å¾„ä¸‹æœç´¢.protoæ–‡ä»¶ï¼Œè¿™ä¸ªå‚æ•°æ—¢å¯ä»¥ç”¨-IæŒ‡å®šï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨â€“proto_path=æŒ‡å®š ","date":"2023-07-01","objectID":"/golang-protobuf-base/:5:2","tags":["golang","rpc","protobuf"],"title":"Golang Protobuf Base","uri":"/golang-protobuf-base/"},{"categories":["æ–‡æ¡£"],"content":"è¯­è¨€æ’ä»¶å‚æ•° Language C++ (include C++ runtime and protoc) Java Python Objective-C C# Ruby PHP ","date":"2023-07-01","objectID":"/golang-protobuf-base/:5:3","tags":["golang","rpc","protobuf"],"title":"Golang Protobuf Base","uri":"/golang-protobuf-base/"},{"categories":["æ–‡æ¡£"],"content":"protoæ–‡ä»¶ä½ç½®å‚æ•° protoæ–‡ä»¶ä½ç½®å‚æ•°å³ä¸Šè¿°çš„@å‚æ•°ï¼ŒæŒ‡å®šäº†æˆ‘ä»¬protoæ–‡ä»¶çš„å…·ä½“ä½ç½®ï¼Œå¦‚proto1/greeter/greeter.proto ","date":"2023-07-01","objectID":"/golang-protobuf-base/:5:4","tags":["golang","rpc","protobuf"],"title":"Golang Protobuf Base","uri":"/golang-protobuf-base/"},{"categories":["æ–‡æ¡£"],"content":"golangæ’ä»¶ å®‰è£… éå†…ç½®çš„è¯­è¨€æ”¯æŒå°±å¾—è‡ªå·±å•ç‹¬å®‰è£…è¯­è¨€æ’ä»¶ï¼Œæ¯”å¦‚â€“go_out=å¯¹åº”çš„æ˜¯protoc-gen-goï¼Œå®‰è£…å‘½ä»¤å¦‚ä¸‹ # æœ€æ–°ç‰ˆ $ go install google.golang.org/protobuf/cmd/protoc-gen-go@latest # æŒ‡å®šç‰ˆæœ¬ $ go install google.golang.org/protobuf/cmd/protoc-gen-go@v1.3.0 ç”Ÿæˆä»£ç  $ protoc --proto_path=src --go_out=out --go_opt=paths=source_relative foo.proto bar/baz.proto ","date":"2023-07-01","objectID":"/golang-protobuf-base/:6:0","tags":["golang","rpc","protobuf"],"title":"Golang Protobuf Base","uri":"/golang-protobuf-base/"},{"categories":["æ–‡æ¡£"],"content":" ğŸ”¥Golangç®—æ³• - å¿«é€Ÿæ’åºï¼ˆQuicksortï¼‰ å¹¿åº¦ä¼˜å…ˆç®—æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šä»åˆå§‹èŠ‚ç‚¹å¼€å§‹ï¼Œåº”ç”¨ç®—ç¬¦ç”Ÿæˆç¬¬ä¸€å±‚èŠ‚ç‚¹ï¼Œæ£€æŸ¥ç›®æ ‡èŠ‚ç‚¹æ˜¯å¦åœ¨è¿™äº›åç»§èŠ‚ç‚¹ä¸­ï¼Œè‹¥æ²¡æœ‰ï¼Œå†ç”¨äº§ç”Ÿå¼è§„åˆ™å°†æ‰€æœ‰ç¬¬ä¸€å±‚çš„èŠ‚ç‚¹é€ä¸€æ‰©å±•ï¼Œå¾—åˆ°ç¬¬äºŒå±‚èŠ‚ç‚¹ï¼Œå¹¶é€ä¸€æ£€æŸ¥ç¬¬äºŒå±‚èŠ‚ç‚¹ä¸­æ˜¯å¦åŒ…å«ç›®æ ‡èŠ‚ç‚¹ã€‚è‹¥æ²¡æœ‰ï¼Œå†ç”¨ç®—ç¬¦é€ä¸€æ‰©å±•ç¬¬äºŒå±‚çš„æ‰€æœ‰èŠ‚ç‚¹â€¦â€¦ï¼Œå¦‚æ­¤ä¾æ¬¡æ‰©å±•ï¼Œæ£€æŸ¥ä¸‹å»ï¼Œç›´åˆ°å‘ç°ç›®æ ‡èŠ‚ç‚¹ä¸ºæ­¢ã€‚å³ ","date":"2023-06-10","objectID":"/golang-beradth-firstsearch/:0:0","tags":["golang","ç®—æ³•"],"title":"ğŸ”¥Golang Beradth FirstSearch","uri":"/golang-beradth-firstsearch/"},{"categories":["æ–‡æ¡£"],"content":"å›¾ï¼ˆGraphï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ å›¾æ˜¯ç”¨æ¥å¯¹ä¸åŒäº‹ç‰©é—´å¦‚ä½•ç®¡ç†è¿›è¡Œå»ºæ¨¡çš„ä¸€ç§æ–¹å¼ ","date":"2023-06-10","objectID":"/golang-beradth-firstsearch/:1:0","tags":["golang","ç®—æ³•"],"title":"ğŸ”¥Golang Beradth FirstSearch","uri":"/golang-beradth-firstsearch/"},{"categories":["æ–‡æ¡£"],"content":"æ•°æ®ç»“æ„ Queue ç°è¿›æ¥çš„æ•°æ®å…ˆå¤„ç†ï¼ˆFIFOï¼‰ æ— æ³•éšæœºçš„è®¿é—®Queue é‡Œé¢çš„å…ƒç´  ç›¸å…³æ“ä½œ enqueue: æ·»åŠ å…ƒç´  dequeue: ç§»é™¤å…ƒç´  ä»£ç ç¤ºä¾‹ package main import \"fmt\" type GraphMap map[string][]string func main() { var graphMap GraphMap = make(GraphMap, 0) graphMap[\"you\"] = []string{\"alice\", \"bob\", \"claire\"} graphMap[\"bob\"] = []string{\"anuj\", \"peggy\"} graphMap[\"alice\"] = []string{\"peggy\"} graphMap[\"claire\"] = []string{\"tom\", \"johnny\"} graphMap[\"anuj\"] = []string{} graphMap[\"peggy\"] = []string{} graphMap[\"tom\"] = []string{} graphMap[\"johnny\"] = []string{} searchQueue := graphMap[\"you\"] for { if len(searchQueue) \u003e 0 { var person string person, searchQueue = searchQueue[0], searchQueue[1:] if personIsTom(person) { fmt.Printf(\"%s is the man\\n\", person) break } else { searchQueue = append(searchQueue, graphMap[person]...) } } else { fmt.Println(\"Not Found\") break } } } func personIsTom(p string) bool { return p == \"tom\" } å‚è€ƒè§†é¢‘ ","date":"2023-06-10","objectID":"/golang-beradth-firstsearch/:2:0","tags":["golang","ç®—æ³•"],"title":"ğŸ”¥Golang Beradth FirstSearch","uri":"/golang-beradth-firstsearch/"},{"categories":["æ–‡æ¡£"],"content":" golang-viper ä»‹ç» viper æ˜¯ä¸€ä¸ªé…ç½®è§£å†³æ–¹æ¡ˆï¼Œç”¨äºä¸°å¯Œçš„ç‰¹æ€§ æ”¯æŒ JSON/TOML/YAML/HCL/envfile/Java properties ç­‰å¤šç§æ ¼å¼çš„é…ç½®æ–‡ä»¶ å¯ä»¥è®¾ç½®ç›‘å¬é…ç½®æ–‡ä»¶çš„ä¿®æ”¹ï¼Œä¿®æ”¹æ—¶è‡ªåŠ¨åŠ è½½æ–°çš„é…ç½®ï¼› ä»ç¯å¢ƒå˜é‡ã€å‘½ä»¤è¡Œé€‰é¡¹å’Œio.Readerä¸­è¯»å–é…ç½® ä»è¿œç¨‹é…ç½®ç³»ç»Ÿä¸­è¯»å–å’Œç›‘å¬ä¿®æ”¹ï¼Œå¦‚ etcd/Consulï¼› ä»£ç é€»è¾‘ä¸­æ˜¾ç¤ºè®¾ç½®å¥å€¼ ","date":"2023-06-09","objectID":"/golang-viper/:0:0","tags":["golang","goç¬¬ä¸‰æ–¹åº“"],"title":"Golang Viper","uri":"/golang-viper/"},{"categories":["æ–‡æ¡£"],"content":"ä½¿ç”¨ å®‰è£… go get github.com/spf13/viper ä½¿ç”¨ package main import ( \"fmt\" \"log\" \"github.com/spf13/viper\" ) func main() { viper.SetConfigName(\"config\") viper.SetConfigType(\"toml\") viper.AddConfigPath(\".\") viper.SetDefault(\"redis.port\", 6381) err := viper.ReadInConfig() if err != nil { log.Fatal(\"read config failed: %v\", err) } fmt.Println(viper.Get(\"app_name\")) fmt.Println(viper.Get(\"log_level\")) fmt.Println(\"mysql ip: \", viper.Get(\"mysql.ip\")) fmt.Println(\"mysql port: \", viper.Get(\"mysql.port\")) fmt.Println(\"mysql user: \", viper.Get(\"mysql.user\")) fmt.Println(\"mysql password: \", viper.Get(\"mysql.password\")) fmt.Println(\"mysql database: \", viper.Get(\"mysql.database\")) fmt.Println(\"redis ip: \", viper.Get(\"redis.ip\")) fmt.Println(\"redis port: \", viper.Get(\"redis.port\")) } viperçš„é…ç½® SetConfigNameï¼š è®¾ç½®æ–‡ä»¶å SetConfigTypeï¼š é…ç½®ç±»å‹ AddConfigPathï¼š æœç´¢è·¯å¾„ ReadInConfigï¼š è¯»å–é…ç½® viper.Get ï¼š è·å–é”®å€¼ âš ï¸æ³¨æ„ è®¾ç½®æ–‡ä»¶åæ—¶ä¸è¦å¸¦åç¼€ æœç´¢è·¯å¾„å¯ä»¥è®¾ç½®å¤šä¸ªï¼Œviperä¼šæ ¹æ®è®¾ç½®é¡ºåºä¾æ¬¡æŸ¥æ‰¾ viper è·å–å€¼ä½¿ç”¨section.keyçš„å½¢å¼ï¼Œå³ä¼ å…¥åµŒå¥—çš„é”®å é»˜è®¤å€¼å¯ä»¥è°ƒç”¨ viper.SetDefaultè®¾ç½® ","date":"2023-06-09","objectID":"/golang-viper/:1:0","tags":["golang","goç¬¬ä¸‰æ–¹åº“"],"title":"Golang Viper","uri":"/golang-viper/"},{"categories":["æ–‡æ¡£"],"content":"è¯»å–é”® GetType ç³»åˆ—æ–¹æ³•å¯ä»¥è¿”å›æŒ‡å®šç±»å‹çš„å€¼ï¼Œ typeå¯ä»¥æ—¶Bool/Float64/Int/String/Time/Duration/IntSlice/StringSlice å¦‚æœæŒ‡å®šçš„é”®ä¸å­˜åœ¨æˆ–è€…ç±»å‹ä¸æ­£ç¡®ï¼ŒGetTypeæ–¹æ³•è¿”å›å¯¹åº”ç±»å‹æ—¶é›¶å€¼ åˆ¤æ–­æŸä¸ªé”®æ˜¯å¦å­˜åœ¨ï¼Œ ä½¿ç”¨IsSet GetStringMapï¼š ç›´æ¥ä»¥ map è¿”å›æŸä¸ªé”®ä¸‹é¢æ‰€æœ‰çš„é”®å€¼å¯¹ GetStringMapStringï¼š è¿”å›map[string]string package main import ( \"fmt\" \"log\" \"github.com/spf13/viper\" ) func main() { viper.SetConfigName(\"config\") viper.SetConfigType(\"toml\") viper.AddConfigPath(\".\") err := viper.ReadInConfig() if err != nil { log.Fatalf(\"read config failed: %v\", err) } fmt.Println(\"protocols: \", viper.GetStringSlice(\"server.protocols\")) fmt.Println(\"ports: \", viper.GetIntSlice(\"server.ports\")) fmt.Println(\"timeout: \", viper.GetDuration(\"server.timeout\")) fmt.Println(\"mysql ip: \", viper.GetString(\"mysql.ip\")) fmt.Println(\"mysql port: \", viper.GetInt(\"mysql.port\")) if viper.IsSet(\"redis.port\") { fmt.Println(\"redis.port is set\") } else { fmt.Println(\"redis.port is not set\") } fmt.Println(\"mysql settings: \", viper.GetStringMap(\"mysql\")) fmt.Println(\"redis settings: \", viper.GetStringMap(\"redis\")) fmt.Println(\"all settings: \", viper.AllSettings()) } ","date":"2023-06-09","objectID":"/golang-viper/:2:0","tags":["golang","goç¬¬ä¸‰æ–¹åº“"],"title":"Golang Viper","uri":"/golang-viper/"},{"categories":["æ–‡æ¡£"],"content":"è®¾ç½®é”®å€¼ viper æ”¯æŒåœ¨å¤šä¸ªåœ°æ–¹è®¾ç½®ï¼Œä½¿ç”¨ä¸‹é¢çš„é¡ºåºä¾æ¬¡è¯»å– è°ƒç”¨ Set æ˜¾ç¤ºè®¾ç½®çš„ å‘½ä»¤è¡Œé€‰é¡¹ï¼› ç¯å¢ƒå˜é‡ é»˜è®¤å€¼ viper.Set å¦‚æœæŸä¸ªé”®é€šè¿‡ viper.set è®¾ç½®äº†å€¼ï¼Œ è¿™ä¸ªå€¼ä¼˜å…ˆçº§æœ€é«˜ viper.Set(\"redis.port\", 5381) ","date":"2023-06-09","objectID":"/golang-viper/:3:0","tags":["golang","goç¬¬ä¸‰æ–¹åº“"],"title":"Golang Viper","uri":"/golang-viper/"},{"categories":["æ–‡æ¡£"],"content":"å‘½ä»¤è¡Œé€‰é¡¹ viperä½¿ç”¨pflagåº“æ¥è§£æé€‰é¡¹ï¼Œé¦–å…ˆåœ¨ init æ–¹æ³•ä¸­å®šä¹‰é€‰é¡¹ï¼Œ å¹¶ä¸”åœ¨viper.BindPFlags ç»‘å®šé€‰é¡¹æ¥é…ç½®ä¸­ func init() { pflag.Int(\"redis.port\", 8381, \"Redis port to connect\") // ç»‘å®šå‘½ä»¤è¡Œ viper.BindPFlags(pflag.CommandLine) } ","date":"2023-06-09","objectID":"/golang-viper/:4:0","tags":["golang","goç¬¬ä¸‰æ–¹åº“"],"title":"Golang Viper","uri":"/golang-viper/"},{"categories":["æ–‡æ¡£"],"content":"ç¯å¢ƒå˜é‡ åœ¨initæ–¹æ³•ä¸­è°ƒç”¨AutomaticEnvæ–¹æ³•ç»‘å®šå…¨éƒ¨ç¯å¢ƒå˜é‡ func init() { // ç»‘å®šç¯å¢ƒå˜é‡ viper.AutomaticEnv() } å•ç‹¬ç»‘å®šç¯å¢ƒå˜é‡ func init() { // ç»‘å®šç¯å¢ƒå˜é‡ viper.BindEnv(\"redis.port\") viper.BindEnv(\"go.path\", \"GOPATH\") } func main() { // çœç•¥éƒ¨åˆ†ä»£ç  fmt.Println(\"go path: \", viper.Get(\"go.path\")) } è°ƒç”¨ BindEnv æ–¹æ³• åªä¼ ä¸€ä¸ªå‚æ•°ï¼Œ å³è¡¨ç¤ºé”®åï¼Œåˆè¡¨ç¤ºç¯å¢ƒå˜é‡å ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œ ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºé”®åï¼Œç¬¬äºŒä¸ªè¡¨ç¤ºç¯å¢ƒå˜é‡å ","date":"2023-06-09","objectID":"/golang-viper/:5:0","tags":["golang","goç¬¬ä¸‰æ–¹åº“"],"title":"Golang Viper","uri":"/golang-viper/"},{"categories":["æ–‡æ¡£"],"content":"è¯»å–é…ç½® ","date":"2023-06-09","objectID":"/golang-viper/:6:0","tags":["golang","goç¬¬ä¸‰æ–¹åº“"],"title":"Golang Viper","uri":"/golang-viper/"},{"categories":["æ–‡æ¡£"],"content":"ä»io.Reader ä¸­è¯»å– viper æ”¯æŒä» io.Reader ä¸­è¯»å–é…ç½®ï¼Œ é…ç½®çµæ´» æ–‡ä»¶ ç¨‹åºä¸­ç”Ÿæˆçš„å­—ç¬¦ä¸² ä»ç½‘ç»œä¸­é“¾æ¥ä¸­è¯»å–çš„å­—èŠ‚æµ package main import ( \"bytes\" \"fmt\" \"log\" \"github.com/spf13/viper\" ) func main() { viper.SetConfigType(\"toml\") tomlConfig := []byte(` app_name = \"awesome web\" # possible values: DEBUG, INFO, WARNING, ERROR, FATAL log_level = \"DEBUG\" [mysql] ip = \"127.0.0.1\" port = 3306 user = \"dj\" password = 123456 database = \"awesome\" [redis] ip = \"127.0.0.1\" port = 7381 `) err := viper.ReadConfig(bytes.NewBuffer(tomlConfig)) if err != nil { log.Fatal(\"read config failed: %v\", err) } fmt.Println(\"redis port: \", viper.GetInt(\"redis.port\")) } ","date":"2023-06-09","objectID":"/golang-viper/:6:1","tags":["golang","goç¬¬ä¸‰æ–¹åº“"],"title":"Golang Viper","uri":"/golang-viper/"},{"categories":["æ–‡æ¡£"],"content":"Unmarshal viper æ”¯æŒå°†é…ç½®Unmarshalåˆ°ä¸€ä¸ªç»“æ„ä½“ä¸­ï¼Œä¸ºç»“æ„ä½“ä¸­çš„å¯¹åº”å­—æ®µèµ‹å€¼ package main import ( \"fmt\" \"log\" \"github.com/spf13/viper\" ) type Config struct { AppName string LogLevel string MySQL MySQLConfig Redis RedisConfig } type MySQLConfig struct { IP string Port int User string Password string Database string } type RedisConfig struct { IP string Port int } func main() { viper.SetConfigName(\"config\") viper.SetConfigType(\"toml\") viper.AddConfigPath(\".\") err := viper.ReadInConfig() if err != nil { log.Fatal(\"read config failed: %v\", err) } var c Config viper.Unmarshal(\u0026c) fmt.Println(c.MySQL) } ","date":"2023-06-09","objectID":"/golang-viper/:6:2","tags":["golang","goç¬¬ä¸‰æ–¹åº“"],"title":"Golang Viper","uri":"/golang-viper/"},{"categories":["æ–‡æ¡£"],"content":"ä¿å­˜é…ç½® å°†ç¨‹åºä¸­ç”Ÿæˆçš„é…ç½®ï¼Œæˆ–è€…æ‰€åšçš„ä¿®æ”¹ä¿å­˜ä¸‹æ¥ WriteConfigï¼š å°†å½“å‰çš„viperé…ç½®å†™åˆ°é¢„å®šä¹‰è·¯å¾„ï¼Œ å¦‚æœæ²¡æœ‰é¢„å®šä¹‰è·¯å¾„ï¼Œè¿”å›é”™è¯¯ï¼Œå°†ä¼šè¦†ç›–å½“å‰é…ç½® SafeWriteConfigï¼š ä¸ä¸Šé¢åŠŸèƒ½ä¸€æ ·ï¼Œå¦‚æœé…ç½®æ–‡ä»¶å­˜åœ¨ï¼Œåˆ™ä¸è¦†ç›– WriteConfigAsï¼š ä¿å­˜é…ç½®åˆ°æŒ‡å®šè·¯å¾„ï¼Œå¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œåˆ™è¦†ç›– SafeWriteConfigï¼š ä¸ä¸Šé¢åŠŸèƒ½ä¸€æ ·ï¼Œä½†æ˜¯å…¥è‚¡é…ç½®æ–‡ä»¶å­˜åœ¨ï¼Œåˆ™ä¸è¦†ç›– package main import ( \"log\" \"github.com/spf13/viper\" ) func main() { viper.SetConfigName(\"config\") viper.SetConfigType(\"toml\") viper.AddConfigPath(\".\") viper.Set(\"app_name\", \"awesome web\") viper.Set(\"log_level\", \"DEBUG\") viper.Set(\"mysql.ip\", \"127.0.0.1\") viper.Set(\"mysql.port\", 3306) viper.Set(\"mysql.user\", \"root\") viper.Set(\"mysql.password\", \"123456\") viper.Set(\"mysql.database\", \"awesome\") viper.Set(\"redis.ip\", \"127.0.0.1\") viper.Set(\"redis.port\", 6381) err := viper.SafeWriteConfig() if err != nil { log.Fatal(\"write config failed: \", err) } } ","date":"2023-06-09","objectID":"/golang-viper/:7:0","tags":["golang","goç¬¬ä¸‰æ–¹åº“"],"title":"Golang Viper","uri":"/golang-viper/"},{"categories":["æ–‡æ¡£"],"content":"ç›‘å¬æ–‡ä»¶ä¿®æ”¹ viper å¯ä»¥ç›‘å¬æ–‡ä»¶ä¿®æ”¹ï¼Œ çƒ­åŠ è½½é…ç½®ï¼Œä¸éœ€è¦é‡å¯æœåŠ¡å™¨ï¼Œ è®©é…ç½®ç”Ÿæ•ˆ package main import ( \"fmt\" \"log\" \"time\" \"github.com/spf13/viper\" ) func main() { viper.SetConfigName(\"config\") viper.SetConfigType(\"toml\") viper.AddConfigPath(\".\") err := viper.ReadInConfig() if err != nil { log.Fatal(\"read config failed: %v\", err) } viper.WatchConfig() fmt.Println(\"redis port before sleep: \", viper.Get(\"redis.port\")) time.Sleep(time.Second * 10) fmt.Println(\"redis port after sleep: \", viper.Get(\"redis.port\")) } viper.WatchConfigï¼š viper ä¼šè‡ªåŠ¨ç›‘å¬é…ç½®ä¿®æ”¹ï¼Œå¦‚æœæœ‰ä¿®æ”¹ï¼Œé‡æ–°åŠ è½½çš„é…ç½® ä¸ºé…ç½®ä¿®æ”¹å¢åŠ ä¸€ä¸ªå›è°ƒ viper.OnConfigChange(func(e fsnotify.Event) { fmt.Printf(\"Config file:%s Op:%s\\n\", e.Name, e.Op) }) å‚è€ƒé“¾æ¥ https://darjun.github.io/2020/01/18/godailylib/viper/ ","date":"2023-06-09","objectID":"/golang-viper/:8:0","tags":["golang","goç¬¬ä¸‰æ–¹åº“"],"title":"Golang Viper","uri":"/golang-viper/"},{"categories":["æ–‡æ¡£"],"content":"# golang-cobra ä»‹ç» cobra æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œç¨‹åºåº“ æä¾›äº†è„šæ‰‹æ¶ï¼Œç”¨äºç”ŸæˆåŸºäºcobraçš„åº”ç”¨ç¨‹åºæ¡†æ¶ ","date":"2023-06-08","objectID":"/golang-cobra/:0:0","tags":["golang","goç¬¬ä¸‰æ–¹åº“"],"title":"Golang Cobra","uri":"/golang-cobra/"},{"categories":["æ–‡æ¡£"],"content":"å®‰è£…\u0026ä½¿ç”¨ å®‰è£… cobra go get github.com/spf13/cobra/cobra å®ç°ä¸€ä¸ªgit æ¨¡æ‹Ÿå‘½ä»¤, é€šè¿‡os/exec åº“è°ƒç”¨å¤–éƒ¨ç¨‹åºæ‰§è¡ŒçœŸå®çš„gitå‘½ä»¤ ç›®å½•ç»“æ„å¦‚ä¸‹ tree . â”œâ”€â”€ cmd â”‚Â â”œâ”€â”€ helper.go â”‚Â â”œâ”€â”€ root.go â”‚Â â””â”€â”€ version.go â””â”€â”€ main.go root.go package cmd import ( \"errors\" \"github.com/spf13/cobra\" ) var rootCmd = \u0026cobra.Command{ Use: \"git\", Short: \"Git is a distributed version control system.\", Long: `Git is a free and open source distributed version control system designed to handle everything from small to very large projects with speed and efficiency.`, Run: func(cmd *cobra.Command, args []string) { Error(cmd, args, errors.New(\"unrecognized command\")) }, } func Execute() { rootCmd.Execute() } version.go package cmd import ( \"fmt\" \"os\" \"github.com/spf13/cobra\" ) var versionCmd = \u0026cobra.Command{ Use: \"version\", Short: \"version subcommand show git version info.\", Run: func(cmd *cobra.Command, args []string) { output, err := ExecuteCommand(\"git\", \"version\", args...) if err != nil { Error(cmd, args, err) } fmt.Fprint(os.Stdout, output) }, } func init() { rootCmd.AddCommand(versionCmd) } main.go package main import ( \"demo/dajun/cobra/cmd\" ) func main() { cmd.Execute() } helper.go å°è£…äº†è°ƒç”¨å¤–éƒ¨ç¨‹åºå’Œé”™è¯¯å¤„ç†å‡½æ•° package cmd import ( \"fmt\" \"os\" \"os/exec\" \"github.com/spf13/cobra\" ) func ExecuteCommand(name string, subname string, args ...string) (string, error) { args = append([]string{subname}, args...) cmd := exec.Command(name, args...) bytes, err := cmd.CombinedOutput() return string(bytes), err } func Error(cmd *cobra.Command, args []string, err error) { fmt.Fprintf(os.Stderr, \"execute %s args:%v error:%v\\n\", cmd.Name(), args, err) os.Exit(1) } æ¯ä¸ªcobra ç¨‹åºéƒ½æœ‰ä¸€ä¸ªæ ¹å‘½ä»¤ï¼Œå¯ä»¥ç»™ä»–æ·»åŠ ä»»æ„å¤šä¸ªå­å‘½ä»¤ï¼Œ åœ¨version.go initå‡½æ•°å°†å­å‘½ä»¤æ·»åŠ åˆ°è·Ÿå‘½ä»¤ä¸­ ä¸èƒ½ç›´æ¥go run main.goï¼Œè¿™å·²ç»ä¸æ˜¯å•æ–‡ä»¶ç¨‹åºäº†ã€‚å¦‚æœå¼ºè¡Œè¦ç”¨ï¼Œè¯·ä½¿ç”¨go run . go build -o main cobra è‡ªåŠ¨ç”Ÿæˆçš„å¸®åŠ©ä¿¡æ¯ ./main -h Git is a free and open source distributed version control system designed to handle everything from small to very large projects with speed and efficiency. Usage: git [flags] git [command] Available Commands: completion Generate the autocompletion script for the specified shell help Help about any command version version subcommand show git version info. Flags: -h, --help help for git Use \"git [command] --help\" for more information about a command å•ä¸ªå­å‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯ ./main version -h version subcommand show git version info. Usage: git version [flags] Flags: -h, --help help for version è°ƒç”¨å­å‘½ä»¤ ./main version git version 2.39.2 (Apple Git-143) ","date":"2023-06-08","objectID":"/golang-cobra/:1:0","tags":["golang","goç¬¬ä¸‰æ–¹åº“"],"title":"Golang Cobra","uri":"/golang-cobra/"},{"categories":["æ–‡æ¡£"],"content":"ç‰¹æ€§ cobra æä¾›éå¸¸ä¸°å¯Œçš„åŠŸèƒ½ è½»æ¾æ”¯æŒå­å‘½ä»¤å¦‚ app server, app fetchç­‰ å®Œå…¨å…¼å®¹POSIXé€‰é¡¹ï¼ˆåŒ…æ‹¬çŸ­ï¼Œé•¿é€‰é¡¹ï¼‰ï¼› åµŒå¥—å­å‘½ä»¤ å…¨å±€/æœ¬åœ°å±‚çº§é€‰é¡¹ï¼Œå¯ä»¥åœ¨å¤šå¤„è®¾ç½®é€‰é¡¹ï¼Œ æŒ‰ç…§ä¸€å®šçš„é¡ºåºè°ƒç”¨ ä½¿ç”¨è„šæ‰‹æ¶è½»æ¾èƒœå‡ºç¨‹åºæ¡†æ¶å’Œå‘½ä»¤ ","date":"2023-06-08","objectID":"/golang-cobra/:2:0","tags":["golang","goç¬¬ä¸‰æ–¹åº“"],"title":"Golang Cobra","uri":"/golang-cobra/"},{"categories":["æ–‡æ¡£"],"content":"åŸºæœ¬æ¦‚å¿µ å‘½ä»¤(Command): éœ€è¦æ‰§è¡Œçš„çš„æ“ä½œã€‚ å‚æ•°(Arg) ï¼š å‘½ä»¤çš„å‚æ•°ï¼Œ å³è¦æ“ä½œçš„å¯¹è±¡ã€‚ é€‰é¡¹(Flag)ï¼š å‘½ä»¤é€‰é¡¹å¯ä»¥è°ƒæ•´å‘½ä»¤çš„è¡Œä¸ºã€‚ ","date":"2023-06-08","objectID":"/golang-cobra/:2:1","tags":["golang","goç¬¬ä¸‰æ–¹åº“"],"title":"Golang Cobra","uri":"/golang-cobra/"},{"categories":["æ–‡æ¡£"],"content":"å‘½ä»¤ åœ¨cobraä¸­ï¼Œ å‘½ä»¤å’Œå­å‘½ä»¤éƒ½æ˜¯ç”¨ Command ç»“æ„è¡¨ç¤ºçš„ï¼ŒCommandæœ‰éå¸¸å¤šçš„å­—æ®µï¼Œç”¨æ¥åˆ¶å®šå‘½ä»¤çš„è¡Œä¸ºï¼Œ Use: ä½¿ç”¨ä¿¡æ¯ï¼Œå³å‘½ä»¤æ€ä¹ˆè¢«è°ƒç”¨ï¼ŒExample: add [-F file | -D dir]... [-f format] profile Short\\Longï¼šå‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯ï¼Œå‰è€…æ˜¯ç®€çŸ­çš„ï¼Œåè€…æ˜¯è¯¦ç»†çš„ Runï¼š å®é™…æ‰§è¡Œçš„æ“ä½œå‡½æ•° å®šä¹‰æ–°çš„å­å‘½ä»¤å¾ˆç®€å•ï¼Œ åˆ›å»ºä¸€ä¸ªcobra.Commandå˜é‡ï¼Œ è®¾ç½®ä¸€äº›å­—æ®µï¼Œæ·»åŠ åˆ°æ ¹å‘½ä»¤ æ·»åŠ ä¸€ä¸ªclone package cmd import ( \"fmt\" \"os\" \"github.com/spf13/cobra\" ) var cloneCmd = \u0026cobra.Command { Use: \"clone url [destination]\", Short: \"Clone a repository into a new directory\", Run: func(cmd *cobra.Command, args []string) { output, err := ExecuteCommand(\"git\", \"clone\", args...) if err != nil { Error(cmd, args, err) } fmt.Fprintf(os.Stdout, output) }, } func init() { rootCmd.AddCommand(cloneCmd) } Useï¼š clone url [destination] clone: å­å‘½ä»¤ urlï¼š å‚æ•° destination : ç›®æ ‡è·¯å¾„ ","date":"2023-06-08","objectID":"/golang-cobra/:3:0","tags":["golang","goç¬¬ä¸‰æ–¹åº“"],"title":"Golang Cobra","uri":"/golang-cobra/"},{"categories":["æ–‡æ¡£"],"content":"é€‰é¡¹ cobra çš„é€‰é¡¹åˆ†ä¸ºä¸¤ç§ æ°¸ä¹…é€‰é¡¹ï¼šå®šä¹‰çš„å‘½ä»¤å’Œå…¶å­å‘½ä»¤éƒ½å¯ä»¥ä½¿ç”¨ï¼Œé€šè¿‡ç»™è·Ÿå‘½ä»¤æ·»åŠ ä¸€ä¸ªé€‰é¡¹å®šä¹‰å…¨å±€é€‰é¡¹ æœ¬åœ°é€‰é¡¹ï¼šå®šä¹‰å®ƒ çš„å‘½ä»¤ä¸­ä½¿ç”¨ cobra ä½¿ç”¨pflag è§£æå‘½ä»¤è¡Œé€‰é¡¹ï¼Œ å­˜å‚¨é€‰é¡¹çš„å˜é‡éœ€è¦æå‰å®šä¹‰å¥½ var Verbose bool var Source string è®¾ç½®æ°¸ä¹…é€‰é¡¹ rootCmd.PersistentFlags().BoolVarP(\u0026Verbose, \"verbose\", \"v\", false, \"verbose output\") è®¾ç½®æœ¬åœ°é€‰é¡¹ localCmd.Flags().StringVarP(\u0026Source, \"source\", \"s\", \"\", \"Source directory to read from\") åº§ä¸€ä¸ªè®¡ç®—æœºåŠŸèƒ½ï¼Œ æ”¯æŒåŠ ã€å‡ã€ä¹˜ã€é™¤æ“ä½œã€‚å¹¶ä¸”å¯ä»¥é€šè¿‡é€‰é¡¹è®¾ç½®æ˜¯å¦å¿½ç•¥éæ•°å­—å‚æ•°ï¼Œè®¾ç½®é™¤ 0 æ˜¯å¦æŠ¥é”™ã€‚ æ˜¾ç„¶ï¼Œå‰ä¸€ä¸ªé€‰é¡¹åº”è¯¥æ”¾åœ¨å…¨å±€é€‰é¡¹ä¸­ï¼Œåä¸€ä¸ªåº”è¯¥æ”¾åœ¨é™¤æ³•å‘½ä»¤ä¸­ ç¨‹åºç»“æ„ â”œâ”€â”€ cmd â”‚Â â”œâ”€â”€ add.go â”‚Â â”œâ”€â”€ divide.go â”‚Â â”œâ”€â”€ helper.go â”‚Â â”œâ”€â”€ minus.go â”‚Â â”œâ”€â”€ multiply.go â”‚Â â””â”€â”€ root.go â””â”€â”€ main.go devide.go package cmd import ( \"fmt\" \"strings\" \"github.com/spf13/cobra\" ) var ( dividedByZeroHanding int // é™¤ 0 å¦‚ä½•å¤„ç† ) var divideCmd = \u0026cobra.Command { Use: \"divide\", Short: \"Divide subcommand divide all passed args.\", Run: func(cmd *cobra.Command, args []string) { values := ConvertArgsToFloat64Slice(args, ErrorHandling(parseHandling)) result := calc(values, DIVIDE) fmt.Printf(\"%s = %.2f\\n\", strings.Join(args, \"/\"), result) }, } func init() { divideCmd.Flags().IntVarP(\u0026dividedByZeroHanding, \"divide_by_zero\", \"d\", int(PanicOnDividedByZero), \"do what when divided by zero\") rootCmd.AddCommand(divideCmd) } root.go var ( parseHandling int ) var rootCmd = \u0026cobra.Command { Use: \"math\", Short: \"Math calc the accumulative result.\", Run: func(cmd *cobra.Command, args []string) { Error(cmd, args, errors.New(\"unrecognized subcommand\")) }, } func init() { rootCmd.PersistentFlags().IntVarP(\u0026parseHandling, \"parse_error\", \"p\", int(ContinueOnParseError), \"do what when parse arg error\") } func Execute() { rootCmd.Execute() } åœ¨divide.goä¸­å®šä¹‰äº†å¦‚ä½•å¤„ç†é™¤ 0 é”™è¯¯çš„é€‰é¡¹ï¼Œåœ¨root.goä¸­å®šä¹‰äº†å¦‚ä½•å¤„ç†è§£æé”™è¯¯çš„é€‰é¡¹ã€‚é€‰é¡¹æšä¸¾å¦‚ä¸‹ï¼š const ( ContinueOnParseError ErrorHandling = 1 // è§£æé”™è¯¯å°è¯•ç»§ç»­å¤„ç† ExitOnParseError ErrorHandling = 2 // è§£æé”™è¯¯ç¨‹åºåœæ­¢ PanicOnParseError ErrorHandling = 3 // è§£æé”™è¯¯ panic ReturnOnDividedByZero ErrorHandling = 4 // é™¤0è¿”å› PanicOnDividedByZero ErrorHandling = 5 // é™¤0 painc ) æµ‹è¯•ç¨‹åº $ go build -o math $ ./math add 1 2 3 4 1+2+3+4 = 10.00 $ ./math minus 1 2 3 4 1-2-3-4 = -8.00 $ ./math multiply 1 2 3 4 1*2*3*4 = 24.00 $ ./math divide 1 2 3 4 1/2/3/4 = 0.04 é»˜è®¤æƒ…å†µä¸‹ï¼Œ è§£æé”™è¯¯è¢«å¿½ç•¥ï¼Œ $ ./math add 1 2a 3b 4 1+2a+3b+4 = 5.00 $ ./math divide 1 2a 3b 4 1/2a/3b/4 = 0.25 è®¾ç½®è§£æå¤±è´¥çš„å¤„ç†ï¼Œ2 è¡¨ç¤ºé€€å‡ºç¨‹åºï¼Œ3 è¡¨ç¤º panic ./math add 1 2a 3b 4 -p 2 invalid number: 2a $ ./math add 1 2a 3b 4 -p 3 panic: strconv.ParseFloat: parsing \"2a\": invalid syntax goroutine 1 [running]: ","date":"2023-06-08","objectID":"/golang-cobra/:4:0","tags":["golang","goç¬¬ä¸‰æ–¹åº“"],"title":"Golang Cobra","uri":"/golang-cobra/"},{"categories":["æ–‡æ¡£"],"content":"è„šæ‰‹æ¶ å§‹åŒ–ä¸€ä¸ªæ–°çš„Goæ¨¡å—ï¼š åˆ›å»ºä¸€ä¸ªæ–°ç›®å½• cdè¿›å…¥é‚£ä¸ªç›®å½• run go mod init cd $HOME/code mkdir myapp cd myapp go mod init github.com/spf13/myapp cobra-cli initä¹Ÿå¯ä»¥ä»å­ç›®å½•è¿è¡Œ â€“authoræ ‡å¿—çš„ä½œè€…å§“åã€‚ä¾‹å¦‚cobra-cli init â€“author â€œSteve Francia spf@spf13.comâ€ â€“licenseä¸€èµ·ä½¿ç”¨çš„è®¸å¯è¯ï¼Œä¾‹å¦‚cobra-cli init â€“license apache ","date":"2023-06-08","objectID":"/golang-cobra/:5:0","tags":["golang","goç¬¬ä¸‰æ–¹åº“"],"title":"Golang Cobra","uri":"/golang-cobra/"},{"categories":["æ–‡æ¡£"],"content":"ç»™é¡¹ç›®æ·»åŠ å‘½ä»¤ cobra-cli add serve cobra-cli add config cobra-cli add create -p 'configCmd' è¿è¡Œäº†è¿™ä¸‰ä¸ªå‘½ä»¤ï¼Œä½ å°±ä¼šæœ‰ä¸€ä¸ªç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„åº”ç”¨ç¨‹åºç»“æ„ï¼š â–¾ app/ â–¾ cmd/ config.go create.go serve.go root.go main.go å‚è€ƒé“¾æ¥ https://github.com/spf13/cobra-cli https://darjun.github.io/2020/01/17/godailylib/cobra/ ","date":"2023-06-08","objectID":"/golang-cobra/:5:1","tags":["golang","goç¬¬ä¸‰æ–¹åº“"],"title":"Golang Cobra","uri":"/golang-cobra/"},{"categories":["æ–‡æ¡£"],"content":" ğŸ”¥Golangç®—æ³• - å¿«é€Ÿæ’åºï¼ˆQuicksortï¼‰ ä¸éœ€è¦æ’åºçš„æ•°ç»„ï¼ˆBase case åŸºçº¿æ¡ä»¶ï¼‰ [],ç©ºæ•°ç»„ [s], å•å…ƒç´ æ•°ç»„ å®¹æ˜“æ’åºçš„æ•°ç»„ [a,b],ä¸¤ä¸ªå…ƒç´ çš„æ•°ç»„ï¼Œåªéœ€åšæŒå®ƒä»¬ä¹‹é—´çš„å¤§å°å³å¯ï¼Œè°ƒæ•´ä½ç½® ","date":"2023-06-08","objectID":"/golang-quicksort/:0:0","tags":["golang","ç®—æ³•"],"title":"ğŸ”¥Golang Quicksort","uri":"/golang-quicksort/"},{"categories":["æ–‡æ¡£"],"content":"ä½¿ç”¨Quicksort æ’åºæ•°ç»„ 3ä¸ªå…ƒç´ çš„æ•°ç»„ï¼ˆä¾‹å¦‚[23, 19, 35]ï¼‰ ä½¿ç”¨D \u0026 Cç­–ç•¥ï¼Œ ç®€åŒ–ä¸ºåŸºçº¿æ¡ä»¶ï¼ˆBase caseï¼‰ ä»æ•°ç»„ä¸­éšä¾¿æ‰¾ä¸€ä¸ªå…ƒç´ ï¼Œ ä¾‹å¦‚35ï¼Œ è¿™ä¸ªå…ƒç´ å«åšpivot(åŸºå‡†å…ƒç´ ) æ‰¾åˆ°æ¯”pivotå°çš„å…ƒç´ ï¼Œæ‰¾åˆ°æ¯”pivotå¤§çš„å…ƒç´ ï¼Œ è¿™å«åšåˆ†åŒºï¼š[23, 19],(35),[] å¦‚æœå·¦å³ä¸¤ä¸ªå­æ•°ç»„å·²æ’å¥½åºï¼ˆè¾¾åˆ°åŸºçº¿æ¡ä»¶ï¼‰ï¼Œ ç»“æœï¼š å·¦è¾¹ + [pivot] + å³è¾¹ å¦‚æœå·¦å³ä¸¤ä¸ªå­æ•°ç»„æ²¡æœ‰å·²æ’å¥½åºï¼ˆæ²¡æœ‰è¾¾åˆ°åŸºçº¿æ¡ä»¶ï¼‰ï¼Œ é‚£ä¹ˆï¼š quiksortå·¦è¾¹ + [pivot] + quicksortå³è¾¹ ","date":"2023-06-08","objectID":"/golang-quicksort/:1:0","tags":["golang","ç®—æ³•"],"title":"ğŸ”¥Golang Quicksort","uri":"/golang-quicksort/"},{"categories":["æ–‡æ¡£"],"content":"ä½¿ç”¨Quicksourt æ’åºæ•°ç»„çš„æ­¥éª¤ é€‰æ‹©ä¸€ä¸ªpivot å°†æ•°ç»„åˆ†ä¸ºä¸¤ä¸ªå­æ•°ç»„ å·¦ä¾§æ•°ç»„çš„å…ƒç´ éƒ½æ¯”pivotå° å³ä¾§æ•°ç»„çš„å…ƒç´ éƒ½æ¯”pivotå¤§ åœ¨ä¸¤ä¸ªå­æ•°ç»„ä¸Šé€’å½’çš„è°ƒç”¨quicksort ä»£ç ç¤ºä¾‹01 package main import \"fmt\" func main() { arr := []int{12, 87, 62, 66, 30, 12, 328, 121, 67, 98, 3, 256, 81} result := quicksort(arr) fmt.Println(result) } func quicksort(arr []int) []int { if len(arr) \u003c 2 { return arr } pivot := arr[0] var left, right []int for _, ele := range arr[1:] { if ele \u003c= pivot { left = append(left, ele) } else { right = append(right, ele) } } return append(quicksort(left), append([]int{pivot}, quicksort(right)...)...) } å‚è€ƒè§†é¢‘ ","date":"2023-06-08","objectID":"/golang-quicksort/:2:0","tags":["golang","ç®—æ³•"],"title":"ğŸ”¥Golang Quicksort","uri":"/golang-quicksort/"},{"categories":["æ–‡æ¡£"],"content":" ğŸ”¥Golangç®—æ³• - D\u0026C ç®—æ³• Devide \u0026 Conquer D \u0026 C çš„æ­¥éª¤ æ‰¾åˆ°ä¸€ä¸ªç®€å•çš„åŸºçº¿æ¡ä»¶ï¼ˆBase Caseï¼‰ æŠŠé—®é¢˜åˆ†å¼€å¤„ç†ã€‚ç›´åˆ°å®ƒå˜ä¸ºæé™æ¡ä»¶ ","date":"2023-06-07","objectID":"/golang-divide_conquer/:0:0","tags":["golang","ç®—æ³•"],"title":"ğŸ”¥Golang Divide_Conquer","uri":"/golang-divide_conquer/"},{"categories":["æ–‡æ¡£"],"content":"ä¾‹å­ éœ€æ±‚ï¼š å°†æ•°ç»„[1,3,5,7,9]æ±‚å’Œ æ€è·¯1ï¼š ä½¿ç”¨å¾ªç¯ï¼ˆä¾‹å¦‚forå¾ªç¯ï¼‰ æ€è·¯2: D \u0026 Cç­–ç•¥ åŸºçº¿æ¡ä»¶ï¼š ç©ºæ•°ç»„[], å…¶å’Œä¸º0ï¼Œ é€’å½’ï¼š[1,3,5,7,9] 1 + SUM([3,5,7,9]) 3 + SUM([5,7,9]) 5 + SUM([7,9]) 7 + SUM([9]) 9 + SUM([]) ","date":"2023-06-07","objectID":"/golang-divide_conquer/:1:0","tags":["golang","ç®—æ³•"],"title":"ğŸ”¥Golang Divide_Conquer","uri":"/golang-divide_conquer/"},{"categories":["æ–‡æ¡£"],"content":"ä»£ç ç¤ºä¾‹ package main import \"fmt\" func main() { totals := sum([]int{1, 3, 5, 7, 9}) fmt.Println(totals) } func sum(arr []int) int { if len(arr) == 0 { return 0 } return arr[0] + sum(arr[1:]) } å‚è€ƒè§†é¢‘ ","date":"2023-06-07","objectID":"/golang-divide_conquer/:2:0","tags":["golang","ç®—æ³•"],"title":"ğŸ”¥Golang Divide_Conquer","uri":"/golang-divide_conquer/"},{"categories":["æ–‡æ¡£"],"content":" git tag (figure) ğŸš€git tag æ ‡ç­¾ç®¡ç† å¯ä»¥åœ¨ç‰ˆæœ¬åº“ä¸­æ‰“ä¸€ä¸ªæ ‡ç­¾ï¼Œç¡®å®šæ‰“æ ‡ç­¾çš„ç‰ˆæœ¬ æ ‡ç­¾å°±æ˜¯ç‰ˆæœ¬åº“çš„å¿«ç…§ ","date":"2023-06-06","objectID":"/git-tag/:0:0","tags":["git"],"title":"Git Tag","uri":"/git-tag/"},{"categories":["æ–‡æ¡£"],"content":"åˆ›å»ºæ ‡ç­¾ åˆ‡æ¢åˆ°éœ€è¦æ‰“æ ‡ç­¾çš„åˆ†æ”¯ä¸Š $ git branch * dev master $ git checkout master Switched to branch 'master' æ‰“ä¸€ä¸ªæ–°æ ‡ç­¾ git tag v1.0 æŸ¥çœ‹æ‰€æœ‰æ ‡ç­¾ git tag v1.0 é»˜è®¤æ ‡ç­¾æ˜¯æ‰“åœ¨æœ€æ–°æäº¤çš„commitä¸Š æ‰¾åˆ°å†å²æäº¤çš„commit idï¼Œç„¶åæ‰“ git log --pretty=oneline --abbrev-commit 12a631b (HEAD -\u003e master, tag: v1.0, origin/master) merged bug fix 101 4c805e2 fix bug 101 e1e9c68 merge with no-ff f52c633 add merge cf810e4 conflict fixed è¦å¯¹add mergeè¿™æ¬¡æäº¤æ‰“æ ‡ç­¾ git tag v0.9 f52c633 å†æ¬¡æŸ¥çœ‹æ ‡ç­¾ git tag v0.9 v1.0 æ ‡ç­¾ä¸æ˜¯æŒ‰æ—¶é—´é¡ºåºåˆ—å‡ºï¼Œè€Œæ˜¯æŒ‰å­—æ¯æ’åºçš„ã€‚å¯ä»¥ç”¨git show æŸ¥çœ‹æ ‡ç­¾ä¿¡æ¯ git show v0.9 commit f52c63349bc3c1593499807e5c8e972b82c8f286 (tag: v0.9) Author: Michael Liao \u003caskxuefeng@gmail.com\u003e Date: Fri May 18 21:56:54 2018 +0800 add merge diff --git a/readme.txt b/readme.txt å¯ä»¥åˆ›å»ºå¸¦æœ‰è¯´æ˜çš„æ ‡ç­¾ï¼Œç”¨-aæŒ‡å®šæ ‡ç­¾åï¼Œ-mæŒ‡å®šè¯´æ˜æ–‡å­— git tag -a v0.1 -m \"version 0.1 released\" 1094adb ","date":"2023-06-06","objectID":"/git-tag/:1:0","tags":["git"],"title":"Git Tag","uri":"/git-tag/"},{"categories":["æ–‡æ¡£"],"content":"æ“ä½œæ ‡ç­¾ åˆ é™¤æ ‡ç­¾ git tag -d v0.1 æ¨é€æŸä¸ªæ ‡ç­¾åˆ°è¿œç¨‹ git push origin v1.0 æ¨é€æ‰€æœ‰æ ‡ç­¾ git push origin --tags åˆ é™¤è¿œç¨‹æ ‡ç­¾ ## æœ¬åœ°åˆ é™¤æ ‡ç­¾ git tag -d v0.9 ## è¿œç¨‹åˆ é™¤ git push origin :refs/tags/v0.9 ","date":"2023-06-06","objectID":"/git-tag/:2:0","tags":["git"],"title":"Git Tag","uri":"/git-tag/"},{"categories":["æ–‡æ¡£"],"content":"å‘½ä»¤æ€»ç»“ git tag ç”¨äºæ–°å»ºä¸€ä¸ªæ ‡ç­¾ï¼Œé»˜è®¤ä¸ºHEADï¼Œä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªcommit idï¼› git tag -a -m â€œblablablaâ€¦â€œå¯ä»¥æŒ‡å®šæ ‡ç­¾ä¿¡æ¯ï¼› git tagå¯ä»¥æŸ¥çœ‹æ‰€æœ‰æ ‡ç­¾ git push origin å¯ä»¥æ¨é€ä¸€ä¸ªæœ¬åœ°æ ‡ç­¾ï¼› git push origin â€“tagså¯ä»¥æ¨é€å…¨éƒ¨æœªæ¨é€è¿‡çš„æœ¬åœ°æ ‡ç­¾ï¼› git tag -d å¯ä»¥åˆ é™¤ä¸€ä¸ªæœ¬åœ°æ ‡ç­¾ï¼› git push origin :refs/tags/å¯ä»¥åˆ é™¤ä¸€ä¸ªè¿œç¨‹æ ‡ç­¾ å‚è€ƒé“¾æ¥ https://www.liaoxuefeng.com/wiki/896043488029600/900788941487552 ","date":"2023-06-06","objectID":"/git-tag/:3:0","tags":["git"],"title":"Git Tag","uri":"/git-tag/"},{"categories":["æ–‡æ¡£"],"content":" git (figure) ğŸš€git å¸¸ç”¨å‘½ä»¤å’ŒæŠ€å·§ åˆ—ä¸¾ä¸€äº›å¸¸ç”¨çš„gitå‘½ä»¤å’Œä¸€äº›å°æŠ€å·§ ç»Ÿä¸€æ¦‚å¿µ å·¥ä½œåŒºï¼š è¯¥åŠ¨ï¼ˆå¢åˆ æ–‡ä»¶å’Œå†…å®¹ï¼‰ æš‚å­˜åŒºï¼š è¾“å…¥å‘½ä»¤ï¼Œgit add æ”¹åŠ¨çš„æ–‡ä»¶åï¼Œæ­¤æ¬¡æ”¹åŠ¨å°±æ”¾åˆ°äº† â€˜æš‚å­˜åŒºâ€™ æœ¬åœ°ä»“åº“ï¼š è¾“å…¥å‘½ä»¤ï¼šgit commit æ­¤æ¬¡ä¿®æ”¹çš„æè¿°ï¼Œæ­¤æ¬¡æ”¹åŠ¨å°±æ”¾åˆ°äº†æœ¬åœ°ä»“åº“ï¼Œæ¯ä¸ª commitï¼Œæˆ‘å«å®ƒä¸ºä¸€ä¸ªç‰ˆæœ¬ è¿œç¨‹ä»“åº“ï¼š è¾“å…¥å‘½ä»¤ï¼šgit push è¿œç¨‹ä»“åº“ï¼Œæ­¤æ¬¡æ”¹åŠ¨å°±æ”¾åˆ°äº†è¿œç¨‹ä»“åº“ï¼ˆGitHub ç­‰) commit-idï¼šè¾“å‡ºå‘½ä»¤ï¼šgit logï¼Œæœ€ä¸Šé¢é‚£è¡Œ commit xxxxxxï¼Œåé¢çš„å­—ç¬¦ä¸²å°±æ˜¯ commit-id ","date":"2023-06-03","objectID":"/git-skill/:0:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"git åŸºç¡€ä»‹ç» åˆ›å»ºæ–°ä»“åº“ # åˆ›å»ºæ–°æ–‡ä»¶å¤¹ï¼Œ æ‰“å¼€ï¼Œ ç„¶åæ‰§è¡Œ git init æ£€å‡ºä»“åº“ # æ‰§è¡Œå‘½ä»¤ä»¥åˆ›å»ºä¸€ä¸ªæœ¬åœ°ä»“åº“çš„å…‹éš†ç‰ˆæœ¬ git clone /path/to/repository # è¿œç«¯æœåŠ¡å™¨çš„ä»“åº“ git clone username@host:/path/to/repository å·¥ä½œæµ æœ¬åœ°ä»“åº“æœ‰gitç»´æŠ¤ä¸‰é¢—æ ‘ç»„æˆ å·¥ä½œç›®å½•ï¼š æŒæœ‰å®é™…çš„æ–‡ä»¶ æš‚å­˜åŒº ï¼š ç¼“å­˜åŒºåŸŸï¼Œä¸´æ—¶ä¿å­˜ä½ çš„æ”¹åŠ¨ HEADï¼š æŒ‡å‘ä½ æœ€åä¸€æ¬¡æäº¤çš„ç»“æœ æ·»åŠ å’Œæäº¤ ## æå‡ºæ›´æ”¹ï¼ˆæŠŠå®ƒä»¬æ·»åŠ åˆ°æš‚å­˜åŒºï¼‰ git add \u003cfilename\u003e git add * ## æ”¹åŠ¨å·²ç»æäº¤åˆ°äº† HEAD git commit -m \"ä»£ç æäº¤ä¿¡æ¯\" æ¨é€æ”¹åŠ¨ ## å°†æ”¹åŠ¨æäº¤åˆ° è¿œç«¯ä»“åº“ git push origin master ## å°†ä½ çš„ä»“åº“è¿æ¥åˆ°æŸä¸ªè¿œç¨‹æœåŠ¡å™¨ï¼Œä½ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ·»åŠ  git remote add origin \u003cserver\u003e åˆ†æ”¯ ## åˆ›å»ºä¸€ä¸ªåˆ†æ”¯ git checkout -b feature_x ## åˆ‡æ¢å›ä¸»åˆ†æ”¯ git checkout master ## æŠŠæ–°å»ºçš„åˆ†æ”¯åˆ é™¤ git branch -d feature_x ## é™¤éä½ å°†åˆ†æ”¯æ¨é€åˆ°è¿œç«¯ä»“åº“ï¼Œä¸ç„¶è¯¥åˆ†æ”¯å°±æ˜¯ ä¸ä¸ºä»–äººæ‰€è§çš„ git push origin \u003cbranch\u003e æ›´æ–°ä¸åˆå¹¶ ## æ›´æ–°ä½ çš„æœ¬åœ°ä»“åº“è‡³æœ€æ–°æ”¹åŠ¨ git pull ## åˆå¹¶å…¶ä»–åˆ†æ”¯åˆ°ä½ çš„å½“å‰åˆ†æ”¯ git merge \u003cbranch\u003e ## åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œgit éƒ½ä¼šå°è¯•å»è‡ªåŠ¨åˆå¹¶æ”¹åŠ¨ã€‚é—æ†¾çš„æ˜¯ï¼Œè¿™å¯èƒ½å¹¶éæ¯æ¬¡éƒ½æˆåŠŸï¼Œå¹¶å¯èƒ½å‡ºç°å†²çªï¼ˆconflictsï¼‰ã€‚ è¿™æ—¶å€™å°±éœ€è¦ä½ ä¿®æ”¹è¿™äº›æ–‡ä»¶æ¥æ‰‹åŠ¨åˆå¹¶è¿™äº›å†²çªï¼ˆconflictsï¼‰ã€‚æ”¹å®Œä¹‹åï¼Œä½ éœ€è¦æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ä»¥å°†å®ƒä»¬æ ‡è®°ä¸ºåˆå¹¶æˆåŠŸ git add \u003cfilename\u003e ## åœ¨åˆå¹¶æ”¹åŠ¨ä¹‹å‰ï¼Œä½ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤é¢„è§ˆå·®å¼‚ git diff \u003csource_branch\u003e \u003ctarget_branch\u003e æ ‡ç­¾ ## åˆ›å»ºä¸€ä¸ª 1.00 çš„æ ‡ç­¾ git tag 1.0.0 1b2e1d63ff ## 1b2e1d63ff æ˜¯ä½ æƒ³è¦æ ‡è®°çš„æäº¤ ID çš„å‰ 10 ä½å­—ç¬¦ã€‚å¯ä»¥ä½¿ç”¨ä¸‹åˆ—å‘½ä»¤è·å–æäº¤ ID git log log ## æœ¬åœ°ä»“åº“çš„å†å²è®°å½• git log ## åªçœ‹æŸäººçš„æäº¤è®°å½• git log --author=bob ## ä¸€ä¸ªå‹ç¼©åçš„æ¯ä¸€æ¡æäº¤è®°å½•åªå ä¸€è¡Œè¾“å‡º git log --pretty=oneline ## é€šè¿‡ ASCII è‰ºæœ¯çš„æ ‘å½¢ç»“æ„æ¥å±•ç¤ºæ‰€æœ‰çš„åˆ†æ”¯ git log --graph --oneline --decorate --all ## æŸ¥çœ‹é‚£äº›æ–‡ä»¶æ”¹å˜äº† git log --name-status æ›¿æ¢æœ¬åœ°æ”¹åŠ¨ ## æ›¿æ¢æ‰æœ¬åœ°çš„æ”¹åŠ¨ git checkout -- \u003cfilename\u003e ## ä¸¢å¼ƒæœ¬åœ°æ‰€æœ‰çš„æ”¹åŠ¨å’Œæäº¤ï¼Œå¯ä»¥åˆ°æœåŠ¡å™¨ä¸Šè·å–æœ€æ–°çš„ç‰ˆæœ¬å†å²ï¼Œå¹¶å°†ä½ æœ¬åœ°ä¸»åˆ†æ”¯æŒ‡å‘å®ƒ git fetch origin git reset --hard origin/master ","date":"2023-06-03","objectID":"/git-skill/:1:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"å›åˆ°è¿œç¨‹ä»“åº“çš„çŠ¶æ€ æŠ›å¼ƒæœ¬åœ°æ‰€æœ‰çš„ä¿®æ”¹ï¼Œå›åˆ°è¿œç¨‹ä»“åº“çš„çŠ¶æ€çš„ git fetch --all \u0026\u0026 git reset --hard origin/master ","date":"2023-06-03","objectID":"/git-skill/:2:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"é‡è®¾ç¬¬ä¸€ä¸ª commit æŠŠæ‰€æœ‰çš„ä¿®æ”¹éƒ½é‡æ–°æ”¾å›å·¥ä½œåŒºï¼Œ å¹¶æ¸…ç©ºæ‰€æœ‰çš„ commitï¼Œ è¿™æ ·å¯ä»¥é‡æ–°æäº¤ç¬¬ä¸€ä¸ªcommit git update-ref -d HEAD ","date":"2023-06-03","objectID":"/git-skill/:3:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"æŸ¥çœ‹å†²çªæ–‡ä»¶åˆ—è¡¨ å±•ç¤ºå·¥ä½œåŒºçš„å†²çªæ–‡ä»¶åˆ—è¡¨ git diff --name-only --diff-filter=U ","date":"2023-06-03","objectID":"/git-skill/:4:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"å±•ç¤ºå·¥ä½œåŒºå’Œæš‚å­˜åŒºçš„ä¸åŒ ## è¾“å‡º**å·¥ä½œåŒº**å’Œ**æš‚å­˜åŒº**çš„ different git diif ## è¿˜å¯ä»¥å±•ç¤ºæœ¬åœ°ä»“åº“ä¸­ä»»æ„ä¸¤ä¸ª commit ä¹‹é—´çš„æ–‡ä»¶å˜åŠ¨ git diff \u003ccommit-id\u003e \u003ccommit-id\u003e ","date":"2023-06-03","objectID":"/git-skill/:5:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"å±•ç¤ºæš‚å­˜åŒºå’Œæœ€è¿‘ç‰ˆæœ¬çš„ä¸åŒ ## è¾“å‡ºæš‚å­˜åŒºå’Œæœ¬åœ°æœ€è¿‘çš„ç‰ˆæœ¬ (commit) çš„ different (ä¸åŒ) git diff --cached ","date":"2023-06-03","objectID":"/git-skill/:6:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"å¿«é€Ÿåˆ‡æ¢åˆ°ä¸Šä¸€ä¸ªåˆ†æ”¯ git checkout - ","date":"2023-06-03","objectID":"/git-skill/:7:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"åˆ é™¤å·²ç»åˆå¹¶åˆ° master çš„åˆ†æ”¯ git branch --merged master | grep -v '^\\*\\| master' | xargs -n 1 git branch -d ","date":"2023-06-03","objectID":"/git-skill/:8:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"å±•ç¤ºæœ¬åœ°åˆ†æ”¯å…³è”è¿œç¨‹ä»“åº“çš„æƒ…å†µ git branch -vv ","date":"2023-06-03","objectID":"/git-skill/:9:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"å…³è”è¿œç¨‹åˆ†æ”¯ ## å…³è”ä¹‹åï¼Œgit branch -vv å°±å¯ä»¥å±•ç¤ºå…³è”çš„è¿œç¨‹åˆ†æ”¯åäº†ï¼ŒåŒæ—¶æ¨é€åˆ°è¿œç¨‹ä»“åº“ç›´æ¥ï¼šgit pushï¼Œä¸éœ€è¦æŒ‡å®šè¿œç¨‹ä»“åº“ git branch -u origin/mybranch ## æˆ–è€…åœ¨ push æ—¶åŠ ä¸Š -u å‚æ•° git push origin/mybranch -u ","date":"2023-06-03","objectID":"/git-skill/:10:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"åˆ—å‡ºæ‰€æœ‰çš„è¿œç¨‹åˆ†æ”¯ ## -r å‚æ•°ç›¸å½“äºï¼šremote git branch -r ","date":"2023-06-03","objectID":"/git-skill/:11:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"åˆ—å‡ºæœ¬åœ°å’Œè¿œç¨‹åˆ†æ”¯ ## -a å‚æ•°ç›¸å½“äºï¼šall git branch -a ","date":"2023-06-03","objectID":"/git-skill/:12:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯å’Œæœ¬åœ°åˆ†æ”¯çš„å¯¹åº”å…³ç³» git remote show origin ","date":"2023-06-03","objectID":"/git-skill/:13:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"è¿œç¨‹åˆ é™¤äº†åˆ†æ”¯æœ¬åœ°ä¹Ÿæƒ³åˆ é™¤ git remote prune origin ","date":"2023-06-03","objectID":"/git-skill/:14:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"åˆ›å»ºå¹¶åˆ‡æ¢åˆ°æœ¬åœ°åˆ†æ”¯ git checkout -b \u003cbranch-name\u003e ","date":"2023-06-03","objectID":"/git-skill/:15:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"ä»è¿œç¨‹åˆ†æ”¯ä¸­åˆ›å»ºå¹¶åˆ‡æ¢åˆ°æœ¬åœ°åˆ†æ”¯ git checkout -b \u003cbranch-name\u003e origin/\u003cbranch-name\u003e ","date":"2023-06-03","objectID":"/git-skill/:16:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"åˆ é™¤æœ¬åœ°åˆ†æ”¯ git branch -d \u003clocal-branchname\u003e ","date":"2023-06-03","objectID":"/git-skill/:17:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"åˆ é™¤è¿œç¨‹åˆ†æ”¯ git push origin --delete \u003cremote-branchname\u003e ## æˆ–è€… git push origin :\u003cremote-branchname\u003e ","date":"2023-06-03","objectID":"/git-skill/:18:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"é‡å‘½åæœ¬åœ°åˆ†æ”¯ git branch -m \u003cnew-branch-name\u003e ","date":"2023-06-03","objectID":"/git-skill/:19:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"æŸ¥çœ‹æ ‡ç­¾ git tag ## å±•ç¤ºå½“å‰åˆ†æ”¯çš„æœ€è¿‘çš„ tag git describe --tags --abbrev=0 ","date":"2023-06-03","objectID":"/git-skill/:20:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"æŸ¥çœ‹æ ‡ç­¾çš„è¯¦ç»†ä¿¡æ¯ git tag -ln ","date":"2023-06-03","objectID":"/git-skill/:21:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"æœ¬åœ°åˆ›å»ºæ ‡ç­¾ git tag \u003cversion-number\u003e ## é»˜è®¤ tag æ˜¯æ‰“åœ¨æœ€è¿‘çš„ä¸€æ¬¡ commit ä¸Šï¼Œå¦‚æœéœ€è¦æŒ‡å®š commit æ‰“ tagï¼š $ git tag -a \u003cversion-number\u003e -m \"v1.0 å‘å¸ƒ(æè¿°)\" \u003ccommit-id\u003e ","date":"2023-06-03","objectID":"/git-skill/:22:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"æ¨é€æ ‡ç­¾åˆ°è¿œç¨‹ä»“åº“ ## é¦–å…ˆè¦ä¿è¯æœ¬åœ°åˆ›å»ºå¥½äº†æ ‡ç­¾æ‰å¯ä»¥æ¨é€æ ‡ç­¾åˆ°è¿œç¨‹ä»“åº“ï¼š git push origin \u003clocal-version-number\u003e ## ä¸€æ¬¡æ€§æ¨é€æ‰€æœ‰æ ‡ç­¾ï¼ŒåŒæ­¥åˆ°è¿œç¨‹ä»“åº“ï¼š git push origin --tags ","date":"2023-06-03","objectID":"/git-skill/:23:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"åˆ é™¤æœ¬åœ°æ ‡ç­¾ git tag -d \u003ctag-name\u003e ","date":"2023-06-03","objectID":"/git-skill/:24:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"åˆ é™¤è¿œç¨‹æ ‡ç­¾ git push origin --delete tag \u003ctagname\u003e ","date":"2023-06-03","objectID":"/git-skill/:25:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"åˆ‡å›åˆ°æŸä¸ªæ ‡ç­¾ ## ä¸€èˆ¬ä¸Šçº¿ä¹‹å‰éƒ½ä¼šæ‰“ tagï¼Œå°±æ˜¯ä¸ºäº†é˜²æ­¢ä¸Šçº¿åå‡ºç°é—®é¢˜ï¼Œæ–¹ä¾¿å¿«é€Ÿå›é€€åˆ°ä¸Šä¸€ç‰ˆæœ¬ã€‚ä¸‹é¢çš„å‘½ä»¤æ˜¯å›åˆ°æŸä¸€æ ‡ç­¾ä¸‹çš„çŠ¶æ€ git checkout -b branch_name tag_name ","date":"2023-06-03","objectID":"/git-skill/:26:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"æ”¾å¼ƒå·¥ä½œåŒºçš„ä¿®æ”¹ git checkout \u003cfile-name\u003e ## æˆ–è€…æ”¾å¼ƒæ‰€æœ‰ä¿®æ”¹ git checkout . ","date":"2023-06-03","objectID":"/git-skill/:27:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"æ¢å¤åˆ é™¤çš„æ–‡ä»¶ #å¾—åˆ° deleting_commit git rev-list -n 1 HEAD -- \u003cfile_path\u003e #å›åˆ°åˆ é™¤æ–‡ä»¶ deleting_commit ä¹‹å‰çš„çŠ¶æ€ git checkout \u003cdeleting_commit\u003e^ -- \u003cfile_path\u003e ","date":"2023-06-03","objectID":"/git-skill/:28:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"ä»¥æ–°å¢ä¸€ä¸ª commit çš„æ–¹å¼è¿˜åŸæŸä¸€ä¸ª commit çš„ä¿®æ”¹ git revert \u003ccommit-id\u003e ","date":"2023-06-03","objectID":"/git-skill/:29:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"å›åˆ°æŸä¸ª commit çš„çŠ¶æ€ï¼Œå¹¶åˆ é™¤åé¢çš„ commit ## å’Œ revert çš„åŒºåˆ«ï¼šreset å‘½ä»¤ä¼šæŠ¹å»æŸä¸ª commit id ä¹‹åçš„æ‰€æœ‰ commit git reset \u003ccommit-id\u003e #é»˜è®¤å°±æ˜¯-mixedå‚æ•°ã€‚ git reset --mixed HEAD^ #å›é€€è‡³ä¸Šä¸ªç‰ˆæœ¬ï¼Œå®ƒå°†é‡ç½®HEADåˆ°å¦å¤–ä¸€ä¸ªcommit,å¹¶ä¸”é‡ç½®æš‚å­˜åŒºä»¥ä¾¿å’ŒHEADç›¸åŒ¹é…ï¼Œä½†æ˜¯ä¹Ÿåˆ°æ­¤ä¸ºæ­¢ã€‚å·¥ä½œåŒºä¸ä¼šè¢«æ›´æ”¹ã€‚ git reset --soft HEAD~3 #å›é€€è‡³ä¸‰ä¸ªç‰ˆæœ¬ä¹‹å‰ï¼Œåªå›é€€äº†commitçš„ä¿¡æ¯ï¼Œæš‚å­˜åŒºå’Œå·¥ä½œåŒºä¸å›é€€ä¹‹å‰ä¿æŒä¸€è‡´ã€‚å¦‚æœè¿˜è¦æäº¤ï¼Œç›´æ¥commitå³å¯ git reset --hard \u003ccommit-id\u003e #å½»åº•å›é€€åˆ°æŒ‡å®šcommit-idçš„çŠ¶æ€ï¼Œæš‚å­˜åŒºå’Œå·¥ä½œåŒºä¹Ÿä¼šå˜ä¸ºæŒ‡å®šcommit-idç‰ˆæœ¬çš„å†…å®¹ ","date":"2023-06-03","objectID":"/git-skill/:30:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"ä¿®æ”¹ä¸Šä¸€ä¸ª commit çš„æè¿° ## å¦‚æœæš‚å­˜åŒºæœ‰æ”¹åŠ¨ï¼ŒåŒæ—¶ä¹Ÿä¼šå°†æš‚å­˜åŒºçš„æ”¹åŠ¨æäº¤åˆ°ä¸Šä¸€ä¸ª commit git commit --amend ","date":"2023-06-03","objectID":"/git-skill/:31:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"æŸ¥çœ‹ commit å†å² git log ","date":"2023-06-03","objectID":"/git-skill/:32:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"æŸ¥çœ‹æŸæ®µä»£ç æ˜¯è°å†™çš„ ## blame çš„æ„æ€ä¸ºâ€˜è´£æ€ªâ€™ï¼Œä½ æ‡‚çš„ã€‚ git blame \u003cfile-name\u003e ","date":"2023-06-03","objectID":"/git-skill/:33:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"æ˜¾ç¤ºæœ¬åœ°æ›´æ–°è¿‡ HEAD çš„ git å‘½ä»¤è®°å½• ## æ¯æ¬¡æ›´æ–°äº† HEAD çš„ git å‘½ä»¤æ¯”å¦‚ commitã€amendã€cherry-pickã€resetã€revert ç­‰éƒ½ä¼šè¢«è®°å½•ä¸‹æ¥ï¼ˆä¸é™åˆ†æ”¯ï¼‰ï¼Œå°±åƒ shell çš„ history ä¸€æ ·ã€‚ è¿™æ ·ä½ å¯ä»¥ reset åˆ°ä»»ä½•ä¸€æ¬¡æ›´æ–°äº† HEAD çš„æ“ä½œä¹‹åï¼Œè€Œä¸ä»…ä»…æ˜¯å›åˆ°å½“å‰åˆ†æ”¯ä¸‹çš„æŸä¸ª commit ä¹‹åçš„çŠ¶æ€ git reflog ","date":"2023-06-03","objectID":"/git-skill/:34:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"ä¿®æ”¹ä½œè€…å git commit --amend --author='Author Name \u003cemail@address.com\u003e' ","date":"2023-06-03","objectID":"/git-skill/:35:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"ä¿®æ”¹è¿œç¨‹ä»“åº“çš„ url git remote set-url origin \u003cURL\u003e ","date":"2023-06-03","objectID":"/git-skill/:36:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"å¢åŠ è¿œç¨‹ä»“åº“ git remote add origin \u003cremote-url\u003e ","date":"2023-06-03","objectID":"/git-skill/:37:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"åˆ—å‡ºæ‰€æœ‰è¿œç¨‹ä»“åº“ git remote ","date":"2023-06-03","objectID":"/git-skill/:38:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"æŸ¥çœ‹ä¸¤ä¸ªæ˜ŸæœŸå†…çš„æ”¹åŠ¨ git whatchanged --since='2 weeks ago' ","date":"2023-06-03","objectID":"/git-skill/:39:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"æŠŠ A åˆ†æ”¯çš„æŸä¸€ä¸ª commitï¼Œæ”¾åˆ° B åˆ†æ”¯ä¸Š ## è¿™ä¸ªè¿‡ç¨‹éœ€è¦ cherry-pick å‘½ä»¤ git checkout \u003cbranch-name\u003e \u0026\u0026 git cherry-pick \u003ccommit-id\u003e ","date":"2023-06-03","objectID":"/git-skill/:40:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"ç»™ git å‘½ä»¤èµ·åˆ«å git config --global alias.\u003chandle\u003e \u003ccommand\u003e æ¯”å¦‚ï¼šgit status æ”¹æˆ git stï¼Œè¿™æ ·å¯ä»¥ç®€åŒ–å‘½ä»¤ git config --global alias.st status ","date":"2023-06-03","objectID":"/git-skill/:41:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"å­˜å‚¨å½“å‰çš„ä¿®æ”¹ï¼Œä½†ä¸ç”¨æäº¤ commit è¯¦è§£å¯ä»¥å‚è€ƒå»–é›ªå³°è€å¸ˆçš„ git æ•™ç¨‹ https://www.liaoxuefeng.com/wiki/896043488029600/900388704535136 git stash ","date":"2023-06-03","objectID":"/git-skill/:42:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"ä¿å­˜å½“å‰çŠ¶æ€ï¼ŒåŒ…æ‹¬ untracked çš„æ–‡ä»¶ ## untracked æ–‡ä»¶ï¼šæ–°å»ºçš„æ–‡ä»¶ git stash -u ## å±•ç¤ºæ‰€æœ‰ stashes git stash list ## å›åˆ°æŸä¸ª stash çš„çŠ¶æ€ git stash apply \u003cstash@{n}\u003e ## å›åˆ°æœ€åä¸€ä¸ª stash çš„çŠ¶æ€ï¼Œå¹¶åˆ é™¤è¿™ä¸ª stash git stash pop ## åˆ é™¤æ‰€æœ‰çš„ stash git stash clear ## ä» stash ä¸­æ‹¿å‡ºæŸä¸ªæ–‡ä»¶çš„ä¿®æ”¹ git checkout \u003cstash@{n}\u003e -- \u003cfile-path\u003e ## å±•ç¤ºæ‰€æœ‰ tracked çš„æ–‡ä»¶ git ls-files -t ## å±•ç¤ºæ‰€æœ‰ untracked çš„æ–‡ä»¶ git ls-files --others ","date":"2023-06-03","objectID":"/git-skill/:43:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"å±•ç¤ºæ‰€æœ‰å¿½ç•¥çš„æ–‡ä»¶ git ls-files --others -i --exclude-standard ","date":"2023-06-03","objectID":"/git-skill/:44:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"å±•ç¤ºç®€åŒ–çš„ commit å†å² git log --pretty=oneline --graph --decorate --all ","date":"2023-06-03","objectID":"/git-skill/:45:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"æŠŠæŸä¸€ä¸ªåˆ†æ”¯å¯¼å‡ºæˆä¸€ä¸ªæ–‡ä»¶ git bundle create \u003cfile\u003e \u003cbranch-name\u003e ","date":"2023-06-03","objectID":"/git-skill/:46:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"ä»åŒ…ä¸­å¯¼å…¥åˆ†æ”¯ ## æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼Œåˆ†æ”¯å†…å®¹å°±æ˜¯ä¸Šé¢ git bundle create å‘½ä»¤å¯¼å‡ºçš„å†…å®¹ git clone repo.bundle \u003crepo-dir\u003e -b \u003cbranch-name\u003e ","date":"2023-06-03","objectID":"/git-skill/:47:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"ä»è¿œç¨‹ä»“åº“æ ¹æ® IDï¼Œæ‹‰ä¸‹æŸä¸€çŠ¶æ€ï¼Œåˆ°æœ¬åœ°åˆ†æ”¯ git fetch origin pull/\u003cid\u003e/head:\u003cbranch-name\u003e ","date":"2023-06-03","objectID":"/git-skill/:48:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"æ¸…é™¤ gitignore æ–‡ä»¶ä¸­è®°å½•çš„æ–‡ä»¶ git clean -X -f ","date":"2023-06-03","objectID":"/git-skill/:49:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"å±•ç¤ºæ‰€æœ‰ alias å’Œ configs ## æ³¨æ„ï¼š config åˆ†ä¸ºï¼šå½“å‰ç›®å½•ï¼ˆlocalï¼‰å’Œå…¨å±€ï¼ˆgolbalï¼‰çš„ configï¼Œé»˜è®¤ä¸ºå½“å‰ç›®å½•çš„ config git config --local --list (å½“å‰ç›®å½•) git config --global --list (å…¨å±€) ","date":"2023-06-03","objectID":"/git-skill/:50:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"å±•ç¤ºå¿½ç•¥çš„æ–‡ä»¶ git status --ignored ","date":"2023-06-03","objectID":"/git-skill/:51:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"åˆ é™¤å…¨å±€è®¾ç½® git config --global --unset \u003centry-name\u003e ","date":"2023-06-03","objectID":"/git-skill/:52:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"æ–°å»ºå¹¶åˆ‡æ¢åˆ°æ–°åˆ†æ”¯ä¸Šï¼ŒåŒæ—¶è¿™ä¸ªåˆ†æ”¯æ²¡æœ‰ä»»ä½• commit ## ç›¸å½“äºä¿å­˜ä¿®æ”¹ï¼Œä½†æ˜¯é‡å†™ commit å†å² git checkout --orphan \u003cbranch-name\u003e ","date":"2023-06-03","objectID":"/git-skill/:53:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"git checkout â€“orphan git show \u003cbranch-name\u003e:\u003cfile-name\u003e ","date":"2023-06-03","objectID":"/git-skill/:54:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"clone ä¸‹æ¥æŒ‡å®šçš„å•ä¸€åˆ†æ”¯ git clone -b \u003cbranch-name\u003e --single-branch https://github.com/user/repo.git ","date":"2023-06-03","objectID":"/git-skill/:55:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"å¿½ç•¥æ–‡ä»¶çš„æƒé™å˜åŒ– ## ä¸å†å°†æ–‡ä»¶çš„æƒé™å˜åŒ–è§†ä½œæ”¹åŠ¨ git config core.fileMode false ","date":"2023-06-03","objectID":"/git-skill/:56:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"åœ¨ commit log ä¸­æŸ¥æ‰¾ç›¸å…³å†…å®¹ ## é€šè¿‡ grep æŸ¥æ‰¾ï¼Œgiven-textï¼šæ‰€éœ€è¦æŸ¥æ‰¾çš„å­—æ®µ git log --all --grep='\u003cgiven-text\u003e' ","date":"2023-06-03","objectID":"/git-skill/:57:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"æŠŠæš‚å­˜åŒºçš„æŒ‡å®š file æ”¾åˆ°å·¥ä½œåŒºä¸­ ## ä¸æ·»åŠ å‚æ•°ï¼Œé»˜è®¤æ˜¯ -mixed git reset \u003cfile-name\u003e ","date":"2023-06-03","objectID":"/git-skill/:58:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":"å¼ºåˆ¶æ¨é€ git push -f \u003cremote-name\u003e \u003cbranch-name\u003e ","date":"2023-06-03","objectID":"/git-skill/:59:0","tags":["git"],"title":"Git Skill","uri":"/git-skill/"},{"categories":["æ–‡æ¡£"],"content":" go-work (figure) ğŸ”¥Golangç®—æ³• - é€’å½’ é€’å½’ï¼š åœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­è°ƒç”¨è‡ªå·± ","date":"2023-05-30","objectID":"/golang-recursion01/:0:0","tags":["golang","ç®—æ³•"],"title":"ğŸ”¥Golang Recursion","uri":"/golang-recursion01/"},{"categories":["æ–‡æ¡£"],"content":"é€’å½’å‡½æ•° å…³é”®ç‚¹ åœ¨åŒä¸€å‡½æ•°è°ƒç”¨çš„å‡½æ•° åœ¨é€’å½’å‡½æ•°ä¸­æŒ‡å®šä¸€ä¸ªé€€å‡ºæ¡ä»¶æ€»æ˜¯å¥½çš„ å®ƒå¯ä»¥æ£€æŸ¥ä¸å¿…è¦çš„å‡½æ•°è°ƒç”¨å’Œä»£ç è¡Œ é€’å½’çš„ç¼ºç‚¹ ä»£ç é€»è¾‘æ€§å¼ºï¼Œ éš¾ä»¥è°ƒè¯•å’Œä»£ç æ£€æŸ¥ go-work (figure) ç¤ºä¾‹ package main import \"fmt\" func main() { doll := Item{ ID: 1, Type: \"doll\", Child: \u0026Item{ ID: 2, Type: \"doll\", Child: \u0026Item{ ID: 3, Type: \"doll\", Child: \u0026Item{ ID: 4, Type: \"diamond\", Child: nil, }, }, }, } diamond := findDiamond(doll) fmt.Printf(\"Item %d is diamond\\n\", diamond.ID) } func findDiamond(item Item) Item { if item.IsDoll() { return findDiamond(*item.Child) } else { return item } } type Item struct { ID int Type string Child *Item } type ItemClassifier interface { IsDoll() bool } func (it *Item) IsDoll() bool { if it.Type == \"doll\" { return true } return false } è¾“å‡ºç»“æœ go run main.go Item 4 is diamond ç¤ºä¾‹äºŒ ï¼ˆé€’å½’å‡½æ•°å®ç°æ–æ³¢é‚£å¥‘æ•°ï¼‰ package main import \"fmt\" func fibonacci(n int) int { if n \u003c 2 { return n } return fibonacci(n-2) + fibonacci(n-1) } func main() { var i int for i = 0; i \u003c 10; i++ { fmt.Printf(\"%d\\t\", fibonacci(i)) } } ","date":"2023-05-30","objectID":"/golang-recursion01/:1:0","tags":["golang","ç®—æ³•"],"title":"ğŸ”¥Golang Recursion","uri":"/golang-recursion01/"},{"categories":["æ–‡æ¡£"],"content":" go-work (figure) Golang context å®ç°åŸç† contextçš„ä¸»è¦åŠŸèƒ½ å¼‚æ­¥åœºæ™¯ä¸­ç”¨äºå®ç°å¹¶å‘åè°ƒ å¯¹goroutine çš„ç”Ÿå‘½å‘¨æœŸæ§åˆ¶ æœ‰ä¸€å®šçš„æ•°æ®å­˜å‚¨èƒ½åŠ› context çš„æ•°æ®ç»“æ„ type Context interface { Deadline() (deadline time.Time, ok bool) Done() \u003c-chan struct{} Err() error Value(key any) any } Context ä¸ºinterfaceï¼Œ å®šä¹‰äº†å››ä¸ªæ ¸å¿ƒapi Deadlineï¼š è¿”å›contextçš„è¿‡æœŸæ—¶é—´ Doneï¼š è¿”å›contextä¸­çš„channel Errï¼š è¿”å›é”™è¯¯ valueï¼š è¿”å›contextä¸­çš„å¯¹åº”çš„keyå€¼ ","date":"2023-05-29","objectID":"/golang-context/:0:0","tags":["golang"],"title":"Golang Context åº•å±‚åŸç†","uri":"/golang-context/"},{"categories":["æ–‡æ¡£"],"content":"æ ‡å‡† error var Canceled = errors.New(\"context canceled\") var DeadlineExceeded error = deadlineExceededError{} type deadlineExceededError struct{} func (deadlineExceededError) Error() string { return \"context deadline exceeded\" } func (deadlineExceededError) Timeout() bool { return true } func (deadlineExceededError) Temporary() bool { return true canceledï¼š context è¢«canelæ—¶ä¼šæŠ¥æ­¤é”™è¯¯ DeadlineExceeded: context è¶…æ—¶æ—¶ä¼šæŠ¥æ­¤é”™è¯¯ ","date":"2023-05-29","objectID":"/golang-context/:0:1","tags":["golang"],"title":"Golang Context åº•å±‚åŸç†","uri":"/golang-context/"},{"categories":["æ–‡æ¡£"],"content":"emptyCtx ç±»çš„å®ç° type emptyCtx int func (*emptyCtx) Deadline() (deadline time.Time, ok bool) { return } func (*emptyCtx) Done() \u003c-chan struct{} { return nil } func (*emptyCtx) Err() error { return nil } func (*emptyCtx) Value(key any) any { return } emptyCtxæ—¶ä¸€ä¸ªç©ºçš„contextï¼Œ æœ¬è´¨ä¸Šç±»å‹ä¸ºä¸€ä¸ªæ•´å‹ Deadline æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªå…¬å…ƒå…ƒå¹´æ—¶é—´ä»¥åŠ false çš„ flagï¼Œæ ‡è¯†å½“å‰ context ä¸å­˜åœ¨è¿‡æœŸæ—¶é—´ï¼› Doneï¼š æ–¹æ³•è¿”å›ä¸€ä¸ªnil å€¼ï¼Œç”¨æˆ·æ— è®ºåœ¨nilä¸­å†™å…¥æˆ–è€…è¯»å–æ•°æ®ï¼Œéƒ½ä¼šé™·å…¥é˜»å¡ Errï¼š æ–¹æ³•è¿”å›çš„é”™è¯¯æ°¸è¿œä¸ºnil Valueï¼š æ–¹æ³•è¿”å›çš„valueåŒæ ·æ°¸è¿œä¸ºnil ","date":"2023-05-29","objectID":"/golang-context/:0:2","tags":["golang"],"title":"Golang Context åº•å±‚åŸç†","uri":"/golang-context/"},{"categories":["æ–‡æ¡£"],"content":"context.Background() \u0026 context.TODO() var ( background = new(emptyCtx) todo = new(emptyCtx) ) func Background() Context { return background } func TODO() Context { return todo } å¸¸ç”¨çš„ context.Background() å’Œ context.TODO() æ–¹æ³•è¿”å›çš„å‡æ˜¯ emptyCtx ç±»å‹çš„ä¸€ä¸ªå®ä¾‹. ","date":"2023-05-29","objectID":"/golang-context/:0:3","tags":["golang"],"title":"Golang Context åº•å±‚åŸç†","uri":"/golang-context/"},{"categories":["æ–‡æ¡£"],"content":"cancelCtx æ•°æ®ç»“æ„ go-work (figure) type cancelCtx struct { Context mu sync.Mutex // protects following fields done atomic.Value // of chan struct{}, created lazily, closed by first cancel call children map[canceler]struct{} // set to nil by the first cancel call err error // set to non-nil by the first cancel call } type canceler interface { cancel(removeFromParent bool, err error) Done() \u003c-chan struct{} } embed äº†contextä½œä¸ºå…¶çˆ¶contextï¼Œ cancelCtxå¿…ç„¶ä¸ºæŸä¸ªcontextçš„å­context å†…ç½®äº†ä¸€æŠŠé”ï¼Œ ç”¨ä»¥åè°ƒå¹¶å‘åœºæ™¯ä¸‹çš„èµ„æºè·å– doneï¼š å®é™…ç±»å‹ä¸ºchan struct{}, å³ç”¨ä»¥åæ˜  cancelCtxç”Ÿå‘½å‘¨æœŸçš„é€šé“ childrenï¼š ä¸€ä¸ªset æŒ‡cancelCtx çš„æ‰€æœ‰å­context errï¼š è®°å½•äº†å½“å‰cancelCtxçš„é”™è¯¯ï¼Œ å¿…ç„¶ä¸ºæŸä¸€ä¸ªcontextçš„å­context ","date":"2023-05-29","objectID":"/golang-context/:1:0","tags":["golang"],"title":"Golang Context åº•å±‚åŸç†","uri":"/golang-context/"},{"categories":["æ–‡æ¡£"],"content":"Deadline æ–¹æ³• cancelCtx æœªå®ç°è¯¥æ–¹æ³•ï¼Œ ä»…æ—¶embedäº†ä¸€ä¸ªå¸¦æœ‰ Deadline æ–¹æ³•çš„Context interface å› æ­¤ç›´æ¥ è°ƒç”¨ä¼šæŠ¥é”™ ","date":"2023-05-29","objectID":"/golang-context/:1:1","tags":["golang"],"title":"Golang Context åº•å±‚åŸç†","uri":"/golang-context/"},{"categories":["æ–‡æ¡£"],"content":"Done æ–¹æ³• go-work (figure) func (c *cancelCtx) Done() \u003c-chan struct{} { d := c.done.Load() if d != nil { return d.(chan struct{}) } c.mu.Lock() defer c.mu.Unlock() d = c.done.Load() if d == nil { d = make(chan struct{}) c.done.Store(d) } return d.(chan struct{}) } åŸºäºatomic åŒ…ï¼Œ è¯»å– cancelCtxä¸­çš„chanï¼› å€˜è‹¥å·²å­˜åœ¨ï¼Œåˆ™ç›´æ¥è¿”å› åŠ é”åï¼Œ åœ¨æ­¤æ£€æŸ¥chanæ˜¯å¦å­˜åœ¨ï¼Œ è‹¥å­˜åœ¨åˆ™è¿”å›ï¼Œ åˆå§‹åŒ– chan å­˜å‚¨åˆ° aotmic.Value å½“ä¸­ï¼Œå¹¶è¿”å›.ï¼ˆæ‡’åŠ è½½æœºåˆ¶ï¼‰ ","date":"2023-05-29","objectID":"/golang-context/:1:2","tags":["golang"],"title":"Golang Context åº•å±‚åŸç†","uri":"/golang-context/"},{"categories":["æ–‡æ¡£"],"content":"Err æ–¹æ³• func (c *cancelCtx) Err() error { c.mu.Lock() err := c.err c.mu.Unlock() return err } åŠ é”ï¼› è¯»å– cancelCtx.errï¼› è§£é” è¿”å›ç»“æœ ","date":"2023-05-29","objectID":"/golang-context/:1:3","tags":["golang"],"title":"Golang Context åº•å±‚åŸç†","uri":"/golang-context/"},{"categories":["æ–‡æ¡£"],"content":"Valueæ–¹æ³• func (c *cancelCtx) Value(key any) any { if key == \u0026cancelCtxKey { return c } return value(c.Context, key) } å€˜è‹¥ key ç‰¹å®šå€¼ \u0026cancelCtxKeyï¼Œåˆ™è¿”å› cancelCtx è‡ªèº«çš„æŒ‡é’ˆï¼› å¦åˆ™éµå¾ª valueCtx çš„æ€è·¯å–å€¼è¿”å› ","date":"2023-05-29","objectID":"/golang-context/:1:4","tags":["golang"],"title":"Golang Context åº•å±‚åŸç†","uri":"/golang-context/"},{"categories":["æ–‡æ¡£"],"content":"context.WithCancel() func WithCancel(parent Context) (ctx Context, cancel CancelFunc) { if parent == nil { panic(\"cannot create context from nil parent\") } c := newCancelCtx(parent) propagateCancel(parent, \u0026c) return \u0026c, func() { c.cancel(true, Canceled) } } æ ¡éªŒçˆ¶ context éç©ºï¼› æ³¨å…¥çˆ¶ context æ„é€ å¥½ä¸€ä¸ªæ–°çš„ cancelCtxï¼› åœ¨ propagateCancel æ–¹æ³•å†…å¯åŠ¨ä¸€ä¸ªå®ˆæŠ¤åç¨‹ï¼Œä»¥ä¿è¯çˆ¶ context ç»ˆæ­¢æ—¶ï¼Œè¯¥ cancelCtx ä¹Ÿä¼šè¢«ç»ˆæ­¢ï¼› å°† cancelCtx è¿”å›ï¼Œè¿å¸¦è¿”å›ä¸€ä¸ªç”¨ä»¥ç»ˆæ­¢è¯¥ cancelCtx çš„é—­åŒ…å‡½æ•°. ","date":"2023-05-29","objectID":"/golang-context/:2:0","tags":["golang"],"title":"Golang Context åº•å±‚åŸç†","uri":"/golang-context/"},{"categories":["æ–‡æ¡£"],"content":"newCancelCtx func newCancelCtx(parent Context) cancelCtx { return cancelCtx{Context: parent} } ","date":"2023-05-29","objectID":"/golang-context/:2:1","tags":["golang"],"title":"Golang Context åº•å±‚åŸç†","uri":"/golang-context/"},{"categories":["æ–‡æ¡£"],"content":"propagateCancel go-work (figure) func propagateCancel(parent Context, child canceler) { done := parent.Done() if done == nil { return // parent is never canceled } select { case \u003c-done: // parent is already canceled child.cancel(false, parent.Err()) return default: } if p, ok := parentCancelCtx(parent); ok { p.mu.Lock() if p.err != nil { // parent has already been canceled child.cancel(false, p.err) } else { if p.children == nil { p.children = make(map[canceler]struct{}) } p.children[child] = struct{}{} } p.mu.Unlock() } else { atomic.AddInt32(\u0026goroutines, +1) go func() { select { case \u003c-parent.Done(): child.cancel(false, parent.Err()) case \u003c-child.Done(): } }() } } propagateCancel ç”¨ä»¥ä¼ é€’çˆ¶å­ context ä¹‹é—´çš„ cancel äº‹ä»¶ï¼š â€¢ å€˜è‹¥ parent æ˜¯ä¸ä¼šè¢« cancel çš„ç±»å‹ï¼ˆå¦‚ emptyCtxï¼‰ï¼Œåˆ™ç›´æ¥è¿”å›ï¼› â€¢ å€˜è‹¥ parent å·²ç»è¢« cancelï¼Œåˆ™ç›´æ¥ç»ˆæ­¢å­ contextï¼Œå¹¶ä»¥ parent çš„ err ä½œä¸ºå­ context çš„ errï¼› â€¢ å‡å¦‚ parent æ˜¯ cancelCtx çš„ç±»å‹ï¼Œåˆ™åŠ é”ï¼Œå¹¶å°†å­ context æ·»åŠ åˆ° parent çš„ children map å½“ä¸­ï¼› â€¢ å‡å¦‚ parent ä¸æ˜¯ cancelCtx ç±»å‹ï¼Œä½†åˆå­˜åœ¨ cancel çš„èƒ½åŠ›ï¼ˆæ¯”å¦‚ç”¨æˆ·è‡ªå®šä¹‰å®ç°çš„ contextï¼‰ï¼Œåˆ™å¯åŠ¨ä¸€ä¸ªåç¨‹ï¼Œé€šè¿‡å¤šè·¯å¤ç”¨çš„æ–¹å¼ç›‘æ§ parent çŠ¶æ€ï¼Œå€˜è‹¥å…¶ç»ˆæ­¢ï¼Œåˆ™åŒæ—¶ç»ˆæ­¢å­ contextï¼Œå¹¶é€ä¼  parent çš„ err. ","date":"2023-05-29","objectID":"/golang-context/:2:2","tags":["golang"],"title":"Golang Context åº•å±‚åŸç†","uri":"/golang-context/"},{"categories":["æ–‡æ¡£"],"content":"cancelCtx.cancel go-work (figure) func (c *cancelCtx) cancel(removeFromParent bool, err error) { if err == nil { panic(\"context: internal error: missing cancel error\") } c.mu.Lock() if c.err != nil { c.mu.Unlock() return // already canceled } c.err = err d, _ := c.done.Load().(chan struct{}) if d == nil { c.done.Store(closedchan) } else { close(d) } for child := range c.children { // NOTE: acquiring the child's lock while holding parent's lock. child.cancel(false, err) } c.children = nil c.mu.Unlock() if removeFromParent { removeChild(c.Context, c) } } cancelCtx.cancel æ–¹æ³•æœ‰ä¸¤ä¸ªå…¥å‚ï¼Œç¬¬ä¸€ä¸ª removeFromParent æ˜¯ä¸€ä¸ª bool å€¼ï¼Œè¡¨ç¤ºå½“å‰ context æ˜¯å¦éœ€è¦ä»çˆ¶ context çš„ children set ä¸­åˆ é™¤ï¼›ç¬¬äºŒä¸ª err åˆ™æ˜¯ cancel åéœ€è¦å±•ç¤ºçš„é”™è¯¯ï¼› è¿›å…¥æ–¹æ³•ä¸»ä½“ï¼Œé¦–å…ˆæ ¡éªŒä¼ å…¥çš„ err æ˜¯å¦ä¸ºç©ºï¼Œè‹¥ä¸ºç©ºåˆ™ panicï¼› åŠ é”ï¼› æ ¡éªŒ cancelCtx è‡ªå¸¦çš„ err æ˜¯å¦å·²ç»éç©ºï¼Œè‹¥éç©ºè¯´æ˜å·²è¢« cancelï¼Œåˆ™è§£é”è¿”å›ï¼› å°†ä¼ å…¥çš„ err èµ‹ç»™ cancelCtx.errï¼› å¤„ç† cancelCtx çš„ channelï¼Œè‹¥ channel æ­¤å‰æœªåˆå§‹åŒ–ï¼Œåˆ™ç›´æ¥æ³¨å…¥ä¸€ä¸ª closedChanï¼Œå¦åˆ™å…³é—­è¯¥ channelï¼› éå†å½“å‰ cancelCtx çš„ children setï¼Œä¾æ¬¡å°† children context éƒ½è¿›è¡Œ cancelï¼› è§£é”. æ ¹æ®ä¼ å…¥çš„ removeFromParent flag åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰‹åŠ¨æŠŠ cancelCtx ä» parent çš„ children set ä¸­ç§»é™¤. removeChild æ–¹æ³•ä¸­ï¼Œè§‚å¯Ÿå¦‚ä½•å°† cancelCtx ä» parent çš„ children set ä¸­ç§»é™¤ï¼š func removeChild(parent Context, child canceler) { p, ok := parentCancelCtx(parent) if !ok { return } p.mu.Lock() if p.children != nil { delete(p.children, child) } p.mu.Unlock() } å¦‚æœ parent ä¸æ˜¯ cancelCtxï¼Œç›´æ¥è¿”å›ï¼ˆå› ä¸ºåªæœ‰ cancelCtx æ‰æœ‰ children setï¼‰ åŠ é”ï¼› ä» parent çš„ children set ä¸­åˆ é™¤å¯¹åº” child è§£é”è¿”å›. ","date":"2023-05-29","objectID":"/golang-context/:3:0","tags":["golang"],"title":"Golang Context åº•å±‚åŸç†","uri":"/golang-context/"},{"categories":["æ–‡æ¡£"],"content":"timerCtxç±» go-work (figure) type timerCtx struct { cancelCtx timer *time.Timer // Under cancelCtx.mu. deadline time.Time } timerCtx åœ¨ cancelCtx åŸºç¡€ä¸Šåˆåšäº†ä¸€å±‚å°è£…ï¼Œé™¤äº†ç»§æ‰¿ cancelCtx çš„èƒ½åŠ›ä¹‹å¤–ï¼Œæ–°å¢äº†ä¸€ä¸ª time.Timer ç”¨äºå®šæ—¶ç»ˆæ­¢ contextï¼›å¦å¤–æ–°å¢äº†ä¸€ä¸ª deadline å­—æ®µç”¨äºå­—æ®µ timerCtx çš„è¿‡æœŸæ—¶é—´ ","date":"2023-05-29","objectID":"/golang-context/:4:0","tags":["golang"],"title":"Golang Context åº•å±‚åŸç†","uri":"/golang-context/"},{"categories":["æ–‡æ¡£"],"content":"valueCtx go-work (figure) type valueCtx struct { Context key, val any } valueCtx åŒæ ·ç»§æ‰¿äº†ä¸€ä¸ª parent contextï¼› ä¸€ä¸ª valueCtx ä¸­ä»…æœ‰ä¸€ç»„ kv å¯¹ ","date":"2023-05-29","objectID":"/golang-context/:5:0","tags":["golang"],"title":"Golang Context åº•å±‚åŸç†","uri":"/golang-context/"},{"categories":["æ–‡æ¡£"],"content":"valueCtx.Value() go-work (figure) func (c *valueCtx) Value(key any) any { if c.key == key { return c.val } return value(c.Context, key) } å‡å¦‚å½“å‰ valueCtx çš„ key ç­‰äºç”¨æˆ·ä¼ å…¥çš„ keyï¼Œåˆ™ç›´æ¥è¿”å›å…¶ valueï¼› å‡å¦‚ä¸ç­‰ï¼Œåˆ™ä» parent context ä¸­ä¾æ¬¡å‘ä¸Šå¯»æ‰¾. func value(c Context, key any) any { for { switch ctx := c.(type) { case *valueCtx: if key == ctx.key { return ctx.val } c = ctx.Context case *cancelCtx: if key == \u0026cancelCtxKey { return c } c = ctx.Context case *timerCtx: if key == \u0026cancelCtxKey { return \u0026ctx.cancelCtx } c = ctx.Context case *emptyCtx: return nil default: return c.Value(key) } } } å¯åŠ¨ä¸€ä¸ª for å¾ªç¯ï¼Œç”±ä¸‹è€Œä¸Šï¼Œç”±å­åŠçˆ¶ï¼Œä¾æ¬¡å¯¹ key è¿›è¡ŒåŒ¹é…ï¼› å…¶ä¸­ cancelCtxã€timerCtxã€emptyCtx ç±»å‹ä¼šæœ‰ç‰¹æ®Šçš„å¤„ç†æ–¹å¼ï¼› æ‰¾åˆ°åŒ¹é…çš„ keyï¼Œåˆ™å°†è¯¥ç»„ value è¿›è¡Œè¿”å› ","date":"2023-05-29","objectID":"/golang-context/:5:1","tags":["golang"],"title":"Golang Context åº•å±‚åŸç†","uri":"/golang-context/"},{"categories":["æ–‡æ¡£"],"content":" go-work (figure) ğŸ”¥Golangç®—æ³•- é€‰æ‹©æ’åºï¼ˆSelection Sort) åœ¨æœªæ’åºåºåˆ—ä¸­æ‰¾åˆ°æœ€å°ï¼ˆå¤§ï¼‰å…ƒç´ ï¼Œå­˜æ”¾åˆ°æ’åºåºåˆ—çš„èµ·å§‹ä½ç½®ï¼Œ ç„¶åï¼Œå†ä»å‰©ä½™æœªæ’åºå…ƒç´ ä¸­ç»§ç»­å¯»æ‰¾æœ€å°ï¼ˆå¤§ï¼‰å…ƒç´ ï¼Œ ç„¶åæ”¾åˆ°å·²æ’åºåºåˆ—çš„æœ«å°¾ã€‚ ä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°æ‰€æœ‰å…ƒç´ å‡æ’åºå®Œæ¯•ã€‚ ç¤ºä¾‹ package main import \"fmt\" func main() { arr := []int{5, 7, 1, 8, 3, 2, 6, 4, 9} arr = selectionSort(arr) fmt.Println(arr) } func findSmallest(arr []int) int { smallest := arr[0] smallestIndex := 0 for i := 0; i \u003c len(arr); i++ { if arr[i] \u003c smallest { smallest = arr[i] smallestIndex = i } } return smallestIndex } func selectionSort(arr []int) []int { result := []int{} count := len(arr) for i := 0; i \u003c count; i++ { smallestIndex := findSmallest(arr) result = append(result, arr[smallestIndex]) arr = append(arr[:smallestIndex], arr[smallestIndex+1:]...) } return result } è¾“å‡ºç»“æœ go run main.go [1 2 3 4 5 6 7 8 9] ","date":"2023-05-29","objectID":"/golang-selectionsort/:0:0","tags":["golang","ç®—æ³•"],"title":"ğŸ”¥Golang Selection Sort","uri":"/golang-selectionsort/"},{"categories":["æ–‡æ¡£"],"content":" ğŸ”¥Golangç®—æ³•- äºŒåˆ†ç®—æ³•ï¼ˆBinary Searchï¼‰ è¾“å…¥ï¼šæ’å¥½åº çš„é›†åˆ å¦‚æœè¦æŸ¥è¯¢çš„å…ƒç´ åœ¨é›†åˆä¸­ï¼š è¿”å›ä½ç½®ï¼ˆç´¢å¼•ï¼‰ å¦åˆ™ï¼šè¿”å›ç©º ","date":"2023-05-27","objectID":"/golang-binarysearch/:0:0","tags":["golang","ç®—æ³•"],"title":"ğŸš€Golang BinarySearch","uri":"/golang-binarysearch/"},{"categories":["æ–‡æ¡£"],"content":"Binary Search ä»‹ç» é’ˆå¯¹æ‹¥æœ‰nä¸ªå…ƒç´ çš„ä¸€æ’åºçš„é›†åˆ äºŒåˆ†æŸ¥æ‰¾ï¼š log2n ç®€å•æŸ¥æ‰¾ï¼š n âš ï¸æ³¨æ„ äºŒåˆ†æŸ¥æ‰¾åªé€‚ç”¨äºå·²æ’åºçš„é›†åˆ ç¤ºä¾‹ package main import ( \"fmt\" \"math/rand\" \"time\" ) func main() { list := make([]int, 1_000_000) for i := 0; i \u003c 1_000_000; i++ { list = append(list, i+1) } rand.Seed(time.Now().UnixNano()) for i := 0; i \u003c 20; i++ { v := rand.Intn(1_000_000-1) + 1 fmt.Printf(\"é’ˆå¯¹ %d è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼š \\n\", v) idx := binarySearch(list, v) fmt.Printf(\"%d çš„ç´¢å¼•ä½ç½®æ˜¯ï¼š[%d]\\n\", v, idx) fmt.Println(\"-------------------------------\") } } func binarySearch(list []int, target int) int { low := 0 high := len(list) step := 0 for { step = step + 1 if low \u003c= high { mid := (low + high) / 2 guess := list[mid] if guess == target { fmt.Printf(\"å…±æŸ¥æ‰¾äº† %d æ¬¡\\n\", step) return mid } if guess \u003e target { high = mid + 1 } else { low = mid - 1 } } } } è¾“å‡ºç»“æœ go run main.go é’ˆå¯¹ 488291 è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼š å…±æŸ¥æ‰¾äº† 21 æ¬¡ 488291 çš„ç´¢å¼•ä½ç½®æ˜¯ï¼š[1488290] ------------------------------- é’ˆå¯¹ 253611 è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼š å…±æŸ¥æ‰¾äº† 19 æ¬¡ 253611 çš„ç´¢å¼•ä½ç½®æ˜¯ï¼š[1253610] ------------------------------- é’ˆå¯¹ 92000 è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼š å…±æŸ¥æ‰¾äº† 21 æ¬¡ 92000 çš„ç´¢å¼•ä½ç½®æ˜¯ï¼š[1091999] ------------------------------- é’ˆå¯¹ 399702 è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼š å…±æŸ¥æ‰¾äº† 17 æ¬¡ 399702 çš„ç´¢å¼•ä½ç½®æ˜¯ï¼š[1399701] ------------------------------- é’ˆå¯¹ 356459 è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼š å…±æŸ¥æ‰¾äº† 17 æ¬¡ 356459 çš„ç´¢å¼•ä½ç½®æ˜¯ï¼š[1356458] ------------------------------- é’ˆå¯¹ 533248 è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼š å…±æŸ¥æ‰¾äº† 17 æ¬¡ 533248 çš„ç´¢å¼•ä½ç½®æ˜¯ï¼š[1533247] ------------------------------- é’ˆå¯¹ 802470 è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼š å…±æŸ¥æ‰¾äº† 21 æ¬¡ 802470 çš„ç´¢å¼•ä½ç½®æ˜¯ï¼š[1802469] ------------------------------- é’ˆå¯¹ 358966 è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼š å…±æŸ¥æ‰¾äº† 21 æ¬¡ 358966 çš„ç´¢å¼•ä½ç½®æ˜¯ï¼š[1358965] ------------------------------- é’ˆå¯¹ 325215 è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼š å…±æŸ¥æ‰¾äº† 21 æ¬¡ 325215 çš„ç´¢å¼•ä½ç½®æ˜¯ï¼š[1325214] ------------------------------- é’ˆå¯¹ 443265 è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼š å…±æŸ¥æ‰¾äº† 21 æ¬¡ 443265 çš„ç´¢å¼•ä½ç½®æ˜¯ï¼š[1443264] ------------------------------- é’ˆå¯¹ 829382 è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼š å…±æŸ¥æ‰¾äº† 18 æ¬¡ 829382 çš„ç´¢å¼•ä½ç½®æ˜¯ï¼š[1829381] ------------------------------- é’ˆå¯¹ 499513 è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼š å…±æŸ¥æ‰¾äº† 21 æ¬¡ 499513 çš„ç´¢å¼•ä½ç½®æ˜¯ï¼š[1499512] ------------------------------- é’ˆå¯¹ 589792 è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼š å…±æŸ¥æ‰¾äº† 19 æ¬¡ 589792 çš„ç´¢å¼•ä½ç½®æ˜¯ï¼š[1589791] ------------------------------- é’ˆå¯¹ 253817 è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼š å…±æŸ¥æ‰¾äº† 21 æ¬¡ 253817 çš„ç´¢å¼•ä½ç½®æ˜¯ï¼š[1253816] ------------------------------- é’ˆå¯¹ 624237 è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼š å…±æŸ¥æ‰¾äº† 20 æ¬¡ 624237 çš„ç´¢å¼•ä½ç½®æ˜¯ï¼š[1624236] ------------------------------- é’ˆå¯¹ 850665 è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼š å…±æŸ¥æ‰¾äº† 21 æ¬¡ 850665 çš„ç´¢å¼•ä½ç½®æ˜¯ï¼š[1850664] ------------------------------- é’ˆå¯¹ 929880 è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼š å…±æŸ¥æ‰¾äº† 21 æ¬¡ 929880 çš„ç´¢å¼•ä½ç½®æ˜¯ï¼š[1929879] ------------------------------- é’ˆå¯¹ 422010 è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼š å…±æŸ¥æ‰¾äº† 20 æ¬¡ 422010 çš„ç´¢å¼•ä½ç½®æ˜¯ï¼š[1422009] ------------------------------- é’ˆå¯¹ 39939 è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼š å…±æŸ¥æ‰¾äº† 21 æ¬¡ 39939 çš„ç´¢å¼•ä½ç½®æ˜¯ï¼š[1039938] ------------------------------- é’ˆå¯¹ 894763 è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼š å…±æŸ¥æ‰¾äº† 19 æ¬¡ 894763 çš„ç´¢å¼•ä½ç½®æ˜¯ï¼š[1894762] ------------------------------- ","date":"2023-05-27","objectID":"/golang-binarysearch/:1:0","tags":["golang","ç®—æ³•"],"title":"ğŸš€Golang BinarySearch","uri":"/golang-binarysearch/"},{"categories":["æ–‡æ¡£"],"content":" Golang å‘½ä»¤è¡Œå‚æ•°os.Args å¦‚ä½•åˆ¶ä½œå‘½ä»¤è¡Œåº”ç”¨ å¦‚ä½•ä½¿ç”¨os.Args è·å–å‘½ä»¤è¡Œå‚æ•° ","date":"2023-05-27","objectID":"/golang-args/:0:0","tags":["golang"],"title":"Golang å‘½ä»¤è¡Œå‚æ•°os.Args","uri":"/golang-args/"},{"categories":["æ–‡æ¡£"],"content":"ä½¿ç”¨çš„çŸ¥è¯†ç‚¹ osåŒ…æä¾›äº†ç”¨äºå¤„ç†æ“ä½œç³»ç»Ÿçš„ç›¸å…³å†…å®¹çš„å‡½æ•°/å€¼ ç‹¬ç«‹äºå¹³å°çš„æ–¹å¼ os.Args å˜é‡ è·å–å‘½ä»¤è¡Œçš„å‚æ•° å®ƒæ˜¯string slice ç¬¬ä¸€ä¸ªå€¼æ˜¯å‘½ä»¤æœ¬èº« strings.Join å‡½æ•° å°†å­—ç¬¦ä¸²åˆ‡ç‰‡ä¸­å­˜åœ¨çš„æ‰€æœ‰å…ƒç´ è¿æ¥ä¸ºå•ä¸ªå­—ç¬¦ä¸² ç¤ºä¾‹01 package main import ( \"fmt\" \"os\" ) func main() { var s, sep string for i := 0; i \u003c len(os.Args); i++ { s += sep + os.Args[i] sep = \" \" } fmt.Println(s) } ç¤ºä¾‹02 package main import ( \"fmt\" \"os\" ) func main() { s, sep := \"\", \"\" for _, args := range os.Args[1:] { s += sep + args sep = \" \" } fmt.Println(s) } ç¤ºä¾‹03 package main import ( \"fmt\" \"os\" \"strings\" ) func main() { fmt.Println(strings.Join(os.Args[1:], \" \")) } ","date":"2023-05-27","objectID":"/golang-args/:1:0","tags":["golang"],"title":"Golang å‘½ä»¤è¡Œå‚æ•°os.Args","uri":"/golang-args/"},{"categories":["æ–‡æ¡£"],"content":"ç”¨æˆ·è¾“å…¥bufio package main import ( \"bufio\" \"fmt\" \"os\" ) func main() { fmt.Println(\"Waht's your name\") reader := bufio.NewReader(os.Stdin) text, _ := reader.ReadString('\\n') fmt.Printf(\"your name: %s\", text) } ","date":"2023-05-27","objectID":"/golang-args/:2:0","tags":["golang"],"title":"Golang å‘½ä»¤è¡Œå‚æ•°os.Args","uri":"/golang-args/"},{"categories":["æ–‡æ¡£"],"content":" Golang TCP ç«¯å£æ‰«æ éå¹¶å‘ç‰ˆ package main import ( \"fmt\" \"net\" ) func main() { for i := 21; i \u003c 120; i++ { address := fmt.Sprintf(\"192.168.0.2:%d\", i) conn, err := net.Dial(\"tcp\", address) if err != nil { fmt.Printf(\"%d å…³é—­äº†\\n\", address) continue } conn.Close() fmt.Printf(\"%d dakaiäº†\\n\", address) } } å¹¶å‘ç‰ˆ package main import ( \"fmt\" \"net\" \"sync\" \"time\" ) func main() { start := time.Now() var wg sync.WaitGroup for i := 21; i \u003c 120; i++ { wg.Add(1) go func(j int) { address := fmt.Sprintf(\"192.168.0.2:%d\", j) conn, err := net.Dial(\"tcp\", address) if err != nil { fmt.Printf(\"%d å…³é—­äº†\\n\", address) return } conn.Close() fmt.Printf(\"%d dakaiäº†\\n\", address) }(i) wg.Wait() elapsed := time.Since(start) / 1e9 fmt.Printf(\"\\n\\n%d\\n\", elapsed) } } goroutine æ± å¹¶å‘ç‰ˆ TCP ç«¯å£æ‰«æå™¨ go-work (figure) package main import ( \"fmt\" \"net\" \"sort\" ) func worker(ports chan int, results chan int) { for p := range ports { address := fmt.Sprintf(\"192.168.1.1:%d\", p) conn, err := net.Dial(\"tcp\", address) if err != nil { results \u003c- 0 fmt.Printf(\"%d å…³é—­äº† \\n\", p) } conn.Close() fmt.Printf(\"%d æ‰“å¼€äº†\", p) results \u003c- p } } func main() { ports := make(chan int, 100) results := make(chan int) var openports []int var closeports []int for i := 0; i \u003c cap(ports); i++ { go worker(ports, results) } go func() { for i := 1; i \u003c 1024; i++ { ports \u003c- i } }() for i := 1; i \u003c 1024; i++ { port := \u003c- results if port != 0 { openports = append(openports, port) } else { closeports = append(closeports, port) } } close(ports) close(results) sort.Ints(openports) sort.Ints(closeports) for _, port := range openports { fmt.Printf(\"%d open\\n\", port) } for _, port := range closeports { fmt.Printf(\"%d close\\n\", port) } } å‚è€ƒè§†é¢‘ ","date":"2023-05-26","objectID":"/golang-portscan/:0:0","tags":["golang"],"title":"Golang PortScan","uri":"/golang-portscan/"},{"categories":["æ–‡æ¡£"],"content":" K8s-GVK\u0026FVR ","date":"2023-05-26","objectID":"/k8s-gvk_gvr/:0:0","tags":["k8s"],"title":"K8s GVK_GVR","uri":"/k8s-gvk_gvr/"},{"categories":["æ–‡æ¡£"],"content":"GVK \u0026 GVR ä»‹ç» GVK â€”â€” group ã€versionã€ kind GVR â€”â€” group ã€version ã€resource ","date":"2023-05-26","objectID":"/k8s-gvk_gvr/:1:0","tags":["k8s"],"title":"K8s GVK_GVR","uri":"/k8s-gvk_gvr/"},{"categories":["æ–‡æ¡£"],"content":"kind å’Œ resource æ¦‚å¿µ åœ¨ç¼–ç è¿‡ç¨‹ä¸­ï¼Œ èµ„æºæ•°æ®å­˜å‚¨éƒ½æ˜¯ç»“æ„ä½“å­˜å‚¨ å¤šç‰ˆæœ¬versionå­˜å‚¨åœ¨ï¼ˆalpha1ï¼Œbeta1ï¼Œv1ç­‰ï¼‰ï¼Œä¸åŒç‰ˆæœ¬ä¸­å­˜å‚¨ç»“æ„ä½“çš„å­˜åœ¨ç€å·®å¼‚ ç”¨ Kind åï¼ˆå¦‚ Deploymentï¼‰ï¼Œå¹¶ä¸èƒ½å‡†ç¡®è·å–åˆ°å…¶ä½¿ç”¨å“ªä¸ªç‰ˆæœ¬ç»“æ„ä½“ é‡‡ç”¨ GVK è·å–åˆ°ä¸€ä¸ªå…·ä½“çš„ å­˜å‚¨ç»“æ„ä½“ï¼Œä¹Ÿå°±æ˜¯ GVK çš„ä¸‰ä¸ªä¿¡æ¯ï¼ˆgroup/verion/kind) ç¡®å®šä¸€ä¸ª Go typeï¼ˆç»“æ„ä½“ï¼‰ Scheme å­˜å‚¨äº† GVK å’Œ Go type çš„æ˜ å°„å…³ç³» åˆ›å»ºèµ„æºï¼Œ ç¼–å†™yamlï¼Œæäº¤è¯·æ±‚ ç¼–å†™ yaml è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šå†™ apiversion å’Œ kindï¼Œå…¶å®å°±æ˜¯ GVK ä¸ apiserver é€šä¿¡æ˜¯ http å½¢å¼ï¼Œå°±æ˜¯å°†è¯·æ±‚å‘é€åˆ°æŸä¸€ http path http path å…¶å®å°±æ˜¯ GVR /apis/batch/v1/namespaces/default/job è¿™ä¸ªå°±æ˜¯è¡¨ç¤º default å‘½åç©ºé—´çš„ job èµ„æº ","date":"2023-05-26","objectID":"/k8s-gvk_gvr/:1:1","tags":["k8s"],"title":"K8s GVK_GVR","uri":"/k8s-gvk_gvr/"},{"categories":["æ–‡æ¡£"],"content":"ç›¸åŒåç§° Kind å¯ä»¥å­˜åœ¨ä¸åŒç»„ ç›¸åŒåç§°çš„kindä¸ä»…å¯ä»¥å­˜åœ¨ä¸åŒçš„Versionï¼Œ ä¹Ÿå¯ä»¥å­˜åœ¨ä¸åŒçš„group Ingress, NetworkPolicyåŒæ—¶åœ¨è¿™ä¸ªä¸¤ä¸ªAPI Groupï¼š extensionsã€ networking.k8s.io Deployment, DaemonSet, ReplicaSetåŒæ—¶åœ¨è¿™äº›API Groupä¸­ï¼šextensionsã€ apps EventåŒæ—¶åœ¨è¿™äº›API Groupä¸­ï¼š core group and events.k8s.io ","date":"2023-05-26","objectID":"/k8s-gvk_gvr/:2:0","tags":["k8s"],"title":"K8s GVK_GVR","uri":"/k8s-gvk_gvr/"},{"categories":["æ–‡æ¡£"],"content":"API-group èµ„æºåˆ†ç»„ å„ç»„å¯ä»¥å•ç‹¬æ‰“å¼€æˆ–è€…å…³é—­ å„ç»„å¯ä»¥æœ‰è‡ªå·±ç‹¬ç«‹çš„ç‰ˆæœ¬ï¼Œ ä¸å½±å“å…¶ä»–ç»„çš„æƒ…å†µä¸‹å¯ä»¥å•ç‹¬è¡åŒ– åŒä¸€ä¸ªèµ„æºå¯ä»¥åŒæ—¶å­˜åœ¨äºå¤šä¸ªä¸åŒç»„ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥åŒæ—¶æ”¯æŒæŸä¸ªç‰¹å®šèµ„æºç¨³å®šç‰ˆæœ¬ä¸å®éªŒç‰ˆæœ¬ kubernetes API æŸ¥çœ‹å½“å‰ kubernetes é›†ç¾¤æ”¯æŒçš„ API ç‰ˆæœ¬ $ kubectl api-versions apiextensions.k8s.io/v1beta1 apiregistration.k8s.io/v1beta1 apps/v1beta1 apps/v1beta2 authentication.k8s.io/v1 authentication.k8s.io/v1beta1 authorization.k8s.io/v1 authorization.k8s.io/v1beta1 autoscaling/v1 autoscaling/v2beta1 batch/v1 batch/v1beta1 certificates.k8s.io/v1beta1 custom-metrics.metrics.k8s.io/v1alpha1 extensions/v1beta1 monitoring.coreos.com/v1 networking.k8s.io/v1 policy/v1beta1 rbac.authorization.k8s.io/v1 rbac.authorization.k8s.io/v1beta1 storage.k8s.io/v1 storage.k8s.io/v1beta1 v1 å¯¹äºåŒä¸€ä¸ªèµ„æºå¯¹è±¡çš„ä¸åŒç‰ˆæœ¬ï¼ŒAPI-Server è´Ÿè´£ä¸åŒç‰ˆæœ¬ä¹‹é—´çš„æ— æŸåˆ‡æ¢ï¼Œè¿™ç‚¹å¯¹äºå®¢æˆ·ç«¯æ¥è¯´æ˜¯å®Œå…¨é€æ˜çš„ï¼ˆæ— æ„ŸçŸ¥ï¼‰ã€‚ äº‹å®ä¸Šï¼Œä¸åŒç‰ˆæœ¬çš„åŒç±»å‹çš„èµ„æºåœ¨æŒä¹…åŒ–å±‚çš„æ•°æ®å¯èƒ½æ˜¯ç›¸åŒçš„ã€‚ ä¾‹å¦‚ï¼Œå¯¹äºåŒä¸€ç§èµ„æºç±»å‹æ”¯æŒ v1 å’Œ v1beta1 ä¸¤ä¸ª API ç‰ˆæœ¬ï¼Œä»¥ v1beta1 ç‰ˆæœ¬åˆ›å»ºè¯¥èµ„æºçš„å¯¹è±¡ï¼Œåç»­å¯ä»¥ä»¥v1 æˆ–è€… v1beta1 æ¥æ›´æ–°æˆ–è€…åˆ é™¤è¯¥èµ„æºå¯¹è±¡ ","date":"2023-05-26","objectID":"/k8s-gvk_gvr/:3:0","tags":["k8s"],"title":"K8s GVK_GVR","uri":"/k8s-gvk_gvr/"},{"categories":["æ–‡æ¡£"],"content":"GVK ä¸ GVR æ˜ å°„ kind æ˜¯API é¡¶çº§ èµ„æºå¯¹è±¡ç±»å‹ï¼Œæ¯ä¸ªèµ„æºå¯¹è±¡éƒ½éœ€è¦kindæ¥åŒºåˆ†è‡ªèº«ä»£è¡¨çš„ç±»å‹ kind å­—æ®µ è¯¥èµ„æºå¯¹è±¡çš„ç±»å‹ å•ä¸ªçš„èµ„æºå¯¹è±¡ç±»å‹ï¼ˆpodï¼‰ èµ„æºå¯¹è±¡åˆ—è¡¨ç±»å‹ï¼Œ ï¼ˆpodlist æˆ–è€… nodelistï¼‰ ç‰¹æ®Šç±»å‹ä»¥åŠéåƒå°±å¥½ç±»å‹ ï¼ˆå¾ˆå¤šè¿™ç§ç±»å‹çš„èµ„æºæ˜¯ subresourceï¼Œ ä¾‹å¦‚ç”¨äºç»‘å®šèµ„æºçš„ /bindingã€æ›´æ–°èµ„æºçŠ¶æ€çš„ /status ä»¥åŠè¯»å†™èµ„æºå®ä¾‹æ•°é‡çš„ /scaleï¼‰ Resource é€šè¿‡httpåè®®ä»¥JSONæ ¼å¼å‘é€æˆ–è€…è¯»å–çš„èµ„æºå±•ç°å½¢å¼ å•ä¸ªèµ„æº ï¼ˆâ€¦/namespaces/defaultï¼‰ åˆ—è¡¨èµ„æºï¼ˆâ€¦/jobsï¼‰ GVR å¸¸ç”¨äºç»„åˆæˆ RESTful API è¯·æ±‚è·¯å¾„ GET /apis/apps/v1/namespaces/{namespace}/deployments/{name} ","date":"2023-05-26","objectID":"/k8s-gvk_gvr/:4:0","tags":["k8s"],"title":"K8s GVK_GVR","uri":"/k8s-gvk_gvr/"},{"categories":["æ–‡æ¡£"],"content":"API å­˜å‚¨ API-Server æ˜¯æ— çŠ¶æ€çš„ï¼Œå®ƒéœ€è¦ä¸åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿ etcd äº¤äº’æ¥å®ç°èµ„æºå¯¹è±¡çš„æŒä¹…åŒ–æ“ä½œ Kubernetes èµ„æºå¯¹è±¡æ˜¯ä»¥JSONæˆ– Protocol Buffers æ ¼å¼å­˜å‚¨åœ¨ etcd ä¸­ ä»¥é€šè¿‡é…ç½® kube-apiserver çš„å¯åŠ¨å‚æ•° â€“storage-media-type æ¥å†³å®šæƒ³è¦åºåˆ—åŒ–æ•°æ®å­˜å…¥ etcd çš„æ ¼å¼ åˆ›å»ºä¸€ä¸ª podï¼Œç„¶åä½¿ç”¨ etcdctl å·¥å…·æ¥æŸ¥çœ‹å­˜å‚¨åœ¨ etcd ä¸­æ•°æ® $ cat \u003c\u003c EOF | kubectl create -f - apiVersion: v1 kind: Pod metadata: name: webserver spec: containers: - name: nginx image: nginx ports: - containerPort: 80 EOF pod/webserver created $ etcdctl --endpoints=$ETCD_URL \\ --cert /etc/kubernetes/pki/etcd/server.crt \\ --key /etc/kubernetes/pki/etcd/server.key \\ --cacert /etc/kubernetes/pki/etcd/ca.crt \\ get /registry/pods/default/webserver --prefix -w simple /registry/pods/default/webserver ... 10.244.0.5\" å®¢æˆ·ç«¯å·¥å…·åˆ›å»ºèµ„æºå¯¹è±¡åˆ°ç„¶åå­˜å‚¨åˆ° etcd çš„æµç¨‹ å®¢æˆ·ç«¯å·¥å…·(kubectl) æä¾›ä¸€ä¸ªæœŸæœ›çŠ¶æ€çš„èµ„æºå¯¹è±¡çš„åºåˆ—åŒ–è¡¨ç¤ºï¼Œæ˜¯ä¸€æ ·yamlæ ¼å¼æä¾› kubectl å°†YAMLè½¬æ¢ä¸ºJSON æ ¼å¼ï¼Œ å¹¶å‘é€ç»™API -server å¯¹åº”åŒç±»å‹å¯¹è±¡çš„ä¸åŒç‰ˆæœ¬ï¼ŒAPI- SERVER æ‰§è¡Œæ— æŸè½¬æ¢ï¼Œå¯¹äºè€ç‰ˆæœ¬ä¸å­˜åœ¨çš„å­—æ®µåˆ™å­˜å‚¨åœ¨annotationsä¸­ API- SERVER å°†æ¥æ”¶åˆ°çš„å¯¹è±¡è½¬æ¢ä¸ºè§„èŒƒå­˜å‚¨ç‰ˆæœ¬ï¼Œè¿™ä¸ªç‰ˆæœ¬ç”±API-Serverå¯åŠ¨å‚æ•°æŒ‡å®šï¼Œé€šå¸¸æ˜¯æœ€ç¨³å®šçš„ç‰ˆæœ¬ æœ€åå°†èµ„æºå¯¹è±¡é€šè¿‡JSON æˆ–YAMLæ–¹å¼è§£æå¹¶é€šè¿‡ä¸€ä¸ªç‰¹å®šçš„key å­˜å…¥etcdä¸­ ","date":"2023-05-26","objectID":"/k8s-gvk_gvr/:5:0","tags":["k8s"],"title":"K8s GVK_GVR","uri":"/k8s-gvk_gvr/"},{"categories":["æ–‡æ¡£"],"content":" Liveness\u0026Readines ","date":"2023-05-24","objectID":"/k8s-liveness_readines/:0:0","tags":["k8s"],"title":"K8s Liveness_Readines","uri":"/k8s-liveness_readines/"},{"categories":["æ–‡æ¡£"],"content":"éœ€æ±‚æ¥æº å®æ—¶è§‚å¯Ÿåº”ç”¨çš„å¥åº·çŠ¶æ€ è·å–åº”ç”¨çš„èµ„æºä½¿ç”¨æƒ…å†µ æ‹¿åˆ°åº”ç”¨çš„å®æ—¶æ—¥å¿—ï¼Œ è¿›è¡Œé—®é¢˜çš„è¯Šæ–­å’Œåˆ†æ ","date":"2023-05-24","objectID":"/k8s-liveness_readines/:1:0","tags":["k8s"],"title":"K8s Liveness_Readines","uri":"/k8s-liveness_readines/"},{"categories":["æ–‡æ¡£"],"content":"Liveness probe å’Œ Readiness probe ä»‹ç» livenness probe æ˜¯å°±ç»ªæŒ‡é’ˆï¼Œåˆ¤æ–­ä¸€ä¸ªpodæ˜¯å¦å¤„äºå°±ç»ªçŠ¶æ€ã€‚ å½“ä¸€ä¸ªpodå¤„äºå°±ç»ªçŠ¶æ€çš„æ—¶å€™ æ‰èƒ½å¯¹å¤–æä¾›å¯¹åº”çš„æœåŠ¡ï¼Œæ¥å…¥å±‚çš„æµé‡æ‰èƒ½æ‰“å…¥ç›¸åº”çš„pod å½“è¿™ä¸ªpodä¸å¤„äºå°±ç»ªçŠ¶æ€ï¼Œ æ¥å…¥å±‚ç°å§ç›¸åº”çš„æµé‡ä»è¿™ä¸ªpodä¸Šé¢å‰”é™¤ã€‚ Liveness01 (figure) è¿™ä¸ªpodæŒ‡é’ˆä¸€ç›´å¤„äºå¤±è´¥ï¼Œ æ¥å…¥å±‚æµé‡ä¸ä¼šæ‰“åˆ°è¿™ä¸ªpod è¿™ä¸ª pod çš„çŠ¶æ€ä» FAIL çš„çŠ¶æ€è½¬æ¢æˆ success çš„çŠ¶æ€æ—¶ï¼Œå®ƒæ‰èƒ½å¤ŸçœŸå®åœ°æ‰¿è½½è¿™ä¸ªæµé‡ è¿™ä¸ªæ—¶å€™ä¼šç”±ä¸Šå±‚çš„åˆ¤æ–­æœºåˆ¶æ¥åˆ¤æ–­è¿™ä¸ª pod æ˜¯å¦éœ€è¦è¢«é‡æ–°æ‹‰èµ·ã€‚é‚£å¦‚æœä¸Šå±‚é…ç½®çš„é‡å¯ç­–ç•¥æ˜¯ restart always çš„è¯ï¼Œé‚£ä¹ˆæ­¤æ—¶è¿™ä¸ª pod ä¼šç›´æ¥è¢«é‡æ–°æ‹‰èµ·ã€‚ ","date":"2023-05-24","objectID":"/k8s-liveness_readines/:2:0","tags":["k8s"],"title":"K8s Liveness_Readines","uri":"/k8s-liveness_readines/"},{"categories":["æ–‡æ¡£"],"content":"åº”ç”¨å¥åº·çŠ¶æ€-ä½¿ç”¨æ–¹å¼ ","date":"2023-05-24","objectID":"/k8s-liveness_readines/:3:0","tags":["k8s"],"title":"K8s Liveness_Readines","uri":"/k8s-liveness_readines/"},{"categories":["æ–‡æ¡£"],"content":"æ¢æµ‹æ–¹å¼ livenessæŒ‡é’ˆå’ŒReadkinessæŒ‡é’ˆæ”¯æŒä¸‰ç§ä¸åŒçš„æ¢æµ‹æ–¹å¼ httpGet: é€šè¿‡å‘é€http ä¸ªä½“è¯·æ±‚è¿›è¡Œåˆ¤æ–­ï¼Œ å½“è¿”å›ç æ˜¯200ï½399 ï¼Œæ ‡è¯†è¿™ä¸ªåº”ç”¨æ˜¯å¥åº·çš„ Exec: æ‰§è¡Œå®¹å™¨ä¸­çš„ä¸€ä¸ªå‘½ä»¤åˆ¤æ–­å½“å‰å®¹å™¨æ˜¯å¦æ­£å¸¸ï¼Œå½“è¿”å›æ—¶0ï¼Œæ ‡è¯†å®¹å™¨æ—¶å¥åº·çš„ tcpSocketï¼š é€šè¿‡æ¢æµ‹å®¹å™¨çš„IPå’ŒPort è¿›è¡ŒTCPå¥åº·æ£€æŸ¥ï¼Œ TCPèƒ½æ­£å¸¸å»ºç«‹ï¼Œ æ ‡è¯†è¿™ä¸ªå®¹å™¨æ—¶å¥åº·çš„ ","date":"2023-05-24","objectID":"/k8s-liveness_readines/:3:1","tags":["k8s"],"title":"K8s Liveness_Readines","uri":"/k8s-liveness_readines/"},{"categories":["æ–‡æ¡£"],"content":"æ¢æµ‹ç»“æœ Success: æ ‡è¯†Container é€šè¿‡å¥åº·æ£€æŸ¥ Failure: containeræ²¡æœ‰é€šè¿‡å¥åº·æ£€æŸ¥ï¼Œæ­¤æ—¶ä¼šæœ‰ä¸€ä¸ªç›¸åº”çš„å¤„ç†ï¼ŒReadinessâ€”â€”ï¼ˆserviceå±‚å°†æ²¡æœ‰é€šè¿‡Readinessçš„podè¿›è¡Œç§»é™¤ï¼‰liveness å°†è¿™ä¸ªpodé‡æ–°æ‹‰èµ·ï¼Œ æˆ–è€…åˆ é™¤ Unknown: å½“å‰çš„æ‰§è¡Œæœºåˆ¶æ²¡æœ‰å®Œæˆæ‰§è¡Œï¼ˆè¶…æ—¶æˆ–è€…ä¸€äº›è„šæœ¬æ²¡æœ‰åŠæ—¶è¿”å›ï¼‰ï¼Œç­‰å¾…ä¸‹æ¬¡çš„æœºåˆ¶æ¥è¿›è¡Œæ ¡éªŒ ","date":"2023-05-24","objectID":"/k8s-liveness_readines/:3:2","tags":["k8s"],"title":"K8s Liveness_Readines","uri":"/k8s-liveness_readines/"},{"categories":["æ–‡æ¡£"],"content":"åº”ç”¨å¥åº·çŠ¶æ€æ£€æŸ¥æ–¹å¼-pod Probe spec ","date":"2023-05-24","objectID":"/k8s-liveness_readines/:4:0","tags":["k8s"],"title":"K8s Liveness_Readines","uri":"/k8s-liveness_readines/"},{"categories":["æ–‡æ¡£"],"content":"exec é€šè¿‡cat ä¸€ä¸ªå…·ä½“æ–‡ä»¶æ¥åˆ¤æ–­å½“å‰Liveness probe çš„çŠ¶æ€ï¼Œè¿”å›0 è¿™ä¸ªpod å¤„äºå¥åº·çŠ¶æ€ ","date":"2023-05-24","objectID":"/k8s-liveness_readines/:4:1","tags":["k8s"],"title":"K8s Liveness_Readines","uri":"/k8s-liveness_readines/"},{"categories":["æ–‡æ¡£"],"content":"httpGet ","date":"2023-05-24","objectID":"/k8s-liveness_readines/:4:2","tags":["k8s"],"title":"K8s Liveness_Readines","uri":"/k8s-liveness_readines/"},{"categories":["æ–‡æ¡£"],"content":"tcpSocket å‚æ•°è¯´æ˜ï¼š initialDelaySecondsï¼š podå¯åŠ¨å»¶è¿Ÿå¤šä¹…è¿›è¡Œä¸€æ¬¡æ£€æŸ¥ periodSecondsï¼š æ£€æŸ¥çš„æ—¶é—´é—´éš”ï¼Œé»˜è®¤å€¼æ˜¯10ç§’ timeoutSecondsï¼š æ£€æŸ¥çš„è¶…æ—¶æ—¶é—´ successThresholdï¼š podä»æ¢æµ‹å¤±è´¥åˆ°å†ä¸€æ¬¡æ¢æµ‹æˆåŠŸï¼Œ é”éœ€è¦çš„é˜€å€¼æ¬¡æ•° failureThresholdï¼š æ¢æµ‹å¤±è´¥çš„é‡å¯æ¬¡æ•°ï¼Œ é»˜è®¤å€¼æ˜¯3 ","date":"2023-05-24","objectID":"/k8s-liveness_readines/:4:3","tags":["k8s"],"title":"K8s Liveness_Readines","uri":"/k8s-liveness_readines/"},{"categories":["æ–‡æ¡£"],"content":"Liveness ä¸ Readiness æ€»ç»“ liveness: åˆ¤æ–­å®¹å™¨æ˜¯å¦å¤„äºrunning ,å¦‚æœå®¹å™¨ä¸å¥åº·ï¼Œä¼šé€šè¿‡kubelet æ€æ‰ç›¸åº”çš„pod Readinessï¼š åˆ¤æ–­å®¹å™¨æ˜¯å¦å¯åŠ¨å®Œæˆï¼Œå¦‚æœæ¢æµ‹ä¸€ä¸ªç»“æœä¸æˆåŠŸï¼Œ ä¼šä»podä¸ŠEndpointä¸Šç§»é™¤ã€‚ ","date":"2023-05-24","objectID":"/k8s-liveness_readines/:5:0","tags":["k8s"],"title":"K8s Liveness_Readines","uri":"/k8s-liveness_readines/"},{"categories":["æ–‡æ¡£"],"content":"é€‚ç”¨åœºæ™¯ livenessï¼š æ”¯æŒå¯ä»¥é‡æ–°æ‹‰èµ·çš„åº”ç”¨ Readinessï¼š åº”å¯¹ å¯åŠ¨åæ— æ³•ç«‹å³å¯¹å¤–æä¾›æœåŠ¡çš„åº”ç”¨ã€‚ ","date":"2023-05-24","objectID":"/k8s-liveness_readines/:5:1","tags":["k8s"],"title":"K8s Liveness_Readines","uri":"/k8s-liveness_readines/"},{"categories":["æ–‡æ¡£"],"content":"åº”ç”¨æ•…éšœæ’é™¤â€”â€”çŠ¶æ€æœºåˆ¶ k8s çš„çŠ¶æ€æœºåˆ¶ï¼Œ é€šè¿‡yamlçš„æ–¹å¼å®šä¹‰ä¸ªæœŸæœ›åˆ°è¾¾çš„çŠ¶æ€ã€‚ è¿™ä¸ªyamlçš„çœŸæ­£æ‰§è¡Œè¿‡ç¨‹ å„ç§å„æ ·çš„controlleræ¥è´Ÿè´£æ•´ä½“çš„çŠ¶æ€ä¹‹é—´çš„è½¬æ¢ ä¸€ä¸ª Pod çš„ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸã€‚åˆšå¼€å§‹å®ƒå¤„åœ¨ä¸€ä¸ª pending çš„çŠ¶æ€ï¼Œé‚£æ¥ä¸‹æ¥å¯èƒ½ä¼šè½¬æ¢åˆ°ç±»ä¼¼åƒ runningï¼Œä¹Ÿå¯èƒ½è½¬æ¢åˆ° Unknownï¼Œç”šè‡³å¯ä»¥è½¬æ¢åˆ° failedã€‚ç„¶åï¼Œå½“ running æ‰§è¡Œäº†ä¸€æ®µæ—¶é—´ä¹‹åï¼Œå®ƒå¯ä»¥è½¬æ¢åˆ°ç±»ä¼¼åƒ successded æˆ–è€…æ˜¯ failedï¼Œç„¶åå½“å‡ºç°åœ¨ unknown è¿™ä¸ªçŠ¶æ€æ—¶ï¼Œå¯èƒ½ç”±äºä¸€äº›çŠ¶æ€çš„æ¢å¤ï¼Œå®ƒä¼šé‡æ–°æ¢å¤åˆ° running æˆ–è€… successded æˆ–è€…æ˜¯ failedã€‚ k8s æ•´ä½“çš„ä¸€ä¸ªçŠ¶æ€å°±æ˜¯çŠ¶æ€æœºåˆ¶çš„è½¬æ¢ ä¸€ä¸ªpodçŠ¶æ€ä½çš„å±•ç° ","date":"2023-05-24","objectID":"/k8s-liveness_readines/:6:0","tags":["k8s"],"title":"K8s Liveness_Readines","uri":"/k8s-liveness_readines/"},{"categories":["æ–‡æ¡£"],"content":"åº”ç”¨æ•…éšœæ’é™¤-åœºæ™¯åº”ç”¨å¼‚å¸¸ ","date":"2023-05-24","objectID":"/k8s-liveness_readines/:7:0","tags":["k8s"],"title":"K8s Liveness_Readines","uri":"/k8s-liveness_readines/"},{"categories":["æ–‡æ¡£"],"content":"podåœç•™åœ¨Pending æ ‡è¯†æ²¡æœ‰è°ƒåº¦å™¨è¿›è¡Œä»‹å…¥ å¯èƒ½æ˜¯èµ„æºæˆ–ç«¯å£å ç”¨ ç”±äºnode selector é€ æˆçš„podæ— æ³•è°ƒåº¦ ","date":"2023-05-24","objectID":"/k8s-liveness_readines/:7:1","tags":["k8s"],"title":"K8s Liveness_Readines","uri":"/k8s-liveness_readines/"},{"categories":["æ–‡æ¡£"],"content":"Pod åœç•™åœ¨ waiting è¡¨ç¤ºpodçš„é•œåƒæ²¡æœ‰æ­£å¸¸æ‹‰å– å¯èƒ½åŸå›  ç§æœ‰é•œåƒ æ²¡æœ‰é…ç½®pod secret é•œåƒåœ°å€ä¸å­˜åœ¨ ","date":"2023-05-24","objectID":"/k8s-liveness_readines/:7:2","tags":["k8s"],"title":"K8s Liveness_Readines","uri":"/k8s-liveness_readines/"},{"categories":["æ–‡æ¡£"],"content":"Pod ä¸æ–­è¢«æ‹‰å–å¹¶ä¸”å¯ä»¥çœ‹åˆ° crashing æ ‡è¯†podå·²ç»è°ƒåº¦å®Œæˆï¼Œ ä½†æ˜¯å¯åŠ¨å¤±è´¥ éœ€è¦å…³æ³¨åº”ç”¨çš„è‡ªèº«çŠ¶æ€ æŸ¥çœ‹podçš„å…·ä½“æ—¥å¿— ","date":"2023-05-24","objectID":"/k8s-liveness_readines/:7:3","tags":["k8s"],"title":"K8s Liveness_Readines","uri":"/k8s-liveness_readines/"},{"categories":["æ–‡æ¡£"],"content":"Pod å¤„åœ¨ Runing ä½†æ˜¯æ²¡æœ‰æ­£å¸¸å·¥ä½œ å¸¸è§é—®é¢˜â€”â€”yamlä¿¡æ¯é‡Œå¯èƒ½æœ‰æ‹¼å†™é”™è¯¯ apply-validate -f pod.yaml åˆ¤æ–­å½“å‰çš„yamlæ˜¯å¦æ­£ç¡® å¦‚æœæ²¡æœ‰é—®é¢˜ï¼Œè¯Šæ–­é…ç½®çš„ç«¯å£æ˜¯å¦æ­£å¸¸ï¼Œä»¥åŠlivenessæˆ–Readiness é…ç½®æ˜¯å¦æ­£ç¡® ","date":"2023-05-24","objectID":"/k8s-liveness_readines/:7:4","tags":["k8s"],"title":"K8s Liveness_Readines","uri":"/k8s-liveness_readines/"},{"categories":["æ–‡æ¡£"],"content":"Service æ— æ³•æ­£å¸¸çš„å·¥ä½œ å› ä¸ºserviceå’Œåº•å±‚podä¹‹é—´çš„å…³è”æ˜¯é€šè¿‡selectorçš„æ–¹å¼è¿›è¡ŒåŒ¹é…çš„ï¼Œ podä¸Šé¢é…ç½®labelï¼Œ ç„¶åserviceé€šè¿‡match labelçš„æ–¹å¼å’Œpodè¿›è¡Œå…³è” å¦‚æœlableé…ç½®æœ‰é—®é¢˜ï¼Œå¯èƒ½ä¼šé€ æˆserviceæ— æ³•æ‰¾åˆ°åé¢çš„endpoint é€ æˆç›¸åº”çš„serviceæ— æ³•å¯¹å¤–æä¾›æœåŠ¡ æ’é™¤è¿™ç§é—®é¢˜ é¦–å…ˆ çœ‹service åé¢çš„æ˜¯ä¸æ˜¯æœ‰ä¸€ä¸ªçœŸæ­£çš„endpoint å…¶æ¬¡ çœ‹è¿™ä¸ªendpoint æ˜¯å¦å¯ä»¥å¯¹å¤–æä¾›æ­£å¸¸çš„æœåŠ¡ ","date":"2023-05-24","objectID":"/k8s-liveness_readines/:7:5","tags":["k8s"],"title":"K8s Liveness_Readines","uri":"/k8s-liveness_readines/"},{"categories":["æ–‡æ¡£"],"content":"åº”ç”¨è¿œç¨‹è°ƒè¯• ","date":"2023-05-24","objectID":"/k8s-liveness_readines/:8:0","tags":["k8s"],"title":"K8s Liveness_Readines","uri":"/k8s-liveness_readines/"},{"categories":["æ–‡æ¡£"],"content":"åº”ç”¨è¿œç¨‹è°ƒè¯• - Pod è¿œç¨‹è°ƒè¯• è¿›å…¥å®¹å™¨é‡Œè¿›è¡Œè¯Šæ–­ ","date":"2023-05-24","objectID":"/k8s-liveness_readines/:8:1","tags":["k8s"],"title":"K8s Liveness_Readines","uri":"/k8s-liveness_readines/"},{"categories":["æ–‡æ¡£"],"content":"åº”ç”¨è¿œç¨‹è°ƒè¯• - Service è¿œç¨‹è°ƒè¯• serviceè°ƒè¯• åˆ†äº†ä¸¤éƒ¨åˆ† å°†æœåŠ¡æš´éœ²åˆ°è¿œç¨‹çš„ä¸€ä¸ªé›†ç¾¤ä¹‹å†…ï¼Œè®©è¿œç¨‹é›†ç¾¤çš„ä¸€äº›åº”ç”¨å»è°ƒç”¨æœ¬åœ°çš„ä¸€ä¸ªæœåŠ¡ï¼Œè¿™æ˜¯ä¸€æ¡åå‘çš„ä¸€ä¸ªé“¾è·¯ è®©æœ¬åœ°çš„æœåŠ¡èƒ½å¤Ÿè¿œç¨‹è°ƒç”¨æœåŠ¡ï¼Œ è¿™æ˜¯ä¸€æ¡æ­£å‘çš„é“¾è·¯ å°† Telepresence çš„ä¸€ä¸ª Proxy åº”ç”¨éƒ¨ç½²åˆ°è¿œç¨‹çš„ K8s é›†ç¾¤é‡Œé¢ã€‚ç„¶åå°†è¿œç¨‹å•ä¸€ä¸ª deployment swap åˆ°æœ¬åœ°çš„ä¸€ä¸ª applicationï¼Œä½¿ç”¨çš„å‘½ä»¤å°±æ˜¯ Telepresence-swap-deployment ç„¶åä»¥åŠè¿œç¨‹çš„ DEPLOYMENT_NAMEã€‚é€šè¿‡è¿™ç§æ–¹å¼å°±å¯ä»¥å°†æœ¬åœ°ä¸€ä¸ª application ä»£ç†åˆ°è¿œç¨‹çš„ service ä¹‹ä¸Šã€å¯ä»¥å°†åº”ç”¨åœ¨è¿œç¨‹é›†ç¾¤é‡Œé¢è¿›è¡Œæœ¬åœ°è°ƒè¯• ä½¿ç”¨æ–¹å¼æ˜¯ kubectl port-forwardï¼Œç„¶å service åŠ ä¸Šè¿œç¨‹çš„ service nameï¼Œå†åŠ ä¸Šç›¸åº”çš„ namespaceï¼Œåé¢è¿˜å¯ä»¥åŠ ä¸Šä¸€äº›é¢å¤–çš„å‚æ•°ï¼Œæ¯”å¦‚è¯´ç«¯å£çš„ä¸€ä¸ªæ˜ å°„ï¼Œé€šè¿‡è¿™ç§æœºåˆ¶å°±å¯ä»¥æŠŠè¿œç¨‹çš„ä¸€ä¸ªåº”ç”¨ä»£ç†åˆ°æœ¬åœ°çš„ç«¯å£ä¹‹ä¸Šï¼Œæ­¤æ—¶é€šè¿‡è®¿é—®æœ¬åœ°ç«¯å£å°±å¯ä»¥è®¿é—®è¿œç¨‹çš„æœåŠ¡ã€‚ ","date":"2023-05-24","objectID":"/k8s-liveness_readines/:8:2","tags":["k8s"],"title":"K8s Liveness_Readines","uri":"/k8s-liveness_readines/"},{"categories":["æ–‡æ¡£"],"content":"kubectl-debug kubectl-debug è¿™ä¸ªå·¥å…·æ˜¯ä¾èµ–äº Linux namespace çš„æ–¹å¼æ¥å»åšçš„ï¼Œå®ƒå¯ä»¥ datash ä¸€ä¸ª Linux namespace åˆ°ä¸€ä¸ªé¢å¤–çš„ containerï¼Œç„¶ååœ¨è¿™ä¸ª container é‡Œé¢æ‰§è¡Œä»»ä½•çš„ debug åŠ¨ä½œï¼Œå…¶å®å’Œç›´æ¥å» debug è¿™ä¸ª Linux namespace æ˜¯ä¸€è‡´çš„ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªç®€å•çš„æ“ä½œ é€šè¿‡ kubectl-debug è¿™æ¡å‘½ä»¤æ¥å»è¯Šæ–­è¿œç¨‹çš„ä¸€ä¸ª pod æ‰§è¡Œdebugçš„æ—¶å€™ï¼Œé¦–å…ˆä¼šæ‹‰å–ä¸€äº›é•œåƒï¼Œ è¿™ä¸ªé•œåƒé‡Œä¼šé»˜è®¤å¸¦ä¸€äº›è¯Šæ–­å·¥å…· å½“è¿™ä¸ªé•œåƒå¯ç”¨çš„æ—¶å€™ï¼Œå®ƒä¼šæŠŠè¿™ä¸ª debug container è¿›è¡Œå¯åŠ¨ è¿™ä¸ª container å’Œç›¸åº”çš„ä½ è¦è¯Šæ–­çš„è¿™ä¸ª container çš„ namespace è¿›è¡ŒæŒ‚é ï¼Œç±»ä¼¼åƒç½‘ç»œç«™ï¼Œæˆ–è€…æ˜¯ç±»ä¼¼åƒå†…æ ¸çš„ä¸€äº›å‚æ•°ï¼Œå¯ä»¥åœ¨è¿™ä¸ª debug container é‡Œé¢å®æ—¶åœ°è¿›è¡ŒæŸ¥çœ‹ã€‚ å»æŸ¥çœ‹ç±»ä¼¼åƒ hostnameã€è¿›ç¨‹ã€netstat ç­‰ç­‰ï¼Œè¿™ä¸ªå®¹å™¨å’Œéœ€è¦debugçš„podåœ¨åŒä¸€ä¸ªç¯å¢ƒé‡Œ è¿›è¡Œ logout çš„è¯ï¼Œç›¸å½“äºä¼šæŠŠç›¸åº”çš„è¿™ä¸ª debug pod æ€æ‰ ","date":"2023-05-24","objectID":"/k8s-liveness_readines/:9:0","tags":["k8s"],"title":"K8s Liveness_Readines","uri":"/k8s-liveness_readines/"},{"categories":["æ–‡æ¡£"],"content":"Etcd etcd æ˜¯ä¸€ä¸ªå¼€æºçš„ï¼Œ é«˜å¯ç”¨çš„åˆ†å¸ƒå¼çš„ key-value å­˜å‚¨ç³»ç»Ÿï¼Œ å¯ä»¥ç”¨äºé…åˆ¶å…±äº«å’ŒæœåŠ¡çš„æ³¨å†Œå’Œå‘ç° etcdå…·æœ‰çš„ç‰¹ç‚¹ å®Œå…¨å¤åˆ¶ï¼š é›†ç¾¤ä¸­çš„æ¯ä¸ªé˜¶æ®µéƒ½å¯ä»¥ä½¿ç”¨å®Œæ•´çš„æ–‡æ¡£ é«˜å¯ç”¨æ€§ï¼š Etcdå¯ç”¨äºé¿å…ç¡¬ä»¶çš„å•ç‚¹æ•…éšœæˆ–ç½‘ç»œé—®é¢˜ ä¸€è‡´æ€§ï¼š æ¯æ¬¡è¯»å–éƒ½ä¼šè¿”å›è·¨å¤šä¸»æœºçš„æœ€æ–°å†™å…¥ ç®€å•ï¼š åŒ…æ‹¬ä¸€ä¸ªå®šä¹‰è‰¯å¥½ã€é¢å‘ç”¨æˆ·çš„APIï¼ˆgRPCï¼‰ å®‰å…¨ï¼š å®ç°äº†å¸¦æœ‰å¯é€‰çš„å®¢æˆ·ç«¯è¯ä¹¦èº«ä»½éªŒè¯çš„è‡ªåŠ¨åŒ–TLS å¿«é€Ÿï¼š æ¯ç§’10000æ¬¡å†™å…¥çš„åŸºå‡†é€Ÿåº¦ å¯é ï¼š ç”¨Raftç®—æ³•å®ç°äº†å¼ºä¸€è‡´ã€é«˜å¯ç”¨çš„æœåŠ¡å­˜å‚¨ç›®å½• ","date":"2023-05-23","objectID":"/golang-etcd/:0:0","tags":["golang","etcd"],"title":"Golang Etcd","uri":"/golang-etcd/"},{"categories":["æ–‡æ¡£"],"content":"etcd çš„åº”ç”¨åœºæ™¯ æœåŠ¡å‘ç° æœåŠ¡å‘ç°è¦è§£å†³çš„ä¹Ÿæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æœ€å¸¸è§çš„é—®é¢˜ä¹‹ä¸€ï¼Œå³åœ¨åŒä¸€ä¸ªåˆ†å¸ƒå¼é›†ç¾¤ä¸­çš„è¿›ç¨‹æˆ–æœåŠ¡ï¼Œè¦å¦‚ä½•æ‰èƒ½æ‰¾åˆ°å¯¹æ–¹å¹¶å»ºç«‹è¿æ¥ã€‚æœ¬è´¨ä¸Šæ¥è¯´ï¼ŒæœåŠ¡å‘ç°å°±æ˜¯æƒ³è¦äº†è§£é›†ç¾¤ä¸­æ˜¯å¦æœ‰è¿›ç¨‹åœ¨ç›‘å¬ udp æˆ– tcp ç«¯å£ï¼Œå¹¶ä¸”é€šè¿‡åå­—å°±å¯ä»¥æŸ¥æ‰¾å’Œè¿æ¥ã€‚ Registry (figure) é…ç½®ä¸­å¿ƒ å°†ä¸€äº›é…ç½®å­˜æ”¾åœ¨etcd ä¸Šé›†ä¸­ç®¡ç† è¿™ç±»åœºæ™¯çš„ä½¿ç”¨æ–¹å¼é€šå¸¸æ˜¯è¿™æ ·ï¼šåº”ç”¨åœ¨å¯åŠ¨çš„æ—¶å€™ä¸»åŠ¨ä» etcd è·å–ä¸€æ¬¡é…ç½®ä¿¡æ¯ï¼ŒåŒæ—¶ï¼Œåœ¨ etcd èŠ‚ç‚¹ä¸Šæ³¨å†Œä¸€ä¸ª Watcher å¹¶ç­‰å¾…ï¼Œä»¥åæ¯æ¬¡é…ç½®æœ‰æ›´æ–°çš„æ—¶å€™ï¼Œetcd éƒ½ä¼šå®æ—¶é€šçŸ¥è®¢é˜…è€…ï¼Œä»¥æ­¤è¾¾åˆ°è·å–æœ€æ–°é…ç½®ä¿¡æ¯çš„ç›®çš„ åˆ†å¸ƒå¼é” å› ä¸º etcd ä½¿ç”¨ Raft ç®—æ³•ä¿æŒäº†æ•°æ®çš„å¼ºä¸€è‡´æ€§ï¼ŒæŸæ¬¡æ“ä½œå­˜å‚¨åˆ°é›†ç¾¤ä¸­çš„å€¼å¿…ç„¶æ˜¯å…¨å±€ä¸€è‡´çš„ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“å®ç°åˆ†å¸ƒå¼é”ã€‚é”æœåŠ¡æœ‰ä¸¤ç§ä½¿ç”¨æ–¹å¼ï¼Œä¸€æ˜¯ä¿æŒç‹¬å ï¼ŒäºŒæ˜¯æ§åˆ¶æ—¶åºã€‚ ä¿æŒç‹¬å å³æ‰€æœ‰è·å–é”çš„ç”¨æˆ·æœ€ç»ˆåªæœ‰ä¸€ä¸ªå¯ä»¥å¾—åˆ°ã€‚etcd ä¸ºæ­¤æä¾›äº†ä¸€å¥—å®ç°åˆ†å¸ƒå¼é”åŸå­æ“ä½œ CASï¼ˆCompareAndSwapï¼‰çš„ APIã€‚é€šè¿‡è®¾ç½®prevExistå€¼ï¼Œå¯ä»¥ä¿è¯åœ¨å¤šä¸ªèŠ‚ç‚¹åŒæ—¶å»åˆ›å»ºæŸä¸ªç›®å½•æ—¶ï¼Œåªæœ‰ä¸€ä¸ªæˆåŠŸã€‚è€Œåˆ›å»ºæˆåŠŸçš„ç”¨æˆ·å°±å¯ä»¥è®¤ä¸ºæ˜¯è·å¾—äº†é”ã€‚ æ§åˆ¶æ—¶åºï¼Œå³æ‰€æœ‰æƒ³è¦è·å¾—é”çš„ç”¨æˆ·éƒ½ä¼šè¢«å®‰æ’æ‰§è¡Œï¼Œä½†æ˜¯è·å¾—é”çš„é¡ºåºä¹Ÿæ˜¯å…¨å±€å”¯ä¸€çš„ï¼ŒåŒæ—¶å†³å®šäº†æ‰§è¡Œé¡ºåºã€‚etcd ä¸ºæ­¤ä¹Ÿæä¾›äº†ä¸€å¥— APIï¼ˆè‡ªåŠ¨åˆ›å»ºæœ‰åºé”®ï¼‰ï¼Œå¯¹ä¸€ä¸ªç›®å½•å»ºå€¼æ—¶æŒ‡å®šä¸ºPOSTåŠ¨ä½œï¼Œè¿™æ · etcd ä¼šè‡ªåŠ¨åœ¨ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªå½“å‰æœ€å¤§çš„å€¼ä¸ºé”®ï¼Œå­˜å‚¨è¿™ä¸ªæ–°çš„å€¼ï¼ˆå®¢æˆ·ç«¯ç¼–å·ï¼‰ã€‚åŒæ—¶è¿˜å¯ä»¥ä½¿ç”¨ API æŒ‰é¡ºåºåˆ—å‡ºæ‰€æœ‰å½“å‰ç›®å½•ä¸‹çš„é”®å€¼ã€‚æ­¤æ—¶è¿™äº›é”®çš„å€¼å°±æ˜¯å®¢æˆ·ç«¯çš„æ—¶åºï¼Œè€Œè¿™äº›é”®ä¸­å­˜å‚¨çš„å€¼å¯ä»¥æ˜¯ä»£è¡¨å®¢æˆ·ç«¯çš„ç¼–å· etcd_lock (figure) ","date":"2023-05-23","objectID":"/golang-etcd/:1:0","tags":["golang","etcd"],"title":"Golang Etcd","uri":"/golang-etcd/"},{"categories":["æ–‡æ¡£"],"content":"go æ“ä½œetcd ","date":"2023-05-23","objectID":"/golang-etcd/:2:0","tags":["golang","etcd"],"title":"Golang Etcd","uri":"/golang-etcd/"},{"categories":["æ–‡æ¡£"],"content":"å®‰è£… go get go.etcd.io/etcd/client/v3 ","date":"2023-05-23","objectID":"/golang-etcd/:3:0","tags":["golang","etcd"],"title":"Golang Etcd","uri":"/golang-etcd/"},{"categories":["æ–‡æ¡£"],"content":"putå’Œget æ“ä½œ package main import ( \"context\" \"fmt\" \"time\" clientv3 \"go.etcd.io/etcd/client/v3\" ) // etcd client put/get demo // use etcd/clientv3 func main() { cli, err := clientv3.New(clientv3.Config{ Endpoints: []string{\"127.0.0.1:2379\"}, DialTimeout: 5 * time.Second, }) if err != nil { // handle error! fmt.Printf(\"connect to etcd failed, err:%v\\n\", err) return } fmt.Println(\"connect to etcd success\") defer cli.Close() // put ctx, cancel := context.WithTimeout(context.Background(), time.Second) _, err = cli.Put(ctx, \"demo\", \"dsb\") cancel() if err != nil { fmt.Printf(\"put to etcd failed, err:%v\\n\", err) return } // get ctx, cancel = context.WithTimeout(context.Background(), time.Second) resp, err := cli.Get(ctx, \"demo\") cancel() if err != nil { fmt.Printf(\"get from etcd failed, err:%v\\n\", err) return } for _, ev := range resp.Kvs { fmt.Printf(\"%s:%s\\n\", ev.Key, ev.Value) } } ","date":"2023-05-23","objectID":"/golang-etcd/:4:0","tags":["golang","etcd"],"title":"Golang Etcd","uri":"/golang-etcd/"},{"categories":["æ–‡æ¡£"],"content":"watchæ“ä½œ watch ç”¨æ¥è·å–æœªæ¥æ›´æ”¹çš„é€šçŸ¥ package main import ( \"context\" \"fmt\" \"time\" clientv3 \"go.etcd.io/etcd/client/v3\" ) // watch demo func main() { cli, err := clientv3.New(clientv3.Config{ Endpoints: []string{\"127.0.0.1:2379\"}, DialTimeout: 5 * time.Second, }) if err != nil { fmt.Printf(\"connect to etcd failed, err:%v\\n\", err) return } fmt.Println(\"Connect to etcd successful\") defer cli.Close() // watch keys:demo changes rch := cli.Watch(context.Background(), \"demo\") for wresp := range rch { for _, ev := range wresp.Events { fmt.Printf(\"Type: %s Key:%s Value:%s\\n\", ev.Type, ev.Kv.Key, ev.Kv.Value) } } } è¿™ä¸ªç¨‹åºä¼šç­‰å¾… etcd ä¸­ demo è¿™ä¸ªkeyçš„å˜åŒ– æ‰“å¼€ç»ˆç«¯å¯¹ demo è¿™ä¸ªå‘½ä»¤ è®¾ç½® etcdctl put demo \"dsb01\" OK etcdctl del demo 1 etcdctl put demo \"ddd03\" OK watch ä¼šæ”¶åˆ°çš„é€šçŸ¥ Connect to etcd successful Type: PUT Key:demo Value:dsb01 Type: DELETE Key:demo Value: Type: PUT Key:demo Value:ddd03 ","date":"2023-05-23","objectID":"/golang-etcd/:4:1","tags":["golang","etcd"],"title":"Golang Etcd","uri":"/golang-etcd/"},{"categories":["æ–‡æ¡£"],"content":"lease ç§Ÿçº¦ package main import ( \"context\" \"fmt\" \"log\" \"time\" clientv3 \"go.etcd.io/etcd/client/v3\" ) // watch demo func main() { cli, err := clientv3.New(clientv3.Config{ Endpoints: []string{\"127.0.0.1:2379\"}, DialTimeout: 5 * time.Second, }) if err != nil { fmt.Printf(\"connect to etcd failed, err:%v\\n\", err) return } fmt.Println(\"Connect to etcd successful\") defer cli.Close() //etcd lease // åˆ›å»ºä¸€ä¸ª5sçš„ç§Ÿçº¦ resp, err := cli.Grant(context.TODO(), 5) if err != nil { log.Fatal(err.Error()) } // 5sä¹‹åï¼Œ /demo/ è¿™ä¸ªkeyå°±ä¼šè¢«ç§»é™¤ _, err = cli.Put(context.TODO(), \"/demo/\", \"bbb\", clientv3.WithLease(resp.ID)) if err != nil { log.Fatal(err.Error()) } } ","date":"2023-05-23","objectID":"/golang-etcd/:5:0","tags":["golang","etcd"],"title":"Golang Etcd","uri":"/golang-etcd/"},{"categories":["æ–‡æ¡£"],"content":"keepAlive package main import ( \"context\" \"fmt\" \"log\" \"time\" clientv3 \"go.etcd.io/etcd/client/v3\" ) // watch demo func main() { cli, err := clientv3.New(clientv3.Config{ Endpoints: []string{\"127.0.0.1:2379\"}, DialTimeout: 5 * time.Second, }) if err != nil { fmt.Printf(\"connect to etcd failed, err:%v\\n\", err) return } fmt.Println(\"Connect to etcd successful\") defer cli.Close() //etcd lease // åˆ›å»ºä¸€ä¸ª5sçš„ç§Ÿçº¦ resp, err := cli.Grant(context.TODO(), 5) if err != nil { log.Fatal(err.Error()) } // 5sä¹‹åï¼Œ /demo/ è¿™ä¸ªkeyå°±ä¼šè¢«ç§»é™¤ _, err = cli.Put(context.TODO(), \"/demo/\", \"bbb\", clientv3.WithLease(resp.ID)) if err != nil { log.Fatal(err.Error()) } // the key 'foo' will be kept forever ch, haerr := cli.KeepAlive(context.TODO(), resp.ID) if haerr != nil { log.Fatal(err.Error()) } for { ha := \u003c-ch fmt.Println(\"ttl: \", ha.TTL) } } ","date":"2023-05-23","objectID":"/golang-etcd/:6:0","tags":["golang","etcd"],"title":"Golang Etcd","uri":"/golang-etcd/"},{"categories":["æ–‡æ¡£"],"content":"åŸºäºetcd å®ç°åˆ†å¸ƒå¼é” go.etcd.io/etcd/client/v3/concurrency åœ¨etcdä¹‹ä¸Šå®ç°å¹¶å‘æ“ä½œï¼Œ å¦‚åˆ†å¸ƒå¼é”/å±éšœå’Œé€‰ä¸¾ å€’å…¥åŒ… import \"go.etcd.io/etcd/client/v3/concurrency\" åŸºäºetcd å®ç°åˆ†å¸ƒå¼é”çš„ç¤ºä¾‹ package main import ( \"context\" \"fmt\" \"log\" \"time\" clientv3 \"go.etcd.io/etcd/client/v3\" \"go.etcd.io/etcd/client/v3/concurrency\" ) // watch demo func main() { cli, err := clientv3.New(clientv3.Config{ Endpoints: []string{\"127.0.0.1:2379\"}, DialTimeout: 5 * time.Second, }) if err != nil { fmt.Printf(\"connect to etcd failed, err:%v\\n\", err) return } fmt.Println(\"Connect to etcd successful\") defer cli.Close() // åˆ›å»ºä¸¤ä¸ªå•ç‹¬çš„ä¼šè¯æ¥æ¼”ç¤ºç«äº‰é” s1, err := concurrency.NewSession(cli) if err != nil { log.Fatal(err.Error()) } defer s1.Close() m1 := concurrency.NewMutex(s1, \"/my-lock/\") s2, err := concurrency.NewSession(cli) if err != nil { log.Fatal(err.Error()) } defer s2.Close() m2 := concurrency.NewMutex(s2, \"/my-lock/\") // ä¼šè¯s1 è·å–é” if err := m1.Lock(context.TODO()); err != nil { log.Fatal(err.Error()) } fmt.Println(\"acquired lock for s1\") m2Locked := make(chan struct{}) go func() { defer close(m2Locked) // ç­‰å¾…ä¹‹åä¼šè¯s1 é‡Šæ”¾äº†/my-lock/çš„é” if err := m2.Lock(context.TODO()); err != nil { log.Fatal(err.Error()) } fmt.Println(\"acquired lock for s2\") }() if err := m1.Unlock(context.TODO()); err != nil { log.Fatal(err.Error()) } fmt.Println(\"release lock for s1\") \u003c-m2Locked fmt.Println(\"release lock for s2\") } è¾“å‡ºç»“æœ Connect to etcd successful acquired lock for s1 release lock for s1 acquired lock for s2 release lock for s2 å‚è€ƒé“¾æ¥ https://pkg.go.dev/go.etcd.io/etcd/clientv3/concurrency https://github.com/etcd-io/etcd/tree/main/client/v3 ","date":"2023-05-23","objectID":"/golang-etcd/:7:0","tags":["golang","etcd"],"title":"Golang Etcd","uri":"/golang-etcd/"},{"categories":["æ–‡æ¡£"],"content":"MongoDB ","date":"2023-05-23","objectID":"/golang-mongodb/:0:0","tags":["golang","mongoDB"],"title":"Golang MangoDB","uri":"/golang-mongodb/"},{"categories":["æ–‡æ¡£"],"content":"MongoDBä»‹ç» mongoDBæ˜¯åŸºäºåˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨çš„æ•°æ®åº“ï¼Œæ˜¯ä¸€ä¸ªä»‹äºå…³ç³»å‹æ•°æ®åº“å’Œéå…³ç³»æ•°æ®åº“ä¹‹é—´çš„äº§å“ mongoDBå°†ä¸€æ¡æ•°æ®å­˜å‚¨ä¸ºä¸€ä¸ªæ–‡æ¡£ï¼Œ æ•°æ®ç»“æ„ç”±é”®å€¼å¯¹ç»„æˆï¼Œ å…¶ä¸­æ–‡æ¡£ç±»ä¼¼æˆ‘ä»¬ç¼–è¾‘ä¸­ç”¨åˆ°çš„JSONå¯¹è±¡ï¼Œæ–‡æ¡£ä¸­çš„å­—æ®µå€¼å¯ä»¥åŒ…å«å…¶ä»–æ–‡æ¡£/æ•°ç»„åŠæ–‡æ¡£æ•°ç»„ MongoDBæœ¯è¯­ è¯´æ˜ SQLæœ¯è¯­ database æ•°æ®åº“ database collection é›†åˆ table document æ–‡æ¡£ row field å­—æ®µ column index index ç´¢å¼• primary key ä¸»é”® MongoDBè‡ªåŠ¨å°†_idå­—æ®µè®¾ç½®ä¸ºä¸»é”® primary key ","date":"2023-05-23","objectID":"/golang-mongodb/:1:0","tags":["golang","mongoDB"],"title":"Golang MangoDB","uri":"/golang-mongodb/"},{"categories":["æ–‡æ¡£"],"content":"mongoDBå®‰è£… docker pull mongo:latest docker run -itd --name mongo -p 27017:27017 mongo --auth å‚æ•°è¯´æ˜ -p 27017:27017 ï¼šæ˜ å°„å®¹å™¨æœåŠ¡çš„ 27017 ç«¯å£åˆ°å®¿ä¸»æœºçš„ 27017 ç«¯å£ã€‚å¤–éƒ¨å¯ä»¥ç›´æ¥é€šè¿‡ å®¿ä¸»æœº ip:27017 è®¿é—®åˆ° mongo çš„æœåŠ¡ã€‚ â€“authï¼šéœ€è¦å¯†ç æ‰èƒ½è®¿é—®å®¹å™¨æœåŠ¡ã€‚ ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ·»åŠ ç”¨æˆ·å’Œè®¾ç½®å¯†ç ï¼Œå¹¶ä¸”å°è¯•è¿æ¥ $ docker exec -it mongo mongosh admin # åˆ›å»ºä¸€ä¸ªåä¸º adminï¼Œå¯†ç ä¸º 123456 çš„ç”¨æˆ·ã€‚ \u003e db.createUser({ user:'admin',pwd:'123456',roles:[ { role:'userAdminAnyDatabase', db: 'admin'},\"readWriteAnyDatabase\"]}); # å°è¯•ä½¿ç”¨ä¸Šé¢åˆ›å»ºçš„ç”¨æˆ·ä¿¡æ¯è¿›è¡Œè¿æ¥ã€‚ \u003e db.auth('admin', '123456') è¿æ¥ mongo docker exec -it mongo mongosh admin ","date":"2023-05-23","objectID":"/golang-mongodb/:2:0","tags":["golang","mongoDB"],"title":"Golang MangoDB","uri":"/golang-mongodb/"},{"categories":["æ–‡æ¡£"],"content":"golang æ“ä½œmongo DB å®‰è£…mongoDB Goé©±åŠ¨åŒ… go get github.com/mongodb/mongo-go-driver Goä»£ç è¿æ¥mongoDB package main import ( \"context\" \"fmt\" \"log\" \"go.mongodb.org/mongo-driver/mongo\" \"go.mongodb.org/mongo-driver/mongo/options\" ) func main() { // è®¾ç½®å®¢æˆ·ç«¯è¿æ¥é…ç½® clientOptions := options.Client().ApplyURI(\"mongodb://192.168.0.9:27017\") // è¿æ¥åˆ°MongoDB client, err := mongo.Connect(context.TODO(), clientOptions) if err != nil { log.Fatal(err) } // æ£€æŸ¥è¿æ¥ err = client.Ping(context.TODO(), nil) if err != nil { log.Fatal(err) } fmt.Println(\"Connected to MongoDB!\") } å¤„ç†æ•°æ®é›† // æŒ‡å®šè·å–è¦æ“ä½œçš„æ•°æ®é›† collection := client.Database(\"demo\").Collection(\"student\") å¤„ç†å®Œä»»åŠ¡ä¹‹åå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ–­å¼€ä¸MongoDBçš„è¿æ¥ // æ–­å¼€è¿æ¥ err = client.Disconnect(context.TODO()) if err != nil { log.Fatal(err) } fmt.Println(\"Connection to MongoDB closed.\") ","date":"2023-05-23","objectID":"/golang-mongodb/:3:0","tags":["golang","mongoDB"],"title":"Golang MangoDB","uri":"/golang-mongodb/"},{"categories":["æ–‡æ¡£"],"content":"è¿æ¥æ± æ¨¡å¼ import ( \"context\" \"time\" \"go.mongodb.org/mongo-driver/mongo\" \"go.mongodb.org/mongo-driver/mongo/options\" ) func ConnectToDB(uri, name string, timeout time.Duration, num uint64) (*mongo.Database, error) { ctx, cancel := context.WithTimeout(context.Background(), timeout) defer cancel() o := options.Client().ApplyURI(uri) o.SetMaxPoolSize(num) client, err := mongo.Connect(ctx, o) if err != nil { return nil, err } return client.Database(name), nil } ","date":"2023-05-23","objectID":"/golang-mongodb/:4:0","tags":["golang","mongoDB"],"title":"Golang MangoDB","uri":"/golang-mongodb/"},{"categories":["æ–‡æ¡£"],"content":"BSON mongoDBä¸­çš„JSONæ–‡æ¡£å­˜å‚¨åœ¨BSONçš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­ BSONç¼–ç æ‹“å±•äº†JSONè¡¨ç¤ºï¼Œä½¿å…¶åŒ…å«é¢å¤–çš„ç±»å‹å¦‚ int\\long\\date\\æµ®ç‚¹æ•°å’Œdecimal128ï¼Œ æ˜¯åº”ç”¨ç¨‹åºæ›´å®¹æ˜“å¯é çš„å¤„ç†ã€æ’åºå’Œæ¯”è¾ƒæ•°æ® è¦ä½¿ç”¨BSON éœ€è¦å€’å…¥åŒ… import \"go.mongodb.org/mongo-driver/bson\" ä½¿ç”¨Dç±»å‹æ„å»ºçš„è¿‡æ»¤æ–‡æ¡£çš„ç†æ™ºï¼Œ å®ƒå¯ä»¥ç”¨æ¥æŸ¥è¯¢nameå­—æ®µä¸â€™å¼ ä¸‰â€™æˆ–â€™æå››â€™åŒ¹é…çš„æ–‡æ¡£ bson.D{{ \"name\", bson.D{{ \"$in\", bson.A{\"å¼ ä¸‰\", \"æå››\"}, }}, }} ","date":"2023-05-23","objectID":"/golang-mongodb/:5:0","tags":["golang","mongoDB"],"title":"Golang MangoDB","uri":"/golang-mongodb/"},{"categories":["æ–‡æ¡£"],"content":"CURD å®šä¹‰ä¸€ä¸ªStudentç±»å‹ type Student struct { Name string Age int } å‡†å¤‡æ•°æ® s1 := Student{\"å¼ ä¸‰\", 12} s2 := Student{\"æå››\", 10} s3 := Student{\"ç‹äº”\", 11} æ’å…¥ä¸€æ¡æ–‡æ¡£è®°å½• insertResult, err := collection.InsertOne(context.TODO(), s1) if err != nil { log.Fatal(err) } fmt.Println(\"Inserted a single document: \", insertResult.InsertedID) æ’å…¥å¤šæ¡æ–‡æ¡£ students := []interface{}{s2, s3} insertManyResult, err := collection.InsertMany(context.TODO(), students) if err != nil { log.Fatal(err) } fmt.Println(\"Inserted multiple documents: \", insertManyResult.InsertedIDs) ","date":"2023-05-23","objectID":"/golang-mongodb/:6:0","tags":["golang","mongoDB"],"title":"Golang MangoDB","uri":"/golang-mongodb/"},{"categories":["æ–‡æ¡£"],"content":"æ›´æ–°æ–‡æ¡£ updateone() æ–¹æ³•å…è®¸ä½ æ›´æ–°å½“ä¸ªæ–‡æ¡£ï¼Œéœ€è¦ä¸€ä¸ªç­›é€‰å™¨æ–‡æ¡£æ¥æ‰¹è¯„æ•°æ®åº“ä¸­çš„æ–‡æ¡£ï¼Œ å¹¶éœ€è¦ä¸€ä¸ªæ›´æ–°æ–‡æ¡£æ¥æè¿°æ›´æ–°æ“ä½œï¼Œ ä½¿ç”¨bson.D ç±»å‹æ¥æ„å»ºç­›é€‰æ–‡æ¡£å’Œæ›´æ–°æ–‡æ¡£ filter := bson.D{{\"name\", \"å°å…°\"}} update := bson.D{ {\"$inc\", bson.D{ {\"age\", 1}, }}, } updateResult, err := collection.UpdateOne(context.TODO(), filter, update) if err != nil { log.Fatal(err) } fmt.Printf(\"Matched %v documents and updated %v documents.\\n\", updateResult.MatchedCount, updateResult.ModifiedCount) ","date":"2023-05-23","objectID":"/golang-mongodb/:6:1","tags":["golang","mongoDB"],"title":"Golang MangoDB","uri":"/golang-mongodb/"},{"categories":["æ–‡æ¡£"],"content":"æŸ¥æ‰¾æ–‡æ¡£ æ‰¾åˆ°ä¸€ä¸ªæ–‡æ¡£ï¼Œéœ€è¦ä¸€ä¸ªfilteræ–‡æ¡£ï¼Œ ä»¥åŠä¸€ä¸ªæŒ‡å‘å¯ä»¥å°†ç»“æ„è§£ç ä¸ºå…¶å€¼çš„æŒ‡é’ˆ è¦æŸ¥æ‰¾å•ä¸ªæ–‡æ¡£ï¼Œ ä½¿ç”¨collection.FindOne()ã€‚è¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªå¯ä»¥è§£ç ä¸ºå€¼çš„ç»“æœ // åˆ›å»ºä¸€ä¸ªStudentå˜é‡ç”¨æ¥æ¥æ”¶æŸ¥è¯¢çš„ç»“æœ var result Student err = collection.FindOne(context.TODO(), filter).Decode(\u0026result) if err != nil { log.Fatal(err) } fmt.Printf(\"Found a single document: %+v\\n\", result) è¦æŸ¥æ‰¾å¤šä¸ªæ–‡æ¡£ï¼Œè¯·ä½¿ç”¨collection.Find()ã€‚æ­¤æ–¹æ³•è¿”å›ä¸€ä¸ªæ¸¸æ ‡ã€‚æ¸¸æ ‡æä¾›äº†ä¸€ä¸ªæ–‡æ¡£æµï¼Œä½ å¯ä»¥é€šè¿‡å®ƒä¸€æ¬¡è¿­ä»£å’Œè§£ç ä¸€ä¸ªæ–‡æ¡£ã€‚å½“æ¸¸æ ‡ç”¨å®Œä¹‹åï¼Œåº”è¯¥å…³é—­æ¸¸æ ‡ã€‚ä¸‹é¢çš„ç¤ºä¾‹å°†ä½¿ç”¨optionsåŒ…è®¾ç½®ä¸€ä¸ªé™åˆ¶ä»¥ä¾¿åªè¿”å›ä¸¤ä¸ªæ–‡æ¡£ã€‚ // æŸ¥è¯¢å¤šä¸ª // å°†é€‰é¡¹ä¼ é€’ç»™Find() findOptions := options.Find() findOptions.SetLimit(2) // å®šä¹‰ä¸€ä¸ªåˆ‡ç‰‡ç”¨æ¥å­˜å‚¨æŸ¥è¯¢ç»“æœ var results []*Student // æŠŠbson.D{{}}ä½œä¸ºä¸€ä¸ªfilteræ¥åŒ¹é…æ‰€æœ‰æ–‡æ¡£ cur, err := collection.Find(context.TODO(), bson.D{{}}, findOptions) if err != nil { log.Fatal(err) } // æŸ¥æ‰¾å¤šä¸ªæ–‡æ¡£è¿”å›ä¸€ä¸ªå…‰æ ‡ // éå†æ¸¸æ ‡å…è®¸æˆ‘ä»¬ä¸€æ¬¡è§£ç ä¸€ä¸ªæ–‡æ¡£ for cur.Next(context.TODO()) { // åˆ›å»ºä¸€ä¸ªå€¼ï¼Œå°†å•ä¸ªæ–‡æ¡£è§£ç ä¸ºè¯¥å€¼ var elem Student err := cur.Decode(\u0026elem) if err != nil { log.Fatal(err) } results = append(results, \u0026elem) } if err := cur.Err(); err != nil { log.Fatal(err) } // å®Œæˆåå…³é—­æ¸¸æ ‡ cur.Close(context.TODO()) fmt.Printf(\"Found multiple documents (array of pointers): %#v\\n\", results) ","date":"2023-05-23","objectID":"/golang-mongodb/:7:0","tags":["golang","mongoDB"],"title":"Golang MangoDB","uri":"/golang-mongodb/"},{"categories":["æ–‡æ¡£"],"content":"åˆ é™¤æ–‡æ¡£ ä½¿ç”¨collection.DeleteOne()æˆ–collection.DeleteMany()åˆ é™¤æ–‡æ¡£ã€‚å¦‚æœä½ ä¼ é€’bson.D{{}}ä½œä¸ºè¿‡æ»¤å™¨å‚æ•°ï¼Œå®ƒå°†åŒ¹é…æ•°æ®é›†ä¸­çš„æ‰€æœ‰æ–‡æ¡£ã€‚è¿˜å¯ä»¥ä½¿ç”¨collection. drop()åˆ é™¤æ•´ä¸ªæ•°æ®é›†ã€‚ // åˆ é™¤åå­—æ˜¯å°é»„çš„é‚£ä¸ª deleteResult1, err := collection.DeleteOne(context.TODO(), bson.D{{\"name\",\"å°é»„\"}}) if err != nil { log.Fatal(err) } fmt.Printf(\"Deleted %v documents in the trainers collection\\n\", deleteResult1.DeletedCount) // åˆ é™¤æ‰€æœ‰ deleteResult2, err := collection.DeleteMany(context.TODO(), bson.D{{}}) if err != nil { log.Fatal(err) } fmt.Printf(\"Deleted %v documents in the trainers collection\\n\", deleteResult2.DeletedCount) å‚è€ƒé“¾æ¥ https://pkg.go.dev/go.mongodb.org/mongo-driver/mongo ","date":"2023-05-23","objectID":"/golang-mongodb/:8:0","tags":["golang","mongoDB"],"title":"Golang MangoDB","uri":"/golang-mongodb/"},{"categories":["æ–‡æ¡£"],"content":"Redis ","date":"2023-05-23","objectID":"/golang-redis/:0:0","tags":["golang","redis"],"title":"Golang Redis","uri":"/golang-redis/"},{"categories":["æ–‡æ¡£"],"content":"Redis ä»‹ç» Redisæ˜¯ä¸€ä¸ªå¼€æºçš„å†…å­˜æ•°æ®åº“ï¼Œæä¾›äº†å¤šç§ä¸åŒçš„æ•°æ®ç»“æ„ï¼Œ é€šè¿‡å¤åˆ¶ã€æŒä¹…åŒ–/å®¢æˆ·ç«¯åˆ†ç‰‡ç­‰ç‰¹æ€§ï¼Œ æ–¹ä¾¿çš„å°†Redis æ‹“å±•æˆä¸€ä¸ªåŒ…å«æ•°ç™¾GBçš„æ•°æ®ï¼Œ å¤„ç†ä¸Šç™¾ä¸‡æ¬¡è¯·æ±‚ Redis æ”¯æŒçš„æ•°æ®ç»“æ„ string hashe list set sortedset bitmap stream Redis åº”ç”¨åœºæ™¯ ç¼“å­˜ç³»ç»Ÿï¼Œå‡è½»mysqlçš„å‹åŠ› è®¡æ•°ç³»ç»Ÿï¼Œ çƒ­é—¨æ’è¡Œæ¦œ åˆ©ç”¨LIST å®ç°é˜Ÿåˆ—åŠŸèƒ½ åˆ©ç”¨HyperLog ç»Ÿè®¡UVã€PVç­‰æ•°æ® ä½¿ç”¨geospatial index è¿›è¡Œåœ°ç†ä½ç½®ç›¸å…³çš„æŸ¥è¯¢ ","date":"2023-05-23","objectID":"/golang-redis/:1:0","tags":["golang","redis"],"title":"Golang Redis","uri":"/golang-redis/"},{"categories":["æ–‡æ¡£"],"content":"docker å®‰è£…Reids å¯åŠ¨redis docker run --name redis507 -p 6379:6379 -d redis:5.0.7 è¿æ¥redis server docker run -it --network host --rm redis:5.0.7 redis-cli ","date":"2023-05-23","objectID":"/golang-redis/:2:0","tags":["golang","redis"],"title":"Golang Redis","uri":"/golang-redis/"},{"categories":["æ–‡æ¡£"],"content":"go-redisåº“ å®‰è£… go get github.com/go-redis/redis/v8 è¿æ¥ ","date":"2023-05-23","objectID":"/golang-redis/:3:0","tags":["golang","redis"],"title":"Golang Redis","uri":"/golang-redis/"},{"categories":["æ–‡æ¡£"],"content":"æ™®é€šæ¨¡å¼è¿æ¥ ä½¿ç”¨redis.NewClient å‡½æ•°è¿æ¥RedisæœåŠ¡å™¨ rdb := redis.NewClient(\u0026redis.Options{ Addr: \"localhost:6379\", Password: \"\", // å¯†ç  DB: 0, // æ•°æ®åº“ PoolSize: 20, // è¿æ¥æ± å¤§å° }) è°ä¹Ÿredis.ParseURL å‡½æ•°è¡¨ç¤ºæ•°æ®æºçš„å­—ç¬¦ä¸²è§£æRedis opt, err := redis.ParseURL(\"redis://\u003cuser\u003e:\u003cpass\u003e@localhost:6379/\u003cdb\u003e\") if err != nil { panic(err) } rdb := redis.NewClient(opt) TLS æ¨¡å¼ rdb := redis.NewClient(\u0026redis.Options{ TLSConfig: \u0026tls.Config{ MinVersion: tls.VersionTLS12, // Certificates: []tls.Certificate{cert}, // ServerName: \"your.domain.com\", }, }) Redis Sentinelæ¨¡å¼ rdb := redis.NewFailoverClient(\u0026redis.FailoverOptions{ MasterName: \"master-name\", SentinelAddrs: []string{\":9126\", \":9127\", \":9128\"}, }) Redis Clusteræ¨¡å¼ rdb := redis.NewClusterClient(\u0026redis.ClusterOptions{ Addrs: []string{\":7000\", \":7001\", \":7002\", \":7003\", \":7004\", \":7005\"}, // è‹¥è¦æ ¹æ®å»¶è¿Ÿæˆ–éšæœºè·¯ç”±å‘½ä»¤ï¼Œè¯·å¯ç”¨ä»¥ä¸‹å‘½ä»¤ä¹‹ä¸€ // RouteByLatency: true, // RouteRandomly: true, }) ","date":"2023-05-23","objectID":"/golang-redis/:3:1","tags":["golang","redis"],"title":"Golang Redis","uri":"/golang-redis/"},{"categories":["æ–‡æ¡£"],"content":"åŸºæœ¬ä½¿ç”¨ redisåŸºç¡€æ“ä½œ // doCommand go-redisåŸºæœ¬ä½¿ç”¨ç¤ºä¾‹ func doCommand() { ctx, cancel := context.WithTimeout(context.Background(), 500*time.Millisecond) defer cancel() // æ‰§è¡Œå‘½ä»¤è·å–ç»“æœ val, err := rdb.Get(ctx, \"key\").Result() fmt.Println(val, err) // å…ˆè·å–åˆ°å‘½ä»¤å¯¹è±¡ cmder := rdb.Get(ctx, \"key\") fmt.Println(cmder.Val()) // è·å–å€¼ fmt.Println(cmder.Err()) // è·å–é”™è¯¯ // ç›´æ¥æ‰§è¡Œå‘½ä»¤è·å–é”™è¯¯ err = rdb.Set(ctx, \"key\", 10, time.Hour).Err() // ç›´æ¥æ‰§è¡Œå‘½ä»¤è·å–å€¼ value := rdb.Get(ctx, \"key\").Val() fmt.Println(value) } æ‰§è¡Œä»»æ„å‘½ä»¤ Doæ–¹æ³•å¯ä»¥å½¢è±¡ä»»æ„å‘½ä»¤ // doDemo rdb.Do æ–¹æ³•ä½¿ç”¨ç¤ºä¾‹ func doDemo() { ctx, cancel := context.WithTimeout(context.Background(), 500*time.Millisecond) defer cancel() // ç›´æ¥æ‰§è¡Œå‘½ä»¤è·å–é”™è¯¯ err := rdb.Do(ctx, \"set\", \"key\", 10, \"EX\", 3600).Err() fmt.Println(err) // æ‰§è¡Œå‘½ä»¤è·å–ç»“æœ val, err := rdb.Do(ctx, \"get\", \"key\").Result() fmt.Println(val, err) } Redis.Nil Nilé”™è¯¯æ¥è¡¨ç¤ºKeyä¸å­˜åœ¨çš„é”™è¯¯ // getValueFromRedis redis.Nilåˆ¤æ–­ func getValueFromRedis(key, defaultValue string) (string, error) { ctx, cancel := context.WithTimeout(context.Background(), 500*time.Millisecond) defer cancel() val, err := rdb.Get(ctx, key).Result() if err != nil { // å¦‚æœè¿”å›çš„é”™è¯¯æ˜¯keyä¸å­˜åœ¨ if errors.Is(err, redis.Nil) { return defaultValue, nil } // å‡ºå…¶ä»–é”™äº† return \"\", err } return val, nil } ","date":"2023-05-23","objectID":"/golang-redis/:4:0","tags":["golang","redis"],"title":"Golang Redis","uri":"/golang-redis/"},{"categories":["æ–‡æ¡£"],"content":"zsetç¤ºä¾‹ go-redis æ“ä½œzset // zsetDemo æ“ä½œzsetç¤ºä¾‹ func zsetDemo() { // key zsetKey := \"language_rank\" // value languages := []*redis.Z{ {Score: 90.0, Member: \"Golang\"}, {Score: 98.0, Member: \"Java\"}, {Score: 95.0, Member: \"Python\"}, {Score: 97.0, Member: \"JavaScript\"}, {Score: 99.0, Member: \"C/C++\"}, } ctx, cancel := context.WithTimeout(context.Background(), 500*time.Millisecond) defer cancel() // ZADD err := rdb.ZAdd(ctx, zsetKey, languages...).Err() if err != nil { fmt.Printf(\"zadd failed, err:%v\\n\", err) return } fmt.Println(\"zadd success\") // æŠŠGolangçš„åˆ†æ•°åŠ 10 newScore, err := rdb.ZIncrBy(ctx, zsetKey, 10.0, \"Golang\").Result() if err != nil { fmt.Printf(\"zincrby failed, err:%v\\n\", err) return } fmt.Printf(\"Golang's score is %f now.\\n\", newScore) // å–åˆ†æ•°æœ€é«˜çš„3ä¸ª ret := rdb.ZRevRangeWithScores(ctx, zsetKey, 0, 2).Val() for _, z := range ret { fmt.Println(z.Member, z.Score) } // å–95~100åˆ†çš„ op := \u0026redis.ZRangeBy{ Min: \"95\", Max: \"100\", } ret, err = rdb.ZRangeByScoreWithScores(ctx, zsetKey, op).Result() if err != nil { fmt.Printf(\"zrangebyscore failed, err:%v\\n\", err) return } for _, z := range ret { fmt.Println(z.Member, z.Score) } } ","date":"2023-05-23","objectID":"/golang-redis/:5:0","tags":["golang","redis"],"title":"Golang Redis","uri":"/golang-redis/"},{"categories":["æ–‡æ¡£"],"content":"æ‰«æéå†æ‰€æœ‰Key ä½¿ç”¨KEYS prefix:* è·å–å‰ç¼€è·å–æ‰€æœ‰key vals, err := rdb.Keys(ctx, \"prefix*\").Result() // scanKeysDemo1 æŒ‰å‰ç¼€æŸ¥æ‰¾æ‰€æœ‰keyç¤ºä¾‹ func scanKeysDemo1() { ctx, cancel := context.WithTimeout(context.Background(), 500*time.Millisecond) defer cancel() var cursor uint64 for { var keys []string var err error // æŒ‰å‰ç¼€æ‰«ækey keys, cursor, err = rdb.Scan(ctx, cursor, \"prefix:*\", 0).Result() if err != nil { panic(err) } for _, key := range keys { fmt.Println(\"key\", key) } if cursor == 0 { // no more keys break } } } ç®€åŒ– // scanKeysDemo2 æŒ‰å‰ç¼€æ‰«ækeyç¤ºä¾‹ func scanKeysDemo2() { ctx, cancel := context.WithTimeout(context.Background(), 500*time.Millisecond) defer cancel() // æŒ‰å‰ç¼€æ‰«ækey iter := rdb.Scan(ctx, 0, \"prefix:*\", 0).Iterator() for iter.Next(ctx) { fmt.Println(\"keys\", iter.Val()) } if err := iter.Err(); err != nil { panic(err) } } æ”¯æŒå°†æ‰€æœ‰åŒ¹é…æŒ‡å®šçš„æ¨¡å¼keyåˆ é™¤çš„ç¤ºä¾‹ // delKeysByMatch æŒ‰matchæ ¼å¼æ‰«ææ‰€æœ‰keyå¹¶åˆ é™¤ func delKeysByMatch(match string, timeout time.Duration) { ctx, cancel := context.WithTimeout(context.Background(), timeout) defer cancel() iter := rdb.Scan(ctx, 0, match, 0).Iterator() for iter.Next(ctx) { err := rdb.Del(ctx, iter.Val()).Err() if err != nil { panic(err) } } if err := iter.Err(); err != nil { panic(err) } } æ”¯æŒ set ã€ hashã€zset æ•°æ®ç±»å‹ï¼Œ éå† iter := rdb.SScan(ctx, \"set-key\", 0, \"prefix:*\", 0).Iterator() iter := rdb.HScan(ctx, \"hash-key\", 0, \"prefix:*\", 0).Iterator() iter := rdb.ZScan(ctx, \"sorted-hash-key\", 0, \"prefix:*\", 0).Iterator( ","date":"2023-05-23","objectID":"/golang-redis/:6:0","tags":["golang","redis"],"title":"Golang Redis","uri":"/golang-redis/"},{"categories":["æ–‡æ¡£"],"content":"Pipeline Redis Pipeline å…è®¸é€šè¿‡ä½¿ç”¨å•ä¸ª client-server-client å¾€è¿”æ‰§è¡Œå¤šä¸ªå‘½ä»¤æ¥æé«˜æ€§èƒ½ã€‚åŒºåˆ«äºä¸€ä¸ªæ¥ä¸€ä¸ªåœ°æ‰§è¡Œ100ä¸ªå‘½ä»¤ï¼Œä½ å¯ä»¥å°†è¿™äº›å‘½ä»¤æ”¾å…¥ pipeline ä¸­ï¼Œç„¶åä½¿ç”¨1æ¬¡è¯»å†™æ“ä½œåƒæ‰§è¡Œå•ä¸ªå‘½ä»¤ä¸€æ ·æ‰§è¡Œå®ƒä»¬ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯èŠ‚çœäº†æ‰§è¡Œå‘½ä»¤çš„ç½‘ç»œå¾€è¿”æ—¶é—´ï¼ˆRTTï¼‰ã€‚ pipe := rdb.Pipeline() incr := pipe.Incr(ctx, \"pipeline_counter\") pipe.Expire(ctx, \"pipeline_counter\", time.Hour) cmds, err := pipe.Exec(ctx) if err != nil { panic(err) } // åœ¨æ‰§è¡Œpipe.Execä¹‹åæ‰èƒ½è·å–åˆ°ç»“æœ fmt.Println(incr.Val()) ä½¿ç”¨Pipelined æ–¹æ³•ï¼Œå®ƒä¼šåœ¨å‡½æ•°é€€å‡ºæ—¶è°ƒç”¨ Exec var incr *redis.IntCmd cmds, err := rdb.Pipelined(ctx, func(pipe redis.Pipeliner) error { incr = pipe.Incr(ctx, \"pipelined_counter\") pipe.Expire(ctx, \"pipelined_counter\", time.Hour) return nil }) if err != nil { panic(err) } // åœ¨pipelineæ‰§è¡Œåè·å–åˆ°ç»“æœ fmt.Println(incr.Val()) éå† pipeline å‘½ä»¤çš„è¿”å›å€¼ä¾æ¬¡è·å–æ¯ä¸ªå‘½ä»¤çš„ç»“æœã€‚ä¸‹æ–¹çš„ç¤ºä¾‹ä»£ç ä¸­ä½¿ç”¨pipilineä¸€æ¬¡æ‰§è¡Œäº†100ä¸ª Get å‘½ä»¤ï¼Œåœ¨pipeline æ‰§è¡Œåéå†å–å‡º100ä¸ªå‘½ä»¤çš„æ‰§è¡Œç»“æœã€‚ cmds, err := rdb.Pipelined(ctx, func(pipe redis.Pipeliner) error { for i := 0; i \u003c 100; i++ { pipe.Get(ctx, fmt.Sprintf(\"key%d\", i)) } return nil }) if err != nil { panic(err) } for _, cmd := range cmds { fmt.Println(cmd.(*redis.StringCmd).Val()) } ","date":"2023-05-23","objectID":"/golang-redis/:7:0","tags":["golang","redis"],"title":"Golang Redis","uri":"/golang-redis/"},{"categories":["æ–‡æ¡£"],"content":"äº‹åŠ¡ ä½¿ç”¨ TxPipeline æˆ– TxPipelined æ–¹æ³•å°† pipeline å‘½ä»¤ä½¿ç”¨ MULTI å’ŒEXECåŒ…è£¹èµ·æ¥ã€‚ // TxPipeline demo pipe := rdb.TxPipeline() incr := pipe.Incr(ctx, \"tx_pipeline_counter\") pipe.Expire(ctx, \"tx_pipeline_counter\", time.Hour) _, err := pipe.Exec(ctx) fmt.Println(incr.Val(), err) // TxPipelined demo var incr2 *redis.IntCmd _, err = rdb.TxPipelined(ctx, func(pipe redis.Pipeliner) error { incr2 = pipe.Incr(ctx, \"tx_pipeline_counter\") pipe.Expire(ctx, \"tx_pipeline_counter\", time.Hour) return nil }) fmt.Println(incr2.Val(), err) ","date":"2023-05-23","objectID":"/golang-redis/:8:0","tags":["golang","redis"],"title":"Golang Redis","uri":"/golang-redis/"},{"categories":["æ–‡æ¡£"],"content":"Watch æ­é… WATCHå‘½ä»¤æ¥æ‰§è¡Œäº‹åŠ¡æ“ä½œã€‚ä»ä½¿ç”¨WATCHå‘½ä»¤ç›‘è§†æŸä¸ª key å¼€å§‹ï¼Œç›´åˆ°æ‰§è¡ŒEXECå‘½ä»¤çš„è¿™æ®µæ—¶é—´é‡Œï¼Œå¦‚æœæœ‰å…¶ä»–ç”¨æˆ·æŠ¢å…ˆå¯¹è¢«ç›‘è§†çš„ key è¿›è¡Œäº†æ›¿æ¢ã€æ›´æ–°ã€åˆ é™¤ç­‰æ“ä½œï¼Œé‚£ä¹ˆå½“ç”¨æˆ·å°è¯•æ‰§è¡ŒEXECçš„æ—¶å€™ï¼Œäº‹åŠ¡å°†å¤±è´¥å¹¶è¿”å›ä¸€ä¸ªé”™è¯¯ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®è¿™ä¸ªé”™è¯¯é€‰æ‹©é‡è¯•äº‹åŠ¡æˆ–è€…æ”¾å¼ƒäº‹åŠ¡ã€‚ Watchæ–¹æ³•æ¥æ”¶ä¸€ä¸ªå‡½æ•°å’Œä¸€ä¸ªæˆ–å¤šä¸ªkeyä½œä¸ºå‚æ•°ã€‚ Watch(fn func(*Tx) error, keys ...string) error Watch æ–¹æ³•æ­é… TxPipelined çš„ä½¿ç”¨ç¤ºä¾‹ // watchDemo åœ¨keyå€¼ä¸å˜çš„æƒ…å†µä¸‹å°†å…¶å€¼+1 func watchDemo(ctx context.Context, key string) error { return rdb.Watch(ctx, func(tx *redis.Tx) error { n, err := tx.Get(ctx, key).Int() if err != nil \u0026\u0026 err != redis.Nil { return err } // å‡è®¾æ“ä½œè€—æ—¶5ç§’ // 5ç§’å†…æˆ‘ä»¬é€šè¿‡å…¶ä»–çš„å®¢æˆ·ç«¯ä¿®æ”¹keyï¼Œå½“å‰äº‹åŠ¡å°±ä¼šå¤±è´¥ time.Sleep(5 * time.Second) _, err = tx.TxPipelined(ctx, func(pipe redis.Pipeliner) error { pipe.Set(ctx, key, n+1, time.Hour) return nil }) return err }, key) } ","date":"2023-05-23","objectID":"/golang-redis/:9:0","tags":["golang","redis"],"title":"Golang Redis","uri":"/golang-redis/"},{"categories":["æ–‡æ¡£"],"content":"ä¸€ä¸ª go-redis å®˜æ–¹æ–‡æ¡£ä¸­ä½¿ç”¨ GET ã€SETå’ŒWATCHå‘½ä»¤å®ç°ä¸€ä¸ª INCR å‘½ä»¤çš„å®Œæ•´ç¤ºä¾‹ã€‚ const routineCount = 100 increment := func(key string) error { txf := func(tx *redis.Tx) error { // è·å¾—å½“å‰å€¼æˆ–é›¶å€¼ n, err := tx.Get(key).Int() if err != nil \u0026\u0026 err != redis.Nil { return err } // å®é™…æ“ä½œï¼ˆä¹è§‚é”å®šä¸­çš„æœ¬åœ°æ“ä½œï¼‰ n++ // ä»…åœ¨ç›‘è§†çš„Keyä¿æŒä¸å˜çš„æƒ…å†µä¸‹è¿è¡Œ _, err = tx.Pipelined(func(pipe redis.Pipeliner) error { // pipe å¤„ç†é”™è¯¯æƒ…å†µ pipe.Set(key, n, 0) return nil }) return err } for retries := routineCount; retries \u003e 0; retries-- { err := rdb.Watch(txf, key) if err != redis.TxFailedErr { return err } // ä¹è§‚é”ä¸¢å¤± } return errors.New(\"increment reached maximum number of retries\") } var wg sync.WaitGroup wg.Add(routineCount) for i := 0; i \u003c routineCount; i++ { go func() { defer wg.Done() if err := increment(\"counter3\"); err != nil { fmt.Println(\"increment error:\", err) } }() } wg.Wait() n, err := rdb.Get(\"counter3\").Int() fmt.Println(\"ended with\", n, err) åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ä½¿ç”¨äº† redis.TxFailedErr æ¥æ£€æŸ¥äº‹åŠ¡æ˜¯å¦å¤±è´¥ã€‚ å‚è€ƒé“¾æ¥ https://pkg.go.dev/github.com/go-redis/redis https://www.liwenzhou.com/posts/Go/redis/#autoid-1-2-0 ","date":"2023-05-23","objectID":"/golang-redis/:10:0","tags":["golang","redis"],"title":"Golang Redis","uri":"/golang-redis/"},{"categories":["æ–‡æ¡£"],"content":"sqlx åº“çš„ä½¿ç”¨ ","date":"2023-05-23","objectID":"/golang-sqlx/:0:0","tags":["golang","mysql"],"title":"Golang Sqlx","uri":"/golang-sqlx/"},{"categories":["æ–‡æ¡£"],"content":"sqlx çš„ä»‹ç» sqlx æ˜¯å†…ç½®database/sql è½¯ä»¶åŒ…çš„åŸºç¡€ä¸Šæä¾›äº†ä¸€ç»„æ‹“å±• å…¼å®¹sqlåŸç”ŸåŒ…ï¼Œæä¾›äº†æ›´åŠ ä¼˜é›…çš„æŸ¥è¯¢ï¼Œæ’å…¥å‡½æ•° ","date":"2023-05-23","objectID":"/golang-sqlx/:1:0","tags":["golang","mysql"],"title":"Golang Sqlx","uri":"/golang-sqlx/"},{"categories":["æ–‡æ¡£"],"content":"sqlx å®‰è£… go get github.com/jmoiron/sqlx ","date":"2023-05-23","objectID":"/golang-sqlx/:2:0","tags":["golang","mysql"],"title":"Golang Sqlx","uri":"/golang-sqlx/"},{"categories":["æ–‡æ¡£"],"content":"è¿æ¥æ•°æ®åº“ var db *sqlx.DB func initDB() (err error) { dsn := \"user:password@tcp(127.0.0.1:3306)/sql_test?charset=utf8mb4\u0026parseTime=True\" // ä¹Ÿå¯ä»¥ä½¿ç”¨MustConnectè¿æ¥ä¸æˆåŠŸå°±panic db, err = sqlx.Connect(\"mysql\", dsn) if err != nil { fmt.Printf(\"connect DB failed, err:%v\\n\", err) return } // è®¾ç½®ä¸æ•°æ®åº“æœ€å¤§çš„æ‰“å¼€è¿æ¥æ•° db.SetMaxOpenConns(20) // è®¾ç½®ç©ºé—²çš„æœ€å¤§è¿æ¥æ•° db.SetMaxIdleConns(10) return } ","date":"2023-05-23","objectID":"/golang-sqlx/:3:0","tags":["golang","mysql"],"title":"Golang Sqlx","uri":"/golang-sqlx/"},{"categories":["æ–‡æ¡£"],"content":"æŸ¥è¯¢ æŸ¥è¯¢å•è¡Œçš„æ•°æ®ç¤ºä¾‹ // æŸ¥è¯¢å•æ¡æ•°æ®ç¤ºä¾‹ func queryRowDemo() { sqlStr := \"select id, name, age from user where id=?\" var u user err := db.Get(\u0026u, sqlStr, 1) if err != nil { fmt.Printf(\"get failed, err:%v\\n\", err) return } fmt.Printf(\"id:%d name:%s age:%d\\n\", u.ID, u.Name, u.Age) } æŸ¥è¯¢å¤šæ¡æ•°æ® // æŸ¥è¯¢å¤šæ¡æ•°æ®ç¤ºä¾‹ func queryMultiRowDemo() { sqlStr := \"select id, name, age from user where id \u003e ?\" var users []user err := db.Select(\u0026users, sqlStr, 0) if err != nil { fmt.Printf(\"query failed, err:%v\\n\", err) return } fmt.Printf(\"users:%#v\\n\", users) } ","date":"2023-05-23","objectID":"/golang-sqlx/:4:0","tags":["golang","mysql"],"title":"Golang Sqlx","uri":"/golang-sqlx/"},{"categories":["æ–‡æ¡£"],"content":"æ’å…¥ã€æ›´æ–°å’Œåˆ é™¤ sqlxçš„execæ–¹æ³•ä¸åŸç”Ÿsqlä¸­çš„execä½¿ç”¨ä¸€è‡´ æ’å…¥æ•°æ® // æ’å…¥æ•°æ® func insertRowDemo() { sqlStr := \"insert into user(name, age) values (?,?)\" ret, err := db.Exec(sqlStr, \" å¼ ä¸‰\", 18) if err != nil { fmt.Printf(\"insert failed, err:%v\\n\", err) return } theID, err := ret.LastInsertId() // æ–°æ’å…¥æ•°æ®çš„id if err != nil { fmt.Printf(\"get lastinsert ID failed, err:%v\\n\", err) return } fmt.Printf(\"insert success, the id is %d.\\n\", theID) } æ›´æ–°æ•°æ® // æ›´æ–°æ•°æ® func updateRowDemo() { sqlStr := \"update user set age=? where id = ?\" ret, err := db.Exec(sqlStr, 18, 1) if err != nil { fmt.Printf(\"update failed, err:%v\\n\", err) return } n, err := ret.RowsAffected() // æ“ä½œå½±å“çš„è¡Œæ•° if err != nil { fmt.Printf(\"get RowsAffected failed, err:%v\\n\", err) return } fmt.Printf(\"update success, affected rows:%d\\n\", n) } åˆ é™¤æ•°æ® // åˆ é™¤æ•°æ® func deleteRowDemo() { sqlStr := \"delete from user where id = ?\" ret, err := db.Exec(sqlStr, 6) if err != nil { fmt.Printf(\"delete failed, err:%v\\n\", err) return } n, err := ret.RowsAffected() // æ“ä½œå½±å“çš„è¡Œæ•° if err != nil { fmt.Printf(\"get RowsAffected failed, err:%v\\n\", err) return } fmt.Printf(\"delete success, affected rows:%d\\n\", n) } ","date":"2023-05-23","objectID":"/golang-sqlx/:5:0","tags":["golang","mysql"],"title":"Golang Sqlx","uri":"/golang-sqlx/"},{"categories":["æ–‡æ¡£"],"content":"NameExec DB.NameExec æ–¹æ³•ç”¨æ¥ç»‘å®šçš„SQLè¯­å¥ä¸ç»“æ„ä½“æˆ–mapä¸­çš„åŒåå­—æ®µ func insertUserDemo()(err error){ sqlStr := \"INSERT INTO user (name,age) VALUES (:name,:age)\" _, err = db.NamedExec(sqlStr, map[string]interface{}{ \"name\": \"å¼ ä¸‰\", \"age\": 18, }) return } ","date":"2023-05-23","objectID":"/golang-sqlx/:6:0","tags":["golang","mysql"],"title":"Golang Sqlx","uri":"/golang-sqlx/"},{"categories":["æ–‡æ¡£"],"content":"NameQuery ä½¿ç”¨æ­¤æ•°æ®åº“è¿›è¡Œå‘½åæŸ¥è¯¢ã€‚ä»»ä½•å‘½åçš„å ä½ç¬¦å‚æ•°éƒ½è¢«argä¸­çš„å­—æ®µæ›¿æ¢ã€‚ func namedQuery() { sqlStr := \"SELECT * FROM user WHERE name=:name\" // ä½¿ç”¨mapåšå‘½åæŸ¥è¯¢ rows, err := db.NamedQuery(sqlStr, map[string]interface{}{\"name\": \"å¼ ä¸‰\"}) if err != nil { fmt.Printf(\"db.NamedQuery failed, err:%v\\n\", err) return } defer rows.Close() for rows.Next() { var u user err := rows.StructScan(\u0026u) if err != nil { fmt.Printf(\"scan failed, err:%v\\n\", err) continue } fmt.Printf(\"user:%#v\\n\", u) } u := user{ Name: \"å¼ ä¸‰\", } // ä½¿ç”¨ç»“æ„ä½“å‘½åæŸ¥è¯¢ï¼Œæ ¹æ®ç»“æ„ä½“å­—æ®µçš„ db tagè¿›è¡Œæ˜ å°„ rows, err = db.NamedQuery(sqlStr, u) if err != nil { fmt.Printf(\"db.NamedQuery failed, err:%v\\n\", err) return } defer rows.Close() for rows.Next() { var u user err := rows.StructScan(\u0026u) if err != nil { fmt.Printf(\"scan failed, err:%v\\n\", err) continue } fmt.Printf(\"user:%#v\\n\", u) } } ","date":"2023-05-23","objectID":"/golang-sqlx/:7:0","tags":["golang","mysql"],"title":"Golang Sqlx","uri":"/golang-sqlx/"},{"categories":["æ–‡æ¡£"],"content":"äº‹åŠ¡æ“ä½œ å¯¹äºäº‹ç‰©æ“ä½œï¼Œ ä½¿ç”¨sqlxä¸­æä¾› db.Begin() å’Œ tx.Exec() æ–¹æ³• func transactionDemo2()(err error) { tx, err := db.Beginx() // å¼€å¯äº‹åŠ¡ if err != nil { fmt.Printf(\"begin trans failed, err:%v\\n\", err) return err } defer func() { if p := recover(); p != nil { tx.Rollback() panic(p) // re-throw panic after Rollback } else if err != nil { fmt.Println(\"rollback\") tx.Rollback() // err is non-nil; don't change it } else { err = tx.Commit() // err is nil; if Commit returns error update err fmt.Println(\"commit\") } }() sqlStr1 := \"Update user set age=20 where id=?\" rs, err := tx.Exec(sqlStr1, 1) if err!= nil{ return err } n, err := rs.RowsAffected() if err != nil { return err } if n != 1 { return errors.New(\"exec sqlStr1 failed\") } sqlStr2 := \"Update user set age=50 where i=?\" rs, err = tx.Exec(sqlStr2, 5) if err!=nil{ return err } n, err = rs.RowsAffected() if err != nil { return err } if n != 1 { return errors.New(\"exec sqlStr1 failed\") } return err } ","date":"2023-05-23","objectID":"/golang-sqlx/:8:0","tags":["golang","mysql"],"title":"Golang Sqlx","uri":"/golang-sqlx/"},{"categories":["æ–‡æ¡£"],"content":"sqlx.In sqlx.Inçš„æ‰¹é‡æ’å…¥ç¤ºä¾‹ åˆ›å»ºä¸€ä¸ªuserè¡¨ CREATE TABLE `user` ( `id` BIGINT(20) NOT NULL AUTO_INCREMENT, `name` VARCHAR(20) DEFAULT '', `age` INT(11) DEFAULT '0', PRIMARY KEY(`id`) )ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb4; ","date":"2023-05-23","objectID":"/golang-sqlx/:9:0","tags":["golang","mysql"],"title":"Golang Sqlx","uri":"/golang-sqlx/"},{"categories":["æ–‡æ¡£"],"content":"ç»“æ„ä½“ å®šä¹‰ä¸€ä¸ªç»“æ„ä½“ type User struct { Name string `db:\"name\"` Age int `db:\"age\"` } ","date":"2023-05-23","objectID":"/golang-sqlx/:9:1","tags":["golang","mysql"],"title":"Golang Sqlx","uri":"/golang-sqlx/"},{"categories":["æ–‡æ¡£"],"content":"bingvars (ç»‘å®šå˜é‡) æŸ¥è¯¢å ä½ç¬¦**ï¼Ÿ**åœ¨å†…éƒ¨æˆä¸º bindvarsï¼ˆæŸ¥è¯¢å ä½ç¬¦ï¼‰ MySQLä¸­ä½¿ç”¨? PostgreSQLä½¿ç”¨æšä¸¾çš„$1ã€$2ç­‰bindvarè¯­æ³• SQLiteä¸­?å’Œ$1çš„è¯­æ³•éƒ½æ”¯æŒ Oracleä¸­ä½¿ç”¨:nameçš„è¯­æ³• ","date":"2023-05-23","objectID":"/golang-sqlx/:9:2","tags":["golang","mysql"],"title":"Golang Sqlx","uri":"/golang-sqlx/"},{"categories":["æ–‡æ¡£"],"content":"è‡ªå·±æ‹¼æ¥è¯­å¥ // BatchInsertUsers è‡ªè¡Œæ„é€ æ‰¹é‡æ’å…¥çš„è¯­å¥ func BatchInsertUsers(users []*User) error { // å­˜æ”¾ (?, ?) çš„slice valueStrings := make([]string, 0, len(users)) // å­˜æ”¾valuesçš„slice valueArgs := make([]interface{}, 0, len(users) * 2) // éå†userså‡†å¤‡ç›¸å…³æ•°æ® for _, u := range users { // æ­¤å¤„å ä½ç¬¦è¦ä¸æ’å…¥å€¼çš„ä¸ªæ•°å¯¹åº” valueStrings = append(valueStrings, \"(?, ?)\") valueArgs = append(valueArgs, u.Name) valueArgs = append(valueArgs, u.Age) } // è‡ªè¡Œæ‹¼æ¥è¦æ‰§è¡Œçš„å…·ä½“è¯­å¥ stmt := fmt.Sprintf(\"INSERT INTO user (name, age) VALUES %s\", strings.Join(valueStrings, \",\")) _, err := DB.Exec(stmt, valueArgs...) return err } ","date":"2023-05-23","objectID":"/golang-sqlx/:9:3","tags":["golang","mysql"],"title":"Golang Sqlx","uri":"/golang-sqlx/"},{"categories":["æ–‡æ¡£"],"content":"ä½¿ç”¨sqlx.In å®ç°æ‰¹é‡æ’å…¥ å®ç°ç»“æ„ä½“ driver.Valuer æ¥å£ func (u User) Value() (driver.Value, error) { return []interface{}{u.Name, u.Age}, nil } // BatchInsertUsers2 ä½¿ç”¨sqlx.Inå¸®æˆ‘ä»¬æ‹¼æ¥è¯­å¥å’Œå‚æ•°, æ³¨æ„ä¼ å…¥çš„å‚æ•°æ˜¯[]interface{} func BatchInsertUsers2(users []interface{}) error { query, args, _ := sqlx.In( \"INSERT INTO user (name, age) VALUES (?), (?), (?)\", users..., // å¦‚æœargå®ç°äº† driver.Valuer, sqlx.In ä¼šé€šè¿‡è°ƒç”¨ Value()æ¥å±•å¼€å®ƒ ) fmt.Println(query) // æŸ¥çœ‹ç”Ÿæˆçš„querystring fmt.Println(args) // æŸ¥çœ‹ç”Ÿæˆçš„args _, err := DB.Exec(query, args...) return err } ","date":"2023-05-23","objectID":"/golang-sqlx/:9:4","tags":["golang","mysql"],"title":"Golang Sqlx","uri":"/golang-sqlx/"},{"categories":["æ–‡æ¡£"],"content":"ä½¿ç”¨NamedExecå®ç°æ‰¹é‡æ’å…¥ // BatchInsertUsers3 ä½¿ç”¨NamedExecå®ç°æ‰¹é‡æ’å…¥ func BatchInsertUsers3(users []*User) error { _, err := DB.NamedExec(\"INSERT INTO user (name, age) VALUES (:name, :age)\", users) return err } ","date":"2023-05-23","objectID":"/golang-sqlx/:9:5","tags":["golang","mysql"],"title":"Golang Sqlx","uri":"/golang-sqlx/"},{"categories":["æ–‡æ¡£"],"content":"ä¸‰ç§æ–¹æ³•çš„ç¤ºä¾‹ func main() { err := initDB() if err != nil { panic(err) } defer DB.Close() u1 := User{Name: \"å¼ ä¸‰\", Age: 18} u2 := User{Name: \"æå››\", Age: 19} u3 := User{Name: \"ç‹äº”\", Age: 20} // æ–¹æ³•1 users := []*User{\u0026u1, \u0026u2, \u0026u3} err = BatchInsertUsers(users) if err != nil { fmt.Printf(\"BatchInsertUsers failed, err:%v\\n\", err) } // æ–¹æ³•2 users2 := []interface{}{u1, u2, u3} err = BatchInsertUsers2(users2) if err != nil { fmt.Printf(\"BatchInsertUsers2 failed, err:%v\\n\", err) } // æ–¹æ³•3 users3 := []*User{\u0026u1, \u0026u2, \u0026u3} err = BatchInsertUsers3(users3) if err != nil { fmt.Printf(\"BatchInsertUsers3 failed, err:%v\\n\", err) } } ","date":"2023-05-23","objectID":"/golang-sqlx/:10:0","tags":["golang","mysql"],"title":"Golang Sqlx","uri":"/golang-sqlx/"},{"categories":["æ–‡æ¡£"],"content":"sqlx.in çš„æŸ¥è¯¢ç¤ºä¾‹ ","date":"2023-05-23","objectID":"/golang-sqlx/:11:0","tags":["golang","mysql"],"title":"Golang Sqlx","uri":"/golang-sqlx/"},{"categories":["æ–‡æ¡£"],"content":"inæŸ¥è¯¢ æŸ¥è¯¢idåœ¨ç»™å®šidé›†åˆçš„æ•°æ® // QueryByIDs æ ¹æ®ç»™å®šIDæŸ¥è¯¢ func QueryByIDs(ids []int)(users []User, err error){ // åŠ¨æ€å¡«å……id query, args, err := sqlx.In(\"SELECT name, age FROM user WHERE id IN (?)\", ids) if err != nil { return } // sqlx.In è¿”å›å¸¦ `?` bindvarçš„æŸ¥è¯¢è¯­å¥, æˆ‘ä»¬ä½¿ç”¨Rebind()é‡æ–°ç»‘å®šå®ƒ query = DB.Rebind(query) err = DB.Select(\u0026users, query, args...) return } ","date":"2023-05-23","objectID":"/golang-sqlx/:11:1","tags":["golang","mysql"],"title":"Golang Sqlx","uri":"/golang-sqlx/"},{"categories":["æ–‡æ¡£"],"content":"inæŸ¥è¯¢å’ŒFIND_IN_SET å‡½æ•° æŸ¥è¯¢IDåœ¨ç»™å®šIDé›†åˆçš„æ•°æ®å¹¶ç»´æŒç»™å®šidé›†åˆçš„é¡ºåº // QueryAndOrderByIDs æŒ‰ç…§æŒ‡å®šidæŸ¥è¯¢å¹¶ç»´æŠ¤é¡ºåº func QueryAndOrderByIDs(ids []int)(users []User, err error){ // åŠ¨æ€å¡«å……id strIDs := make([]string, 0, len(ids)) for _, id := range ids { strIDs = append(strIDs, fmt.Sprintf(\"%d\", id)) } query, args, err := sqlx.In(\"SELECT name, age FROM user WHERE id IN (?) ORDER BY FIND_IN_SET(id, ?)\", ids, strings.Join(strIDs, \",\")) if err != nil { return } // sqlx.In è¿”å›å¸¦ `?` bindvarçš„æŸ¥è¯¢è¯­å¥, æˆ‘ä»¬ä½¿ç”¨Rebind()é‡æ–°ç»‘å®šå®ƒ query = DB.Rebind(query) err = DB.Select(\u0026users, query, args...) return } å‚è€ƒé“¾æ¥ https://www.liwenzhou.com/posts/Go/sqlx/ https://pkg.go.dev/github.com/jmoiron/sqlx ","date":"2023-05-23","objectID":"/golang-sqlx/:12:0","tags":["golang","mysql"],"title":"Golang Sqlx","uri":"/golang-sqlx/"},{"categories":["æ–‡æ¡£"],"content":"Go æ“ä½œ sql server docker å®‰è£… sqlserver #æ‹‰å–é•œåƒ docker pull mcr.microsoft.com/azure-sql-edge #å¯åŠ¨å®¹å™¨ docker run --name azuresqledge -e 'ACCEPT_EULA=Y' -e 'SA_PASSWORD=yourStrong(!)Password' -d -p 1433:1433 mcr.microsoft.com/azure-sql-edge è¿æ¥SQLæ•°æ®åº“ï¼Œè¦åŠ è½½ç›®æ ‡æ•°æ®åº“çš„é©±åŠ¨ï¼Œé©±åŠ¨é‡Œé¢åŒ…å«äº†ä¸æ•°æ®åº“äº¤äº’çš„é€»è¾‘ sql.Open() æ•°æ®åº“é©±åŠ¨çš„åç§° æ•°æ®æºåç§° å¾—åˆ°ä¸€ä¸ªæŒ‡å‘sql.DBè¿™ä¸ªstructçš„æŒ‡é’ˆ sql.DB æ—¶ç”¨æ¥æ“ä½œæ•°æ®åº“çš„ï¼Œå®ƒä»£ç 0ä¸ªæˆ–å¤šä¸ªåº•å±‚è¿æ¥çš„æ± ï¼Œè¿™äº›è¿æ¥ç”±sqlåŒ…æ¥ç»´æŠ¤ï¼ŒsqlåŒ…è‡ªåŠ¨çš„åˆ›å»ºå’Œé‡Šæ”¾è¿™äº›è¿æ¥ å®ƒå¯¹äºå¤šä¸ªgoroutineå¹¶å‘çš„ä½¿ç”¨æ—¶å®‰å…¨çš„ package main import ( \"context\" \"database/sql\" \"fmt\" \"log\" _ \"github.com/denisenkom/go-mssqldb\" ) var db *sql.DB const ( server = \"localhost\" port = \"1433\" user = \"sa\" password = \"Password\" database = \"go-db\" ) func main() { connStr := fmt.Sprintf(\"server=%s;user id=%s;password=%s;port=%s;database=%s;\", server, user, password, port, database) db, err := sql.Open(\"sqlserver\", connStr) if err != nil { log.Fatalln(err.Error()) } ctx := context.Background() err = db.PingContext(ctx) if err != nil { log.Fatalln(err.Error()) } fmt.Println(\"Connected!\") } note Open() å‡½æ•°å¹¶ä¸ä¼šè¿æ¥åˆ°æ•°æ®åº“ï¼Œç”šè‡³ä¸ä¼šéªŒè¯å‚æ•°ï¼Œå®ƒåªæ˜¯æŠŠåç»­è¿æ¥åˆ°æ•°æ®åº“é”å¿…é¡»çš„structç»™è®¾ç½®å¥½ è€ŒçœŸæ­£çš„è¿æ¥æ—¶åœ¨è¢«éœ€è¦çš„æ—¶å€™æ‰è¿›è¡Œæ‡’è®¾ç½®çš„ sql.DB ä¸éœ€è¦è¿›è¡Œå…³é—­ å®ƒå°±æ˜¯ç”¨æ¥è¿æ¥æ•°æ®åº“çš„ï¼Œ è€Œä¸æ˜¯å®é™…çš„è¿æ¥ è¿™ä¸ªæŠ½è±¡ä¿æŠ¤äº†æ•°æ®åº“è¿çš„æ± ï¼Œ å¯¹æ­¤è¿›è¡Œç»´æŠ¤ ä½¿ç”¨sql.DB çš„æ—¶å€™ï¼Œå¯ä»¥å®šä¹‰å®ƒçš„å…¨å±€å˜é‡è¿›è¡Œä½¿ç”¨ï¼Œ ä¹Ÿå¯ä»¥å°†å®ƒä¼ é€’ç»™å‡½æ•°/æ–¹æ³•é‡Œ ","date":"2023-05-21","objectID":"/golang-mysql-crud/:0:0","tags":["golang","mysql"],"title":"Golang Mysql CRUD","uri":"/golang-mysql-crud/"},{"categories":["æ–‡æ¡£"],"content":"å¦‚ä½•è·å–é©±åŠ¨ æ­£å¸¸çš„åšæ³•æ˜¯ä½¿ç”¨sql.Register() å‡½æ•°ï¼Œ æ•°æ®åº“é©±åŠ¨çš„åç§°å’Œä¸€ä¸ªå®ç°äº†driver.Driver æ¥å£çš„structï¼Œ æ¥æ³¨å†Œæ•°æ®çš„é©±åŠ¨ sql.Register(â€œsqlserverâ€, \u0026drv{}) ä¸ºä»€ä¹ˆä¾‹å­ä¸­æ²¡æœ‰è¿™å¥è¯ å› ä¸º sql é©±åŠ¨ï¼Œ åœ¨è¿™ä¸ªåŒ…åˆ«å¼•å…¥çš„æ—¶å€™è¿›è¡Œè‡ªæˆ‘æ³¨å†Œ _ \"github.com/denisenkom/go-mssqldb\" ","date":"2023-05-21","objectID":"/golang-mysql-crud/:1:0","tags":["golang","mysql"],"title":"Golang Mysql CRUD","uri":"/golang-mysql-crud/"},{"categories":["æ–‡æ¡£"],"content":"é©±åŠ¨è‡ªæˆ‘æ³¨å†Œ åœ¨go-mssqldbåŒ…è¢«å¼•å…¥çš„æ—¶å€™ï¼Œ å®ƒçš„initå‡½æ•°å°†ä¼šè¿è¡Œå¹¶è¿›è¡Œè‡ªæˆ‘æ³¨å†Œ åœ¨å¼•å…¥go-mssqldb åŒ…çš„æ—¶å€™ï¼Œ æŠŠè¯¥åŒ…çš„åç§°è®¾ç½®ä¸ºä¸‹åˆ’çº¿_ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬ä¸èƒ½ç›´æ¥ä½¿ç”¨æ•°æ®åº“é©±åŠ¨ æœªæ¥å‡çº§é©±åŠ¨ï¼Œ æ— éœ€æ”¹å˜ä»£ç  Goè¯­è¨€æ²¡æœ‰æä¾›å®˜æ–¹çš„æ•°æ®åº“é©±åŠ¨ï¼Œ æ‰€æœ‰çš„æ•°æ®åº“é©±åŠ¨éƒ½æ˜¯ç¬¬ä¸‰æ–¹é©±åŠ¨ï¼Œéƒ½éµå¾ªsql.driveråŒ…é‡Œé¢å®šä¹‰çš„æ¥å£ ","date":"2023-05-21","objectID":"/golang-mysql-crud/:2:0","tags":["golang","mysql"],"title":"Golang Mysql CRUD","uri":"/golang-mysql-crud/"},{"categories":["æ–‡æ¡£"],"content":"func (db *DB) PingContext(ctx context.Context) PingContextå‡½æ•°ç”¨æ¥éªŒè¯ä¸æ•°æ®åº“çš„è¿æ¥æ˜¯å¦ä»ç„¶ç”Ÿæ•ˆï¼Œ ï¼Œå¦‚æœ‰å¿…è¦åˆ™å»ºç«‹ä¸€ä¸ªè¿æ¥ è¿™ä¸ªéŸ©å¼éœ€è¦ä¸€ä¸ªContextï¼ˆä¸Šä¸‹æ–‡ï¼‰ç±»å‹çš„å‚æ•°ï¼Œ è¿™ç§ç±»å‹å¯ä»¥æºå¸¦ æˆªæ­¢æ—¶é—´ã€‚å–æ¶ˆä¿¡å·å’Œå…¶ä»–è¯·æ±‚èŒƒå›´çš„å€¼ï¼Œå¹¶ä¸”å¯ä»¥æ¨ªè·¨APIè¾¹ç•Œå’Œè¿›ç¨‹ ä¸Šä¾‹ä¸­ï¼Œ åˆ›å»ºcontextä½¿ç”¨çš„context.Background()å‡½æ•°ï¼Œ è¯¥å‡½æ•°è¿”å›ä¸€ä¸ªénilçš„ç©ºcontextï¼Œå®ƒä¸ä¼šè¢«å–æ¶ˆï¼Œå®ƒæ²¡æœ‰å€¼ï¼Œæ²¡æœ‰æˆªæ­¢æ—¶é—´ é€šå¸¸åœ¨mainå‡½æ•°ï¼Œ åˆå§‹åŒ–æˆ–æµ‹è¯•ä¸­ ä½œä¸ºä¼ å…¥è¯·æ±‚çš„context ","date":"2023-05-21","objectID":"/golang-mysql-crud/:3:0","tags":["golang","mysql"],"title":"Golang Mysql CRUD","uri":"/golang-mysql-crud/"},{"categories":["æ–‡æ¡£"],"content":"æŸ¥è¯¢ sql.Db ç±»å‹ç”¨äºæŸ¥è¯¢çš„æ–¹æ³•æœ‰ Query QueryRow QueryContext QueryRowContext ","date":"2023-05-21","objectID":"/golang-mysql-crud/:4:0","tags":["golang","mysql"],"title":"Golang Mysql CRUD","uri":"/golang-mysql-crud/"},{"categories":["æ–‡æ¡£"],"content":"Rows è¿”å›ç±»å‹ type Rows struct { // contains filtered or unexported fields } Rowsçš„æ–¹æ³• func (*Rows) Close error func (rs *Rows) ColumnTypes() ([]*ColumnType, error) func (rs *Rows) Columns() ([]string, error) func (rs *Rows) Err() error func (rs *Rows) Next() bool func (rs *Rows) NextResultSet() bool func (rs *Rows) Scan(dest â€¦any) error ","date":"2023-05-21","objectID":"/golang-mysql-crud/:4:1","tags":["golang","mysql"],"title":"Golang Mysql CRUD","uri":"/golang-mysql-crud/"},{"categories":["æ–‡æ¡£"],"content":"QueryRow è¿”å›ç±»å‹æ˜¯ type Row struct { // contains filtered or unexported fields } Rowçš„æ–¹æ³• func (r *Row) Err() error func (r *Row) Scan(dest â€¦any) error ","date":"2023-05-21","objectID":"/golang-mysql-crud/:4:2","tags":["golang","mysql"],"title":"Golang Mysql CRUD","uri":"/golang-mysql-crud/"},{"categories":["æ–‡æ¡£"],"content":"å•æ¡æŸ¥è¯¢ func getone(id int)(a app,err error) { a = app{} err = db.QueryRow(\"SELECT Id, Name, Status, Level, Order From dbo.App WHERE Id=@Id\", sql.Named(\"Id\", id)). Scan(\u0026a.ID, \u0026a.name, \u0026a.status, \u0026a.level, \u0026a.order) return } ","date":"2023-05-21","objectID":"/golang-mysql-crud/:4:3","tags":["golang","mysql"],"title":"Golang Mysql CRUD","uri":"/golang-mysql-crud/"},{"categories":["æ–‡æ¡£"],"content":"å¤šæ¡æŸ¥è¯¢ func getMany(id int) (apps []app, err error) { rows, err := db.Query(\"SELECT Id, Name, Status, Level, Order From dbo.App WHERE Id\u003e@Id\", sql.Named(\"Id\", id)) for rows.Next() { a := app{} err = rows.Scan(\u0026a.ID, \u0026a.name, \u0026a.status, \u0026a.level, \u0026a.order) if err != nil { log.Fatalln(err.Error()) } apps = append(apps, a) } return } ","date":"2023-05-21","objectID":"/golang-mysql-crud/:4:4","tags":["golang","mysql"],"title":"Golang Mysql CRUD","uri":"/golang-mysql-crud/"},{"categories":["æ–‡æ¡£"],"content":"æ›´æ–° sql.DB ç±»å‹ä¸Šç”¨äºæ›´æ–°çš„æ–¹æ³• Exec ExecContext func (a *app) update() (err error) { _, err = db.Exec(\"UPDATE dbo.App SET Name=@Name, Order=@Order WHERE Id=@Id\", sql.Named(\"Name\", a.name), sql.Named(\"Order\", a.order), sql.Named(\"Id\", a.ID)) if err != nil { log.Fatalln(err.Error()) } return } ","date":"2023-05-21","objectID":"/golang-mysql-crud/:5:0","tags":["golang","mysql"],"title":"Golang Mysql CRUD","uri":"/golang-mysql-crud/"},{"categories":["æ–‡æ¡£"],"content":"åˆ é™¤ func (a *app) delete() (err error) { _, err = db.Exec(\"DELETE FROM dbo.App WHERE Id=@Id\", sql.Named(\"Id\", a.ID)) if err != nil { log.Fatalln(err.Error()) } return } ","date":"2023-05-21","objectID":"/golang-mysql-crud/:6:0","tags":["golang","mysql"],"title":"Golang Mysql CRUD","uri":"/golang-mysql-crud/"},{"categories":["æ–‡æ¡£"],"content":"å…¶ä»– Prepare prepareContext Transactions Begin BeginTx ","date":"2023-05-21","objectID":"/golang-mysql-crud/:7:0","tags":["golang","mysql"],"title":"Golang Mysql CRUD","uri":"/golang-mysql-crud/"},{"categories":["æ–‡æ¡£"],"content":"Prepare // é¢„å¤„ç†æŸ¥è¯¢ç¤ºä¾‹ func prepareQueryDemo() { sqlStr := \"select id, name, age from user where id \u003e ?\" stmt, err := db.Prepare(sqlStr) if err != nil { fmt.Printf(\"prepare failed, err:%v\\n\", err) return } defer stmt.Close() rows, err := stmt.Query(0) if err != nil { fmt.Printf(\"query failed, err:%v\\n\", err) return } defer rows.Close() // å¾ªç¯è¯»å–ç»“æœé›†ä¸­çš„æ•°æ® for rows.Next() { var u user err := rows.Scan(\u0026u.id, \u0026u.name, \u0026u.age) if err != nil { fmt.Printf(\"scan failed, err:%v\\n\", err) return } fmt.Printf(\"id:%d name:%s age:%d\\n\", u.id, u.name, u.age) } } ","date":"2023-05-21","objectID":"/golang-mysql-crud/:7:1","tags":["golang","mysql"],"title":"Golang Mysql CRUD","uri":"/golang-mysql-crud/"},{"categories":["æ–‡æ¡£"],"content":"Transactions // äº‹åŠ¡æ“ä½œç¤ºä¾‹ func transactionDemo() { tx, err := db.Begin() // å¼€å¯äº‹åŠ¡ if err != nil { if tx != nil { tx.Rollback() // å›æ»š } fmt.Printf(\"begin trans failed, err:%v\\n\", err) return } sqlStr1 := \"Update user set age=30 where id=?\" ret1, err := tx.Exec(sqlStr1, 2) if err != nil { tx.Rollback() // å›æ»š fmt.Printf(\"exec sql1 failed, err:%v\\n\", err) return } affRow1, err := ret1.RowsAffected() if err != nil { tx.Rollback() // å›æ»š fmt.Printf(\"exec ret1.RowsAffected() failed, err:%v\\n\", err) return } sqlStr2 := \"Update user set age=40 where id=?\" ret2, err := tx.Exec(sqlStr2, 3) if err != nil { tx.Rollback() // å›æ»š fmt.Printf(\"exec sql2 failed, err:%v\\n\", err) return } affRow2, err := ret2.RowsAffected() if err != nil { tx.Rollback() // å›æ»š fmt.Printf(\"exec ret1.RowsAffected() failed, err:%v\\n\", err) return } fmt.Println(affRow1, affRow2) if affRow1 == 1 \u0026\u0026 affRow2 == 1 { fmt.Println(\"äº‹åŠ¡æäº¤å•¦...\") tx.Commit() // æäº¤äº‹åŠ¡ } else { tx.Rollback() fmt.Println(\"äº‹åŠ¡å›æ»šå•¦...\") } fmt.Println(\"exec trans success!\") } ","date":"2023-05-21","objectID":"/golang-mysql-crud/:7:2","tags":["golang","mysql"],"title":"Golang Mysql CRUD","uri":"/golang-mysql-crud/"},{"categories":["æ–‡æ¡£"],"content":"dockerå¸¸ç”¨å‘½ä»¤æ•´ç† ","date":"2023-05-21","objectID":"/docker-command/:0:0","tags":["docker"],"title":"Docker Command","uri":"/docker-command/"},{"categories":["æ–‡æ¡£"],"content":"docker images docker image pull ï¼šä¸‹è½½é•œåƒ docker image lsï¼šåˆ—å‡ºæœ¬åœ°å­˜å‚¨çš„é•œåƒ,å‚æ•° â€“digestsæŸ¥çœ‹é•œåƒçš„SHA26ç­¾å docker image inspect:å±•ç¤ºé•œåƒç»†èŠ‚ã€‚åŒ…æ‹¬é•œåƒå±‚æ•°æ®å’Œå…ƒæ•°æ®ã€‚ docker image rmï¼šåˆ é™¤é•œåƒã€‚ dockeræä¾›å‚æ•° â€“filter æ¥è¿‡æ»¤docker image ls å‘½ä»¤è¿”å›é•œåƒåˆ—è¡¨çš„å†…å®¹ è¿”å›æ‚¬è™š(dangling)é•œåƒ lhf@lhf-virtual-machine:~$ docker image ls --filter dangling=true REPOSITORY TAG IMAGE ID CREATED SIZE \u003cnone\u003e \u003cnone\u003e æ²¡æœ‰æ ‡ç­¾çš„é•œåƒç§°ä¸ºæ‚¬è™šé•œåƒï¼Œåˆ—è¡¨æ˜¾ç¤º: ä½¿ç”¨docker image prune ç§»é™¤å…¨éƒ¨æ‚¬è™šé•œåƒã€‚åŠ -aå‚æ•°ï¼ŒDockerä¼šé¢å¤–ç§»é™¤æ²¡æœ‰è¢«ä½¿ç”¨çš„é•œåƒã€‚ ","date":"2023-05-21","objectID":"/docker-command/:1:0","tags":["docker"],"title":"Docker Command","uri":"/docker-command/"},{"categories":["æ–‡æ¡£"],"content":"dockeræ”¯æŒçš„è¿‡æ»¤æ–¹å¼ danglingï¼š å¯ä»¥æŒ‡å®štrueæˆ–falseï¼Œè¿”å›æ‚¬è™šé•œåƒ(true)å’Œéæ‚¬è™šé•œåƒ(false). before: éœ€è¦é•œåƒåç§°å’ŒIDä½œä¸ºå‚æ•°ï¼Œè¿”å›åœ¨ä¹‹å‰è¢«åˆ›å»ºçš„é•œåƒ since: beforeç±»ä¼¼ï¼Œè¿”å›éœ€è¦æŒ‡å®šé•œåƒä¹‹ååˆ›å»ºçš„å…¨éƒ¨é•œåƒ label: æ ¹æ®å¤‡æ³¨ï¼ˆlabelï¼‰çš„åç§°æˆ–è€…å€¼ reference: è¿‡æ»¤æ ‡ç­¾lastesté•œåƒ lhf@lhf-virtual-machine:~$ docker image ls --filter=reference=\"*:latest\" REPOSITORY TAG IMAGE ID CREATED SIZE test latest e63fd667d16a 2 days ago 71.4MB alpine latest 965ea09ff2eb 4 days ago 5.55MB ubuntu latest cf0f3ca922e0 7 days ago 64.2MB centos latest 0f3e07c0138f 3 weeks ago 220MB é€šè¿‡â€“format å‚æ•°æ¥é€šè¿‡goæ¨¡æ¿å¯¹è¾“å‡ºå†…å®¹æ ¼å¼åŒ– åªè¿”å›dockerä¸»æœºä¸Šé•œåƒçš„å¤§å°å±æ€§ lhf@lhf-virtual-machine:~$ docker image ls --format \"{{.Size}}\" 71.4MB 5.55MB 64.2MB 220MB åªè¿”å›æ˜¾ç¤ºä»“åº“ã€æ ‡ç­¾å’Œå¤§å°çš„ä¿¡æ¯ lhf@lhf-virtual-machine:~$ docker image ls --format \"{{.Repository}}:{{.Tag}}:{{.Size}}\" test:latest:71.4MB alpine:latest:5.55MB ubuntu:latest:64.2MB centos:latest:220MB ","date":"2023-05-21","objectID":"/docker-command/:1:1","tags":["docker"],"title":"Docker Command","uri":"/docker-command/"},{"categories":["æ–‡æ¡£"],"content":"é€šè¿‡CLIæ–¹å¼æœç´¢Docker Hub lhf@lhf-virtual-machine:~$ docker search alpine NAME DESCRIPTION STARS OFFICIAL AUTOMATED alpine A minimal Docker image based on Alpine Linuxâ€¦ 5757 [OK] mhart/alpine-node Minimal Node.js built on Alpine Linux 444 anapsix/alpine-java Oracle Java 8 (and 7) with GLIBC 2.28 over Aâ€¦ 427 \u003csnip\u003e lhf@lhf-virtual-machine:~$ docker search alpine --filter \"is-official=true\" NAME DESCRIPTION STARS OFFICIAL AUTOMATED alpine A minimal Docker image based on Alpine Linuxâ€¦ 5757 [OK] ä½¿ç”¨å‚æ•° â€“digests åœ¨æœ¬åœ°æŸ¥çœ‹é•œåƒæ‘˜è¦ lhf@lhf-virtual-machine:~$ docker image ls --digests alpine REPOSITORY TAG DIGEST IMAGE ID CREATED SIZE alpine latest sha256:c19173c5ada610a5989151111163d28a67368362762534d8a8121ce95cf2bd5a 965ea09ff2eb 4 days ago 5.55MB åˆ é™¤dockerä¸»æœºçš„å…¨éƒ¨é•œåƒ lhf@lhf-virtual-machine:~$ docker image rm $(docker image ls -q) -f ","date":"2023-05-21","objectID":"/docker-command/:1:2","tags":["docker"],"title":"Docker Command","uri":"/docker-command/"},{"categories":["æ–‡æ¡£"],"content":"docker container docker container run:å¯åŠ¨rongq Ctrl-PQ:æ–­å¼€Shellä¸å®¹å™¨çš„è¿æ¥ docker container ls:åˆ—å‡ºè¿è¡ŒçŠ¶æ€çš„å®¹å™¨ docker container exec:å…è®¸ç”¨æˆ·åœ¨è¿è¡ŒçŠ¶æ€çš„å®¹å™¨ï¼Œå¯åŠ¨ä¸€ä¸ªæ–°çš„è¿›ç¨‹ã€‚ docker container stopï¼šåœæ­¢è¿è¡Œä¸­çš„å®¹å™¨ã€‚ docker container start:é‡å¯å¤„äºåœæ­¢çŠ¶æ€çš„å®¹å™¨ã€‚ docker container rmï¼šåˆ é™¤åœæ­¢çŠ¶æ€çš„å®¹å™¨ã€‚ docker container inspect:æ˜¾ç¤ºå®¹å™¨çš„é…ç½®ç»†èŠ‚å’Œè¿è¡Œæ—¶ä¿¡æ¯ã€‚ -itå‚æ•°ï¼š ä½¿å½“å‰é‡ç‚¹è¿æ¥åˆ°å®¹å™¨çš„shellç»ˆç«¯ä¸Š $ docker container run -it ubuntu /bin/bash å¿«é€Ÿæ¸…ç†å®¹å™¨ $ docker container rm $(docker container ls -aq) -f ","date":"2023-05-21","objectID":"/docker-command/:2:0","tags":["docker"],"title":"Docker Command","uri":"/docker-command/"},{"categories":["æ–‡æ¡£"],"content":"dockeråº”ç”¨å®¹å™¨åŒ– docker image build ï¼šè¯»å–Dockerfileæ–‡ä»¶,å°†åº”ç”¨ç¨‹åºå®¹å™¨åŒ– ä½¿ç”¨-tå‚æ•°æ–‡ä»¶é•œåƒæ‰“æ ‡ç­¾ ä½¿ç”¨-få‚æ•°æŒ‡å®šä»»æ„è·¯å¾„ä¸‹çš„Dockerfile Dockerfileä¸­FROMæŒ‡ä»¤ï¼ŒæŒ‡å®šæ„å»ºé•œåƒçš„ä¸€ä¸ªåŸºç¡€å±‚ Dockerfileä¸­RUNæŒ‡ä»¤ï¼Œåœ¨é•œåƒä¸­æ‰§è¡Œå‘½ä»¤ï¼Œåˆ›å»ºæ–°çš„é•œåƒå±‚ Dockerfileä¸­COPYæŒ‡ä»¤ï¼Œå°†æ–‡ä»¶ä½œä¸ºæ–°çš„å±‚æ·»åŠ åˆ°é•œåƒä¸­ Dockerfileä¸­EXPOSRæŒ‡ä»¤ï¼Œè®°å½•åº”ç”¨æ‰€ä½¿ç”¨çš„çš„ç½‘ç»œç«¯å£ Dockerfileä¸­ENTRYPOINTæŒ‡ä»¤ï¼ŒæŒ‡å®šé•œåƒå·²å®¹å™¨çš„æ–¹å¼å¯åŠ¨åé»˜è®¤è¿è¡Œç¨‹åº æŸ¥çœ‹é•œåƒæ„å»ºæ‰§è¡Œäº†é‚£äº›æŒ‡ä»¤ $ docker image history lhfdocker/web:latest æŸ¥çœ‹é•œåƒçš„æ„å»ºè¯¦æƒ… $ docker image inspect lhfdocker/web:latest ","date":"2023-05-21","objectID":"/docker-command/:3:0","tags":["docker"],"title":"Docker Command","uri":"/docker-command/"},{"categories":["æ–‡æ¡£"],"content":"Docker Compose docker-compose up ï¼šéƒ¨ç½²ä¸€ä¸ªcomposeåº”ç”¨ã€‚é»˜è®¤è¯»å–docker-compose.ymlæ–‡ä»¶ï¼Œå¯ä»¥ä½¿æœ‰-få‚æ•°æŒ‡å®šæ–‡ä»¶,-d å‚æ•°åœ¨åå°å¯åŠ¨ docker-compose stopï¼šåœæ­¢composeåº”ç”¨çš„ç›¸å…³å®¹å™¨ã€‚å¯ä»¥é€šè¿‡docker-compose restarté‡æ–°å¯åŠ¨ docker-compose rmï¼šåˆ é™¤å·²åœæ­¢çš„composeåº”ç”¨çš„å®¹å™¨ï¼Œä¼šåˆ é™¤å®¹å™¨å’Œç½‘ç»œï¼Œä¸ä¼šåˆ é™¤å·å’Œé•œåƒã€‚ docker-compose restart é‡å¯composeåº”ç”¨ å¦‚æœcomposeåº”ç”¨è¿›è¡Œäº†å˜æ›´,éœ€è¦é‡å¯æ‰èƒ½ç”Ÿæ•ˆ docker-compose ps:åˆ—å‡ºcomposeåº”ç”¨çš„å®¹å™¨ è¾“å‡ºå†…å®¹åŒ…æ‹¬ï¼šçŠ¶æ€ã€å®¹å™¨çš„è¿è¡Œå‘½ä»¤ï¼Œå·²ç»ç½‘ç»œç«¯å£ docker-compose down:åœæ­¢å¹¶åˆ é™¤è¿è¡Œä¸­compose çš„åº”ç”¨ã€‚ä¼šåˆ é™¤å®¹å™¨å’Œç½‘ç»œï¼Œä¸ä¼šåˆ é™¤å·å’Œé•œåƒ ","date":"2023-05-21","objectID":"/docker-command/:4:0","tags":["docker"],"title":"Docker Command","uri":"/docker-command/"},{"categories":["æ–‡æ¡£"],"content":"docker Swarm docker swarm init åˆ›å»ºä¸€ä¸ªæ–°çš„swarm,æ‰§è¡Œè¿™ä¸ªå‘½ä»¤çš„èŠ‚ç‚¹ç§°ä¸ºç®¡ç†èŠ‚ç‚¹ docker swarm join-token æŸ¥è¯¢æ¥å…¥ç®¡ç†èŠ‚ç‚¹å’Œå·¥ä½œèŠ‚ç‚¹åˆ°ç°æœ‰swarmæ—¶æ‰€ä½¿ç”¨çš„å‘½ä»¤å’ŒToken å¢åŠ ç®¡ç†èŠ‚ç‚¹â€”â€”docker swarm join-token manager å¢åŠ å·¥ä½œèŠ‚ç‚¹â€”â€”docker swarm join-token work docker node ls åˆ—å‡ºswarmæ‰€æœ‰èŠ‚ç‚¹åŠç›¸å…³ä¿¡æ¯ docker service create åˆ›å»ºæ–°æœåŠ¡ docker service ls åˆ—å‡ºswarmä¸­è¿è¡Œçš„æœåŠ¡ docker service ps è·å–æ›´å¤šå…³äºæœåŠ¡æœåŠ¡çš„ä¿¡æ¯ docker service inspect è·å–æœåŠ¡çš„è¯¦ç»†ä¿¡æ¯ docker service scale ç”¨äºå¯¹æœåŠ¡å‰¯æœ¬æ•°é‡è¿›è¡Œå¢å‡ docker service update å¯¹è¿è¡Œä¸­çš„æœåŠ¡è¿›è¡Œå±æ€§å˜æ›´ docker service logs æŸ¥çœ‹æœåŠ¡çš„æ—¥å¿— docker service rm ä»swarmåˆ é™¤æœåŠ¡ ","date":"2023-05-21","objectID":"/docker-command/:5:0","tags":["docker"],"title":"Docker Command","uri":"/docker-command/"},{"categories":["æ–‡æ¡£"],"content":"docker network docker network ls ï¼šåˆ—å‡ºè¿è¡Œåœ¨æœ¬åœ°çš„dockerä¸»æœºçš„å…¨éƒ¨ç½‘ç»œ docker network create :åˆ›å»ºæ–°çš„dockerç½‘ç»œã€‚é»˜è®¤é‡‡ç”¨çš„æ˜¯bridge åŠ -då‚æ•°æŒ‡å®š(ç½‘ç»œç±»å‹) docker network inspect:æä¾›dockerç½‘ç»œçš„è¯¦ç»†é…ç½®ä¿¡æ¯ã€‚ docker network prune:åˆ é™¤dockerä¸»æœºä¸Šå…¨éƒ¨æœªä½¿ç”¨çš„ç½‘ç»œã€‚ docker network rm :åˆ é™¤dockerä¸»æœºä¸ŠæŒ‡å®šçš„ç½‘ç»œ ","date":"2023-05-21","objectID":"/docker-command/:6:0","tags":["docker"],"title":"Docker Command","uri":"/docker-command/"},{"categories":["æ–‡æ¡£"],"content":"docker volume docker volume create ï¼šåˆ›å»ºæ–°å·ï¼Œé»˜è®¤ä½¿ç”¨çš„localé©±åŠ¨ï¼ŒåŠ -då‚æ•°æŒ‡å®šä¸åŒé©±åŠ¨ docker volume ls :æŸ¥çœ‹dockerä¸»æœºçš„å…¨éƒ¨å· docker volume inspect: æŸ¥çœ‹å·çš„è¯¦ç»†ä¿¡æ¯ docker volume prune ï¼šåˆ é™¤æœªè¢«å®¹å™¨å’ŒæœåŠ¡ä½¿ç”¨çš„å· docker volume rm:åˆ é™¤æŒ‡å®šå· ","date":"2023-05-21","objectID":"/docker-command/:7:0","tags":["docker"],"title":"Docker Command","uri":"/docker-command/"},{"categories":["æ–‡æ¡£"],"content":"Docker Stack docker stack deployï¼š ç”¨äºæ ¹æ®stackæ–‡ä»¶éƒ¨ç½²å’Œæ›´æ–°stackæœåŠ¡ docker stack ls ï¼šåˆ—å‡ºswarmé›†ç¾¤ä¸­æ‰€æœ‰çš„stack docker stack ps: åˆ—å‡ºæŸä¸ªå·²ç»éƒ¨ç½²çš„stackçš„ç›¸å…³ä¿¡æ¯ã€‚ docker stack rmï¼šä»swarmé›†ç¾¤ä¸­ç§»é™¤stack ","date":"2023-05-21","objectID":"/docker-command/:8:0","tags":["docker"],"title":"Docker Command","uri":"/docker-command/"},{"categories":["æ–‡æ¡£"],"content":" Lighthouse (figure) PVã€PVCã€StorageClass Kubernetes å¤„ç†å®¹å™¨æŒä¹…åŒ–å­˜å‚¨çš„æ ¸å¿ƒåŸç† PVï¼š æŒä¹…åŒ–å­˜å‚¨æ•°æ®å· pv ä¸€èˆ¬æœ‰è¿ç»´äººå‘˜äº‹å…ˆåˆ›å»ºä¹‹åä½¿ç”¨ï¼Œ å®šä¹‰ä¸€ä¸ªNFSç±»å‹çš„PV apiVersion: v1 kind: PersistentVolume metadata: name: nfs spec: storageClassName: manual capacity: storage: 1Gi accessModes: - ReadWriteMany nfs: server: 10.244.1.4 path: \"/\" PVCï¼š podæ‰€å¸Œæœ›ä½¿ç”¨çš„æŒä¹…åŒ–å­˜å‚¨çš„å±æ€§ ä¸€èˆ¬æœ‰å¼€å‘äººå‘˜åˆ›å»ºï¼Œ Volumeå­˜å‚¨çš„å¤§å°ï¼Œå¯è¯»å†™çš„æƒé™ apiVersion: v1 kind: PersistentVolumeClaim metadata: name: nfs spec: accessModes: - ReadWriteMany storageClassName: manual resources: requests: storage: 1Gi ","date":"2023-05-20","objectID":"/sc-pv-pvc/:0:0","tags":["k8s"],"title":"Kubernets-Sc\u0026Pv\u0026Pvc","uri":"/sc-pv-pvc/"},{"categories":["æ–‡æ¡£"],"content":"PVCä¸PVç»‘å®šä½¿ç”¨çš„æ¡ä»¶ PVå’ŒPVCçš„specå­—æ®µï¼ŒPVçš„å­˜å‚¨å¤§å°ï¼Œ å°±å¿…é¡»æ»¡è¶³PVCçš„è¦æ±‚ PV å’Œ PVC çš„ storageClassName å­—æ®µå¿…é¡»ä¸€æ · YAML æ–‡ä»¶é‡Œå£°æ˜ä½¿ç”¨è¿™ä¸ª PVC äº† apiVersion: v1 kind: Pod metadata: labels: role: web-frontend spec: containers: - name: web image: nginx ports: - name: web containerPort: 80 volumeMounts: - name: nfs mountPath: \"/usr/share/nginx/html\" volumes: - name: nfs persistentVolumeClaim: claimName: nfs ","date":"2023-05-20","objectID":"/sc-pv-pvc/:1:0","tags":["k8s"],"title":"Kubernets-Sc\u0026Pv\u0026Pvc","uri":"/sc-pv-pvc/"},{"categories":["æ–‡æ¡£"],"content":"PersistentVolumeController ä¸“é—¨å¤„ç†æŒä¹…åŒ–å­˜å‚¨çš„æ§åˆ¶å™¨ï¼Œ ä¼šä¸æ–­åœ°æŸ¥çœ‹å½“å‰æ¯ä¸€ä¸ª PVCï¼Œæ˜¯ä¸æ˜¯å·²ç»å¤„äº Boundï¼ˆå·²ç»‘å®šï¼‰çŠ¶æ€ã€‚å¦‚æœä¸æ˜¯ï¼Œé‚£å®ƒå°±ä¼šéå†æ‰€æœ‰çš„ã€å¯ç”¨çš„ PVï¼Œå¹¶å°è¯•å°†å…¶ä¸è¿™ä¸ªâ€œå•èº«â€çš„ PVC è¿›è¡Œç»‘å®š æ‰€è°“å®¹å™¨çš„ Volumeï¼Œå…¶å®å°±æ˜¯å°†ä¸€ä¸ªå®¿ä¸»æœºä¸Šçš„ç›®å½•ï¼Œè·Ÿä¸€ä¸ªå®¹å™¨é‡Œçš„ç›®å½•ç»‘å®šæŒ‚è½½åœ¨äº†ä¸€èµ· è€Œæ‰€è°“çš„â€œæŒä¹…åŒ– Volumeâ€ï¼ŒæŒ‡çš„å°±æ˜¯è¿™ä¸ªå®¿ä¸»æœºä¸Šçš„ç›®å½•ï¼Œå…·å¤‡â€œæŒä¹…æ€§â€ è¿™ä¸ªå‡†å¤‡â€œæŒä¹…åŒ–â€å®¿ä¸»æœºç›®å½•çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥å½¢è±¡åœ°ç§°ä¸ºâ€œä¸¤é˜¶æ®µå¤„ç† ä¸€ä¸ªPodè°ƒåº¦åˆ°ä¸€ä¸ªèŠ‚ç‚¹ä¸Šä¹‹åï¼Œ kubeletå°±è¦è´Ÿè´£è¿™ä¸ªPodåˆ›å»ºçš„å®ƒçš„Volumeç›®å½•ï¼Œé»˜è®¤è¿™ä¸ªæƒ…å†µä¸‹ï¼Œkubelet ä¸º Volume åˆ›å»ºçš„ç›®å½•æ˜¯å¦‚ä¸‹æ‰€ç¤ºçš„ä¸€ä¸ªå®¿ä¸»æœºä¸Šçš„è·¯å¾„ï¼š /var/lib/kubelet/pods/\u003cPod çš„ ID\u003e/volumes/kubernetes.io~\u003cVolume ç±»å‹ \u003e/\u003cVolume åå­— \u003e è¿™ä¸€æ­¥ä¸ºè™šæ‹ŸæœºæŒ‚è½½è¿œç¨‹ç£ç›˜çš„æ“ä½œï¼Œå¯¹åº”çš„æ­£æ˜¯â€œä¸¤é˜¶æ®µå¤„ç†â€çš„ç¬¬ä¸€é˜¶æ®µã€‚åœ¨ Kubernetes ä¸­ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªé˜¶æ®µç§°ä¸º Attach å°†ç£ç›˜è®¾å¤‡æ ¼å¼åŒ–å¹¶æŒ‚è½½åˆ° Volume å®¿ä¸»æœºç›®å½•çš„æ“ä½œï¼Œå¯¹åº”çš„æ­£æ˜¯â€œä¸¤é˜¶æ®µå¤„ç†â€çš„ç¬¬äºŒä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬ä¸€èˆ¬ç§°ä¸ºï¼šMountã€‚ åœ¨è¿™ä¸€æ­¥ï¼Œkubelet éœ€è¦ä½œä¸º clientï¼Œå°†è¿œç«¯ NFS æœåŠ¡å™¨çš„ç›®å½•ï¼ˆæ¯”å¦‚ï¼šâ€œ/â€ç›®å½•ï¼‰ï¼ŒæŒ‚è½½åˆ° Volume çš„å®¿ä¸»æœºç›®å½•ä¸Šï¼Œå³ç›¸å½“äºæ‰§è¡Œå¦‚ä¸‹æ‰€ç¤ºçš„å‘½ä»¤ï¼š $ mount -t nfs \u003cNFS æœåŠ¡å™¨åœ°å€ \u003e:/ /var/lib/kubelet/pods/\u003cPod çš„ ID\u003e/volumes/kubernetes.io~\u003cVolume ç±»å‹ \u003e/\u003cVolume åå­— \u003e kubelet åªè¦æŠŠè¿™ä¸ª Volume ç›®å½•é€šè¿‡ CRI é‡Œçš„ Mounts å‚æ•°ï¼Œä¼ é€’ç»™ Dockerï¼Œç„¶åå°±å¯ä»¥ä¸º Pod é‡Œçš„å®¹å™¨æŒ‚è½½è¿™ä¸ªâ€œæŒä¹…åŒ–â€çš„ Volume äº†ã€‚å…¶å®ï¼Œè¿™ä¸€æ­¥ç›¸å½“äºæ‰§è¡Œäº†å¦‚ä¸‹æ‰€ç¤ºçš„å‘½ä»¤ $ docker run -v /var/lib/kubelet/pods/\u003cPod çš„ ID\u003e/volumes/kubernetes.io~\u003cVolume ç±»å‹ \u003e/\u003cVolume åå­— \u003e:/\u003c å®¹å™¨å†…çš„ç›®æ ‡ç›®å½• \u003e æˆ‘çš„é•œåƒ ... PV çš„â€œä¸¤é˜¶æ®µå¤„ç†â€æµç¨‹ï¼Œæ˜¯é ç‹¬ç«‹äº kubelet ä¸»æ§åˆ¶å¾ªç¯ï¼ˆKubelet Sync Loopï¼‰ä¹‹å¤–çš„ä¸¤ä¸ªæ§åˆ¶å¾ªç¯æ¥å®ç°çš„ StorageClass k8sæä¾›äº†ä¸€å¥—è‡ªåŠ¨åˆ›å»ºPVçš„æœºåˆ¶ï¼Œ Dynamic Provisioning storageClasså¯¹è±¡çš„ä½œç”¨ï¼Œ å…¶å®å°±æ˜¯åˆ›å»ºPVçš„æ¨¡æ¿ ä¸»è¦å®šä¹‰ä¸¤éƒ¨åˆ† PVçš„å±æ€§ï¼Œ ï¼ˆå­˜å‚¨ç±»å‹ï¼Œ Volumeçš„å¤§å°ï¼‰ åˆ›å»ºè¿™ç§PVéœ€è¦ç”¨åˆ°çš„å­˜å‚¨æ’ä»¶ï¼Œ ï¼ˆnfsã€Cephï¼‰ apiVersion: storage.k8s.io/v1 kind: StorageClass metadata: name: block-service provisioner: kubernetes.io/gce-pd parameters: type: pd-ssd apiVersion: ceph.rook.io/v1beta1 kind: Pool metadata: name: replicapool namespace: rook-ceph spec: replicated: size: 3 --- apiVersion: storage.k8s.io/v1 kind: StorageClass metadata: name: block-service provisioner: ceph.rook.io/block parameters: pool: replicapool #The value of \"clusterNamespace\" MUST be the same as the one in which your rook cluster exist clusterNamespace: rook-ceph Lighthouse (figure) PVCæè¿°çš„ï¼Œ æ˜¯Podæƒ³è¦ä½¿ç”¨çš„æŒä¹…åŒ–å­˜å‚¨çš„å±æ€§ï¼ˆå­˜å‚¨çš„å¤§å°ã€è¯»å†™æƒé™ï¼‰ PVçš„æè¿°ï¼Œ ä¸€ä¸ªå…·ä½“çš„Volumeçš„å±æ€§ï¼Œ ï¼ˆVolumeçš„ç±»å‹ï¼Œ æŒ‚è½½ç›®å½•ã€‚ è¿œç¨‹å­˜å‚¨æœåŠ¡åœ°å€ï¼‰ StorageClass çš„ä½œç”¨ï¼Œ å……å½“PVçš„æ¨¡æ¿ï¼Œ åªæœ‰å±äºä¸€ä¸ªStorageClassçš„PVå’ŒPVCæ‰å¯ä»¥ç»‘å®šå­å•Šä¸€èµ· ","date":"2023-05-20","objectID":"/sc-pv-pvc/:2:0","tags":["k8s"],"title":"Kubernets-Sc\u0026Pv\u0026Pvc","uri":"/sc-pv-pvc/"},{"categories":["æ–‡æ¡£"],"content":"Operator å·¥ä½œåŸç†è§£è¯» operatorçš„å·¥ä½œåŸç†å’Œç¼–å†™æ–¹æ³• ","date":"2023-05-20","objectID":"/operator/:0:0","tags":["k8s"],"title":"Kubernets-Operator","uri":"/operator/"},{"categories":["æ–‡æ¡£"],"content":"ç¬¬ä¸€æ­¥ï¼Œå°†è¿™ä¸ª Operator çš„ä»£ç  Clone åˆ°æœ¬åœ°ï¼š git clone https://github.com/coreos/etcd-operator ","date":"2023-05-20","objectID":"/operator/:0:1","tags":["k8s"],"title":"Kubernets-Operator","uri":"/operator/"},{"categories":["æ–‡æ¡£"],"content":"ç¬¬äºŒæ­¥ï¼Œå°†è¿™ä¸ª Etcd Operator éƒ¨ç½²åœ¨ Kubernetes é›†ç¾¤é‡Œ example/rbac/create_role.sh è¿™ä¸ªè„šæœ¬ä¸º Etcd Operator åˆ›å»º RBAC è§„åˆ™ï¼Œ å› ä¸º Etcd Operator éœ€è¦è®¿é—®Kubernetesçš„APIServeræ¥åˆ›å»ºå¯¹è±¡ å¯¹Podï¼Œ serviceï¼ŒPVCï¼Œ Deploymentï¼Œ Secretç­‰APIå¯¹è±¡ï¼Œ æœ‰æ‰€æœ‰æƒé™ å¯¹CRDå¯¹è±¡ï¼Œ æœ‰æ‰€æœ‰æƒé™ å¯¹å±äºetcd.database.coreos.com è¿™ä¸ª API Group çš„ CRï¼ˆCustom Resourceï¼‰å¯¹è±¡ï¼Œæœ‰æ‰€æœ‰æƒé™ã€‚ Etcd Operator æœ¬èº« æ˜¯ä¸€ä¸ªDeployment apiVersion: extensions/v1beta1 kind: Deployment metadata: name: etcd-operator spec: replicas: 1 template: metadata: labels: name: etcd-operator spec: containers: - name: etcd-operator image: quay.io/coreos/etcd-operator:v0.9.2 command: - etcd-operator env: - name: MY_POD_NAMESPACE valueFrom: fieldRef: fieldPath: metadata.namespace - name: MY_POD_NAME valueFrom: fieldRef: fieldPath: metadata.name åˆ›å»º Etcd Operator kubectl create -f example/deployment.yaml podè¿›å…¥Running çŠ¶æ€ï¼Œ æœ‰ä¸€ä¸ªCRDè¢«è‡ªåŠ¨åˆ›å»ºå‡ºæ¥ $ kubectl get pods NAME READY STATUS RESTARTS AGE etcd-operator-649dbdb5cb-bzfzp 1/1 Running 0 20s $ kubectl get crd NAME CREATED AT etcdclusters.etcd.database.coreos.com 2018-09-18T11:42:55Z é€šè¿‡ kubectl describe å‘½ä»¤çœ‹åˆ°å®ƒçš„ç»†èŠ‚ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š $ kubectl describe crd etcdclusters.etcd.database.coreos.com ... Group: etcd.database.coreos.com Names: Kind: EtcdCluster List Kind: EtcdClusterList Plural: etcdclusters Short Names: etcd Singular: etcdcluster Scope: Namespaced Version: v1beta2 ... ","date":"2023-05-20","objectID":"/operator/:1:0","tags":["k8s"],"title":"Kubernets-Operator","uri":"/operator/"},{"categories":["æ–‡æ¡£"],"content":"ç¼–å†™EtcdClutserçš„Yamlï¼Œ $ kubectl apply -f example/example-etcd-cluster.yaml è¿™ä¸ª example-etcd-cluster.yaml æ–‡ä»¶é‡Œæè¿°çš„ï¼Œæ˜¯ä¸€ä¸ª 3 ä¸ªèŠ‚ç‚¹çš„ Etcd é›†ç¾¤ kubectl get pods NAME READY STATUS RESTARTS AGE example-etcd-cluster-dp8nqtjznc 1/1 Running 0 1m example-etcd-cluster-mbzlg6sd56 1/1 Running 0 2m example-etcd-cluster-v6v6s6stxd 1/1 Running 0 2m apiVersion: \"etcd.database.coreos.com/v1beta2\" kind: \"EtcdCluster\" metadata: name: \"example-etcd-cluster\" spec: size: 3 version: \"3.2.13\" ","date":"2023-05-20","objectID":"/operator/:2:0","tags":["k8s"],"title":"Kubernets-Operator","uri":"/operator/"},{"categories":["æ–‡æ¡£"],"content":"Operator çš„å·¥ä½œåŸç†ï¼š å®é™…ä¸Šåˆ©ç”¨äº†Kubernetesçš„è‡ªå®šä¹‰APIèµ„æºï¼ˆCRDï¼‰ï¼Œæ¥æè¿°æˆ‘ä»¬æƒ³è¦ä¸ç†Ÿçš„â€œæœ‰çŠ¶æ€åº”ç”¨â€ï¼Œç„¶åå†è‡ªå®šä¹‰æ§åˆ¶å™¨é‡Œï¼Œ æ ¹æ®è‡ªå®šä¹‰APIå¯¹è±¡çš„å˜åŒ–ï¼Œ æ¥å®Œæˆå…·ä½“çš„éƒ¨ç½²å’Œè¿ç»´å·¥ä½œ tcd Operator åœ¨ä¸šåŠ¡é€»è¾‘çš„å®ç°æ–¹å¼ä¸Š ç¬¬ä¸€ä¸ªå·¥ä½œåªåœ¨è¯¥CLusterå¯¹è±¡ç¬¬ä¸€æ¬¡è¢«åˆ›å»ºçš„æ—¶å€™ä¼šæ‰§è¡Œï¼Œ è¿™ä¸ªå·¥ä½œï¼Œ å°±æ˜¯æˆ‘ä»¬å‰é¢æåˆ°Bootstrapï¼Œå³ï¼šåˆ›å»ºä¸€ä¸ªå•èŠ‚ç‚¹çš„ç§å­é›†ç¾¤ã€‚ Bootstrapï¼Œå³ï¼šåˆ›å»ºä¸€ä¸ªå•èŠ‚ç‚¹çš„ç§å­é›†ç¾¤ã€‚ ","date":"2023-05-20","objectID":"/operator/:3:0","tags":["k8s"],"title":"Kubernets-Operator","uri":"/operator/"},{"categories":["æ–‡æ¡£"],"content":"åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ï¼šRBAC åœ¨kubernetesé¡¹ç›®ä¸­ è´Ÿè´£å®Œæˆæˆæƒçš„ï¼ˆAuthorizationï¼‰å·¥ä½œçš„è®°ä½ï¼Œ å°±æ˜¯RBACï¼Œ åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRole-based Access Controlï¼‰ ä¸‰ä¸ªåŸºæœ¬æ¦‚å¿µ Roleï¼š è§’è‰²ï¼Œå®ƒå…¶å®æ˜¯ä¸€ç»„è§„åˆ™ï¼Œ å®šä¹‰äº†ä¸€ç»„å¯¹Kubernetes APIå¯¹è±¡çš„æ“ä½œæƒé™ Subjectï¼š è¢«ä½œç”¨è€…ï¼Œå³å¯ä»¥æ˜¯â€œäººâ€ï¼Œ ä¹Ÿå¯ä»¥æ˜¯â€œæœºå™¨â€ RoleBindingï¼š å®šä¹‰äº†â€œè¢«ä½œç”¨è€…â€å’Œâ€œè§’è‰²â€çš„ç»‘å®šå…³ç³» ","date":"2023-05-20","objectID":"/rbac/:0:0","tags":["k8s"],"title":"Kubernets-Rbac","uri":"/rbac/"},{"categories":["æ–‡æ¡£"],"content":"Role kind: Role apiVersion: rbac.authorization.k8s.io/v1 metadata: namespace: mynamespace name: example-role rules: - apiGroups: [\"\"] resources: [\"pods\"] verbs: [\"get\", \"watch\", \"list\"] ","date":"2023-05-20","objectID":"/rbac/:0:1","tags":["k8s"],"title":"Kubernets-Rbac","uri":"/rbac/"},{"categories":["æ–‡æ¡£"],"content":"Subjectæ˜¯å¦‚ä½•æŒ‡å®šçš„ é€šè¿‡RoleBindingæ¥å®ç°çš„ kind: RoleBinding apiVersion: rbac.authorization.k8s.io/v1 metadata: name: example-rolebinding namespace: mynamespace subjects: - kind: User name: example-user apiGroup: rbac.authorization.k8s.io roleRef: kind: Role name: example-role apiGroup: rbac.authorization.k8s.io ","date":"2023-05-20","objectID":"/rbac/:1:0","tags":["k8s"],"title":"Kubernets-Rbac","uri":"/rbac/"},{"categories":["æ–‡æ¡£"],"content":"Useræ˜¯ä»å“ªé‡Œæ¥çš„ï¼Ÿ kubernetes çš„User ï¼Œ åªæ˜¯ä¸€ä¸ªæˆæƒç³»ç»Ÿçš„ç³»ç»Ÿé‡Œçš„é€»è¾‘æ¦‚å¿µã€‚ é€šè¿‡å¤–éƒ¨è®¤è¯æœåŠ¡ï¼Œæ¯”å¦‚ keystone ç›´æ¥ç»™APIServeræŒ‡å®šä¸€ä¸ªç”¨æˆ·åã€å¯†ç æ–‡ä»¶ RoleBindingå¯¹è±¡å°±å¯ä»¥ç›´æ¥é€šè¿‡åå­—ï¼Œ æ¥å¼•ç”¨å‰é¢å®šä¹‰çš„Roleå¯¹è±¡ï¼Œ ä»è€Œå®šä¹‰äº†â€œè¢«ä½œç”¨è€…ï¼ˆSubjectï¼‰â€å’Œâ€œè§’è‰²ï¼ˆRoleï¼‰â€ä¹‹é—´çš„ç»‘å®šå…³ç³» ","date":"2023-05-20","objectID":"/rbac/:2:0","tags":["k8s"],"title":"Kubernets-Rbac","uri":"/rbac/"},{"categories":["æ–‡æ¡£"],"content":"ClusterRole å’Œ ClusterRolebind kind: ClusterRole apiVersion: rbac.authorization.k8s.io/v1 metadata: name: example-clusterrole rules: - apiGroups: [\"\"] resources: [\"pods\"] verbs: [\"get\", \"watch\", \"list\"] èµ‹äºˆç”¨æˆ·æ‰€æœ‰æƒé™ verbs: [\"get\", \"list\", \"watch\", \"create\", \"update\", \"patch\", \"delete\"] é’ˆå¯¹æŸä¸€å…·ä½“å¯¹è±¡è¿›è¡Œæƒé™è®¾ç½® rules: - apiGroups: [\"\"] resources: [\"configmaps\"] resourceNames: [\"my-config\"] verbs: [\"get\"] kind: ClusterRoleBinding apiVersion: rbac.authorization.k8s.io/v1 metadata: name: example-clusterrolebinding subjects: - kind: User name: example-user apiGroup: rbac.authorization.k8s.io roleRef: kind: ClusterRole name: example-clusterrole apiGroup: rbac.authorization.k8s.io è¿™ä¸ªç”± Kubernetes è´Ÿè´£ç®¡ç†çš„â€œå†…ç½®ç”¨æˆ·â€ï¼Œæ­£æ˜¯æˆ‘ä»¬å‰é¢æ›¾ç»æåˆ°è¿‡çš„ï¼šServiceAccountã€‚ ","date":"2023-05-20","objectID":"/rbac/:3:0","tags":["k8s"],"title":"Kubernets-Rbac","uri":"/rbac/"},{"categories":["æ–‡æ¡£"],"content":"å®šä¹‰ä¸€ä¸ªServiceAccount apiVersion: v1 kind: ServiceAccount metadata: namespace: mynamespace name: example-sa ç¼–å†™RoleBindingçš„Yaml æ–‡ä»¶ï¼Œ ä¸ºè¿™ä¸ªServiceAccountåˆ†é…æƒé™ kind: RoleBinding apiVersion: rbac.authorization.k8s.io/v1 metadata: name: example-rolebinding namespace: mynamespace subjects: - kind: ServiceAccount name: example-sa namespace: mynamespace roleRef: kind: Role name: example-role apiGroup: rbac.authorization.k8s.io åˆ›å»ºè¿™ä¸ªå¯¹è±¡ $ kubectl create -f svc-account.yaml $ kubectl create -f role-binding.yaml $ kubectl create -f role.yaml æŸ¥çœ‹è¯¦æƒ… $ kubectl get sa -n mynamespace -o yaml - apiVersion: v1 kind: ServiceAccount metadata: creationTimestamp: 2018-09-08T12:59:17Z name: example-sa namespace: mynamespace resourceVersion: \"409327\" ... secrets: - name: example-sa-token-vmfg6 ","date":"2023-05-20","objectID":"/rbac/:4:0","tags":["k8s"],"title":"Kubernets-Rbac","uri":"/rbac/"},{"categories":["æ–‡æ¡£"],"content":"å£°æ˜å¼APIä¸Kubernetesç¼–ç èŒƒå¼ kubectl create å†replaceçš„æ“ä½œï¼Œ ç§°ä¸ºå‘½ä»¤å¼é…ç½®æ–‡ä»¶æ“ä½œ å£°æ˜å¼API https://hugbz2.51cg3.co/archives/25451 /https://hugbz2.51cg3.co/archives/4081/ kuberctl apply å‘½ä»¤å°±æ˜¯ å£°æ˜å¼API ","date":"2023-05-20","objectID":"/%E5%A3%B0%E6%98%8E%E5%BC%8Fapi/:0:0","tags":["k8s"],"title":"Kubernets-å£°æ˜å¼API","uri":"/%E5%A3%B0%E6%98%8E%E5%BC%8Fapi/"},{"categories":["æ–‡æ¡£"],"content":"apply ä¸ replaceå‘½ä»¤çš„æœ¬è´¨åŒºåˆ« replaceï¼š æ˜¯ä½¿ç”¨æ–°çš„YAMLæ–‡ä»¶ä¸­çš„APIå¯¹è±¡ï¼Œæ›¿æ¢åŸæ¥çš„APIå¯¹è±¡ applyï¼š æ‰§è¡Œäº†ä¸€ä¸ªå¯¹åŸæœ‰çš„APIå¯¹è±¡çš„PATCHæ“ä½œ å¯¹äºkube-apiserveråœ¨å“åº”å‘½ä»¤å¼è¯·æ±‚çš„æ—¶å€™ replaceï¼š åªèƒ½å¤„ç†ä¸€ä¸ªå†™è¯·æ±‚ï¼Œ å¦åˆ™ä¼šæœ‰äº§ç”Ÿå†²çªçš„å¯èƒ½ applyï¼š ä¸€æ¬¡èƒ½å¤„ç†å¤šä¸ªå†™æ“ä½œï¼Œ å¹¶ä¸”å…·å¤‡Mergeèƒ½åŠ› Istio Istioæœ€æ ¹æœ¬çš„ç»„ä»¶ï¼Œ æ˜¯è¿è¡Œåœ¨æ¯ä¸€ä¸ªåº”ç”¨Podé‡Œçš„Envoyå®¹å™¨ Istioé¡¹ç›®ï¼Œ ä»£ç†æœåŠ¡ä»¥sidecarå®¹å™¨çš„æ–¹å¼ï¼Œ è¿è¡Œåœ¨æ¯ä¸€ä¸ªè¢«æ²»ç†çš„åº”ç”¨Podä¸­ï¼Œ Envoyå®¹å™¨å°±èƒ½å¤Ÿé€šè¿‡é…ç½®Podé‡Œçš„iptablesè§„åˆ™ï¼Œ æŠŠæ•´ä¸ªPodçš„è¿›å‡ºæµé‡æ¥ç®¡ä¸‹æ¥ Istio çš„æ§åˆ¶å±‚é‡Œçš„Pilotç»„ä»¶ï¼Œå°±èƒ½å¤Ÿè°ƒç”¨æ¯ä¸ªEnvoyå®¹å™¨çš„APIï¼Œ å¯¹è¿™ä¸ªEnvoyä»£ç†è¿›è¡Œé…ç½®ï¼Œ ä»è€Œå®ç°å¾®æœåŠ¡æ²»ç†ã€‚ ","date":"2023-05-20","objectID":"/%E5%A3%B0%E6%98%8E%E5%BC%8Fapi/:0:1","tags":["k8s"],"title":"Kubernets-å£°æ˜å¼API","uri":"/%E5%A3%B0%E6%98%8E%E5%BC%8Fapi/"},{"categories":["æ–‡æ¡£"],"content":"Istioé¡¹ç›®ä½¿ç”¨çš„ï¼Œ æ˜¯kubernetesä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„åŠŸèƒ½Dynamic Adminssion Control Kubernetes é¡¹ç›®ä¸ºæˆ‘ä»¬é¢å¤–æä¾›äº†ä¸€ç§â€œçƒ­æ’æ‹”â€å¼çš„ Admission æœºåˆ¶ï¼Œå®ƒå°±æ˜¯ Dynamic Admission Controlï¼Œä¹Ÿå«ä½œï¼šInitializerã€‚ ç°åœ¨ï¼Œæˆ‘ç»™ä½ ä¸¾ä¸ªä¾‹å­ã€‚æ¯”å¦‚ï¼Œæˆ‘æœ‰å¦‚ä¸‹æ‰€ç¤ºçš„ä¸€ä¸ªåº”ç”¨ Podï¼š apiVersion: v1 kind: Pod metadata: name: myapp-pod labels: app: myapp spec: containers: - name: myapp-container image: busybox command: ['sh', '-c', 'echo Hello Kubernetes! \u0026\u0026 sleep 3600'] Istioé¡¹ç›®è¦åšçš„ï¼Œ å°±æ˜¯åœ¨è¿™ä¸ªPod Yamlè¢«æäº¤ç»™kubernetesä¹‹åï¼Œ å®ƒå¯¹åº”çš„APIå¯¹è±¡å­—æ®µåŠ ä¸ŠEnvoyå®¹å™¨çš„é…ç½®ï¼Œ apiVersion: v1 kind: Pod metadata: name: myapp-pod labels: app: myapp spec: containers: - name: myapp-container image: busybox command: ['sh', '-c', 'echo Hello Kubernetes! \u0026\u0026 sleep 3600'] - name: envoy image: lyft/envoy:845747b88f102c0fd262ab234308e9e22f693a1 command: [\"/usr/local/bin/envoy\"] ... Istio è¦åšçš„ï¼Œå°±æ˜¯ç¼–å†™ä¸€ä¸ªç”¨æ¥ä¸º Podâ€œè‡ªåŠ¨æ³¨å…¥â€Envoy å®¹å™¨çš„ Initializerã€‚ é¦–å…ˆï¼Œ Istioä¼šå°†è¿™ä¸ªEnvoyå®¹å™¨æœ¬èº«çš„å®šä¹‰ï¼Œ ä»¥ConfigMapæ–¹å¼ä¿å­˜åœ¨Kuberneteså½“å‰ apiVersion: v1 kind: ConfigMap metadata: name: envoy-initializer data: config: | containers: - name: envoy image: lyft/envoy:845747db88f102c0fd262ab234308e9e22f693a1 command: [\"/usr/local/bin/envoy\"] args: - \"--concurrency 4\" - \"--config-path /etc/envoy/envoy.json\" - \"--mode serve\" ports: - containerPort: 80 protocol: TCP resources: limits: cpu: \"1000m\" memory: \"512Mi\" requests: cpu: \"100m\" memory: \"64Mi\" volumeMounts: - name: envoy-conf mountPath: /etc/envoy volumes: - name: envoy-conf configMap: name: envoy Initializer æ›´æ–°ç”¨æˆ·çš„På¤§å¯¹è±¡çš„æ—¶å€™ï¼Œ å¿…é¡»ä½¿ç”¨PATCH API æ¥å®Œæˆï¼Œ è€Œè¿™ç§PATCH API æ­£å¼å£°æ˜å¼APIçš„ä¸»è¦èƒ½åŠ› Istio å°†ä¸€ä¸ªç¼–å†™å¥½çš„Initializerï¼Œ ä½œä¸ºä¸€ä¸ªPodéƒ¨ç½²åœ¨kubernetesä¸­ apiVersion: v1 kind: Pod metadata: labels: app: envoy-initializer name: envoy-initializer spec: containers: - name: envoy-initializer image: envoy-initializer:0.0.1 imagePullPolicy: Always ä¸æ–­è·å–â€œå®é™…çŠ¶æ€â€ï¼Œ ç„¶åâ€œæœŸæœ›çŠ¶æ€â€åšå¯¹æ¯” initializerçš„æ§åˆ¶å™¨ï¼Œ ä¸æ–­è·å–çš„â€œå®é™…çŠ¶æ€â€ç”¨æˆ·æ–°åˆ›å»ºçš„Pod â€œæœŸæœ›çŠ¶æ€â€ å°±æ˜¯ç ´çš„è¢«æ·»åŠ çš„Envoyå®¹å™¨çš„å®šä¹‰ æœ‰äº†è¿™ä¸ª TwoWayMergePatch ä¹‹åï¼ŒInitializer çš„ä»£ç å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ª patch çš„æ•°æ®ï¼Œè°ƒç”¨ Kubernetes çš„ Clientï¼Œå‘èµ·ä¸€ä¸ª PATCH è¯·æ±‚ Istioé¡¹ç›®çš„æ ¸å¿ƒï¼Œ å°±æ˜¯ç”±æ— æ•°ä¸ªè¿è¡Œåœ¨åº”ç”¨Podä¸­çš„Envoyå®¹å™¨ç»„æˆçš„æœåŠ¡ä»£ç†ç½‘æ ¼ã€‚ ","date":"2023-05-20","objectID":"/%E5%A3%B0%E6%98%8E%E5%BC%8Fapi/:0:2","tags":["k8s"],"title":"Kubernets-å£°æ˜å¼API","uri":"/%E5%A3%B0%E6%98%8E%E5%BC%8Fapi/"},{"categories":["æ–‡æ¡£"],"content":"kubernetes â€œå£°æ˜å¼APIâ€çš„ç‹¬åˆ°ä¹‹å¤„ é¦–å…ˆï¼Œ æ‰€è°“â€œå£°æ˜å¼â€ï¼Œ æˆ‘ä»¬å®šä¹‰ä¸ªå®šä¹‰å¥½çš„APIå¯¹è±¡æ¥â€œå£°æ˜â€ï¼Œ æ‰€æœŸæœ›çš„çŠ¶æ€æ˜¯ä»€ä¹ˆæ ·å­çš„ å…¶æ¬¡ï¼Œ â€œå£°æ˜å¼APIâ€å…è®¸æœ‰å¤šä¸ªAPIå†™ç«¯ï¼Œ ä»¥PATCHçš„æ–¹å¼å¯¹APIå¯¹è±¡è¿›è¡Œä¿®æ”¹ï¼Œè€Œæ— éœ€å…³å¿ƒæœ¬åœ°åŸå§‹çš„YAMLæ–‡ä»¶çš„å†…å®¹ æœ€åï¼Œ Kubernetesé¡¹ç›®æ‰å¯ä»¥åŸºäºå¯¹APIå¯¹è±¡çš„å¢ã€åˆ ã€è¯¥ã€æŸ¥ï¼Œ åœ¨å®Œå…¨æ— éœ€å¤–ç•Œå¹²æ‰°çš„æƒ…å†µä¸‹ï¼Œ å®Œæˆå¯¹â€œå®é™…çŠ¶æ€â€å’Œâ€œæœŸæœ›çŠ¶æ€â€çš„åè°ƒè¿‡ç¨‹ ","date":"2023-05-20","objectID":"/%E5%A3%B0%E6%98%8E%E5%BC%8Fapi/:1:0","tags":["k8s"],"title":"Kubernets-å£°æ˜å¼API","uri":"/%E5%A3%B0%E6%98%8E%E5%BC%8Fapi/"},{"categories":["æ–‡æ¡£"],"content":"Kubernetes ç¼–ç¨‹èŒƒå¼ å¦‚ä½•ä½¿ç”¨æ§åˆ¶å™¨æ¨¡å¼ï¼ŒåŒKubernetesé‡ŒAPIå¯¹è±¡â€œå¢ã€åˆ ã€æ”¹ã€æŸ¥â€è¿›è¡Œåä½œï¼Œå®Œæˆç”¨æˆ·ä¸šåŠ¡é€»è¾‘çš„ç¼–å†™è¿‡ç¨‹ ","date":"2023-05-20","objectID":"/%E5%A3%B0%E6%98%8E%E5%BC%8Fapi/:2:0","tags":["k8s"],"title":"Kubernets-å£°æ˜å¼API","uri":"/%E5%A3%B0%E6%98%8E%E5%BC%8Fapi/"},{"categories":["æ–‡æ¡£"],"content":"ä¸º Network è¿™ä¸ªè‡ªå®šä¹‰ API å¯¹è±¡ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰æ§åˆ¶å™¨ï¼ˆCustom Controllerï¼‰ ä½ å¥½ï¼Œ ç›‘æ§çœ‹åˆ°15ã€16ã€17è¿™ä¸‰å°æœºå™¨èµ„æºä½¿ç”¨ç‡å’Œè´Ÿè½½éƒ½å¤ªä¸é«˜ã€‚ ç›®å‰ç°åœ¨æˆ‘ä»¬è¿™è¾¹èµ„æºéœ€æ±‚è¾ƒå¤šï¼Œè®¡åˆ’3æœˆ8å·ï¼ˆä¸‹å‘¨ä¸‰ï¼‰å›æ”¶è¿™3å°GPUæœºå™¨ã€‚è¯·çŸ¥æ‚‰ã€‚ ","date":"2023-05-20","objectID":"/%E5%A3%B0%E6%98%8E%E5%BC%8Fapi/:3:0","tags":["k8s"],"title":"Kubernets-å£°æ˜å¼API","uri":"/%E5%A3%B0%E6%98%8E%E5%BC%8Fapi/"},{"categories":["æ–‡æ¡£"],"content":"è‡ªå®šä¹‰æ§åˆ¶å™¨çš„åŸç† æ§åˆ¶å™¨çš„å·¥ä½œæµç¨‹ ä»kubernetesçš„APISereré‡Œè·å–å®ƒæ‰€å…³å¿ƒçš„å¯¹è±¡ï¼Œ å°±æ˜¯è‡ªå®šä¹‰çš„Network informerä¸API å¯¹è±¡æ—¶â€”â€”å¯¹åº”çš„ï¼Œ æ‰€ä»¥æˆ‘ä¼ é€’ç»™è‡ªå®šä¹‰æ§åˆ¶å™¨çš„ï¼Œ æ˜¯Networkå¯¹è±¡informer Network Informerè·ŸAPIServerå»ºç«‹è¿æ¥ï¼Œ æ˜¯informeræ‰€ä½¿ç”¨çš„ReflectoråŒ… Reflector ä½¿ç”¨çš„ListAndWatchçš„æ–¹æ³•ï¼Œæ¥â€œè·å–â€å¹¶â€œç›‘å¬â€è¿™äº›Networkå¯¹è±¡å®ä¾‹çš„å˜åŒ– åœ¨ListAndWatchæœºåˆ¶ä¸‹ï¼Œ ä¸€æ—¦APIServerç«¯æœ‰æ–°çš„Networkå®ä¾‹è¢«åˆ›å»ºã€åˆ é™¤æˆ–è€…æ›´æ–°Reflectoréƒ½ä¼šæ”¶åˆ°â€œäº‹ä»¶é€šçŸ¥â€ï¼Œ ä¼šæ”¾è¿›ä¸€ä¸ªDelta FIFO Queueï¼ˆå¢é‡å…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—ï¼‰ä¸­ informeä¼šä¸æ–­ä»è¿™ä¸ªDelta FIFO Queue è¯»å–å¢é‡ï¼Œ æ¯æ‹¿åˆ°ä¸€ä¸ªå¢é‡ï¼Œ informer åˆ¤æ–­è¿™ä¸ªå¢é‡çš„äº‹ä»¶ç±»å‹ã€‚ ç„¶ååˆ›å»ºæˆ–è€…æ›´æ–°æœ¬åœ°å¯¹è±¡çš„ç¼“å­˜ã€‚ï¼ˆè¿™ä¸ªç¼“å­˜åœ¨kubernetesé‡Œå«Storeï¼‰ informerèŒè´£ åŒæ­¥æœ¬åœ°ç¼“å­˜çš„å·¥ä½œ æ ¹æ®è¿™äº›äº‹ä»¶çš„ç±»å‹ï¼Œè§¦å‘äº‹å…ˆæ³¨å†Œå·çš„ResourceEventHandler informer æ˜¯ä¸€ä¸ªé’“å‹æœ¬åœ°ç¼“å­˜å’Œç´¢å¼•æœºåˆ¶çš„ å¯ä»¥æ³¨å†Œçš„EventHandlerçš„client ","date":"2023-05-20","objectID":"/%E5%A3%B0%E6%98%8E%E5%BC%8Fapi/:4:0","tags":["k8s"],"title":"Kubernets-å£°æ˜å¼API","uri":"/%E5%A3%B0%E6%98%8E%E5%BC%8Fapi/"},{"categories":["æ–‡æ¡£"],"content":"Job ä¸ CronJob ","date":"2023-05-20","objectID":"/job_cronjob/:0:0","tags":["k8s"],"title":"Kubernets-Job_Cronjob","uri":"/job_cronjob/"},{"categories":["æ–‡æ¡£"],"content":"Job API apiVersion: batch/v1 kind: Job metadata: name: pi spec: template: spec: containers: - name: pi image: resouer/ubuntu-bc command: [\"sh\", \"-c\", \"echo 'scale=10000; 4*a(1)' | bc -l \"] restartPolicy: Never backoffLimit: 4 è®¡ç®—Ï€å€¼çš„å®¹å™¨ã€‚è€Œé€šè¿‡ scale=10000ï¼Œæˆ‘æŒ‡å®šäº†è¾“å‡ºçš„å°æ•°ç‚¹åçš„ä½æ•°æ˜¯ 10000 ","date":"2023-05-20","objectID":"/job_cronjob/:0:1","tags":["k8s"],"title":"Kubernets-Job_Cronjob","uri":"/job_cronjob/"},{"categories":["æ–‡æ¡£"],"content":"åˆ›å»ºjob $ kubectl create -f job.yaml æŸ¥çœ‹job å¯¹è±¡ $ kubectl describe jobs/pi Name: pi Namespace: default Selector: controller-uid=c2db599a-2c9d-11e6-b324-0209dc45a495 Labels: controller-uid=c2db599a-2c9d-11e6-b324-0209dc45a495 job-name=pi Annotations: \u003cnone\u003e Parallelism: 1 Completions: 1 .. Pods Statuses: 0 Running / 1 Succeeded / 0 Failed Pod Template: Labels: controller-uid=c2db599a-2c9d-11e6-b324-0209dc45a495 job-name=pi Containers: ... Volumes: \u003cnone\u003e Events: FirstSeen LastSeen Count From SubobjectPath Type Reason Message --------- -------- ----- ---- ------------- -------- ------ ------- 1m 1m 1 {job-controller } Normal SuccessfulCreate Created pod: pi-rq5rl podæ¨¡æ¿ï¼Œ ä¼šè‡ªåŠ¨åŠ ä¸Šä¸€ä¸ªcontroller-uid= éšæœºå­—ç¬¦ä¸² jobå¯¹è±¡æœ¬èº«ï¼Œ ä¹Ÿä¼šè‡ªåŠ¨åŠ ä¸Šlabelçš„å¯¹åº”çš„Selectorï¼Œ ä¿è¯jobä¸ä»–æ‰€ç®¡ç†çš„Podä¹‹é—´çš„åŒ¹é…å…³ç³» è¿™ç§è‡ªåŠ¨ç”Ÿæˆçš„Labelå¯¹ç”¨æˆ·æ¥è¯´å¹¶ä¸å‹å¥½ï¼Œ æ‰€ä»¥ä¸å¤ªé€‚åˆæ¨å¹¿åˆ°Deploymentç­‰é•¿ä½œä¸šç¼–æ’å¯¹è±¡ä¸Šã€‚ äº‹å®ä¸Šï¼Œ restartPolicyåœ¨jobå¯¹è±¡é‡Œåªå…è®¸è¢«è®¾ç½®ä¸ºNever å’Œ OnFailure è€Œåœ¨deploymentå¯¹è±¡é‡Œï¼Œ restartPolicyåˆ™åªå…è®¸è¢«è®¾ç½®ä¸ºAlways ","date":"2023-05-20","objectID":"/job_cronjob/:0:2","tags":["k8s"],"title":"Kubernets-Job_Cronjob","uri":"/job_cronjob/"},{"categories":["æ–‡æ¡£"],"content":"æŸ¥çœ‹podæ—¥å¿— $ kubectl logs pi-rq5rl 3.141592653589793238462643383279... ","date":"2023-05-20","objectID":"/job_cronjob/:0:3","tags":["k8s"],"title":"Kubernets-Job_Cronjob","uri":"/job_cronjob/"},{"categories":["æ–‡æ¡£"],"content":"ç¦»çº¿ä½œä¸šå¤±è´¥äº†æ€ä¹ˆåŠï¼Ÿ job å®šä¹‰äº† restartPolicy=Neverï¼Œ é‚£ä¹ˆç¦»çº¿ä½œä¸šå¤±è´¥å job Controller å°±ä¼šä¸æ–­å°è¯•åˆ›å»ºä¸€ä¸ªæ–°çš„pod åœ¨jobå¯¹è±¡çš„spec.backoffLimitå­—æ®µå­—æ®µé‡Œå®šä¹‰äº†é‡è¯•æ¬¡æ•°ä¸º 4ï¼ˆå³ï¼ŒbackoffLimit=4ï¼‰ï¼Œ é»˜è®¤ä¸º6 é‡æ–°åˆ›å»ºPodçš„é—´éš”æ˜¯å‘ˆæŒ‡æ•°å¢åŠ çš„ï¼Œ é‡æ–°åˆ›å»ºPodçš„å‘ç”Ÿåœ¨ 10 sã€20 sã€40 s å®šä¹‰ restartPolicy=OnFailure, é‚£ä¹ˆç¦»çº¿ä½œä¸šå¤±è´¥åï¼Œ JOb Controllerå°±ä¸ä¼šå°è¯•åˆ›å»ºæ–°çš„Podï¼Œ ä½†æ˜¯ä¼šä¸æ–­å°è¯•é‡å¯Podçš„å®¹å™¨ åœ¨ spec.activeDeadlineSeconds å­—æ®µå¯ä»¥è®¾ç½®æœ€é•¿è¿è¡Œæ—¶é—´ spec: backoffLimit: 5 activeDeadlineSeconds: 100 ä¸€æ—¦è¿è¡Œäº†100s, è¿™ä¸ªJobçš„æ‰€æœ‰Podéƒ½ä¼šè¢«ç»ˆæ­¢ ä½ å¯ä»¥åœ¨ Pod çš„çŠ¶æ€é‡Œçœ‹åˆ°ç»ˆæ­¢çš„åŸå› æ˜¯ reason: DeadlineExceededã€‚ ","date":"2023-05-20","objectID":"/job_cronjob/:0:4","tags":["k8s"],"title":"Kubernets-Job_Cronjob","uri":"/job_cronjob/"},{"categories":["æ–‡æ¡£"],"content":"Job Controller å¯¹å¹¶è¡Œä½œä¸šçš„æ§åˆ¶æ–¹æ³• è´Ÿè´£æ§åˆ¶å¹¶è¡Œæ§åˆ¶çš„ä¸¤ä¸ªå‚æ•° spec.parallelism: å®šä¹‰ä¸€ä¸ªJobåœ¨ä»»æ„æ—¶é—´æœ€å¤šå¯ä»¥å¯åŠ¨å¤šå°‘ä¸ªPodåŒäº‹è¿è¡Œ spec.completions: å®šä¹‰Jobè‡³å°‘è¦å®Œæˆçš„Podæ•°ç›®ï¼Œ å³Jobçš„æœ€å°å®Œæˆæ•° åˆ›å»ºä¸€ä¸ªå‚æ•°ä¾‹å­ apiVersion: batch/v1 kind: Job metadata: name: pi spec: parallelism: 2 completions: 4 template: spec: containers: - name: pi image: resouer/ubuntu-bc command: [\"sh\", \"-c\", \"echo 'scale=5000; 4*a(1)' | bc -l \"] restartPolicy: Never backoffLimit: 4 åˆ›å»ºjob $ kubectl create -f job.yaml æŸ¥çœ‹job $ kubectl get job NAME DESIRED SUCCESSFUL AGE pi 4 0 3s DESIREDçš„å€¼ æ­£æ˜¯completionså®šä¹‰çš„æœ€å°å®Œæˆæ•° $ kubectl get pods NAME READY STATUS RESTARTS AGE pi-gmcq5 0/1 Completed 0 40s pi-84ww8 0/1 Pending 0 0s pi-5mt88 0/1 Completed 0 41s pi-62rbt 0/1 Pending 0 0s $ kubectl get pods NAME READY STATUS RESTARTS AGE pi-gmcq5 0/1 Completed 0 40s pi-84ww8 0/1 ContainerCreating 0 0s pi-5mt88 0/1 Completed 0 41s pi-62rbt 0/1 ContainerCreating 0 0s ç”±äºæ‰€æœ‰Podå‡æˆåŠŸé€€å‡º, jobæ‰§è¡Œå®Œæˆ, çœ‹æ‡‚SuCCESSFULä¸º4 $ kubectl get pods NAME READY STATUS RESTARTS AGE pi-5mt88 0/1 Completed 0 5m pi-62rbt 0/1 Completed 0 4m pi-84ww8 0/1 Completed 0 4m pi-gmcq5 0/1 Completed 0 5m $ kubectl get job NAME DESIRED SUCCESSFUL AGE pi 4 4 5m ","date":"2023-05-20","objectID":"/job_cronjob/:1:0","tags":["k8s"],"title":"Kubernets-Job_Cronjob","uri":"/job_cronjob/"},{"categories":["æ–‡æ¡£"],"content":"Job Controllerçš„å·¥ä½œåŸç† é¦–å…ˆ job Controllerçš„æ§åˆ¶å¯¹è±¡ç›´æ¥å°±æ˜¯ Pod å…¶æ¬¡, job Controlleråœ¨æ§åˆ¶å¾ªç¯ä¸­è¿›è¡Œçš„åè°ƒæ“ä½œ, æ˜¯æ ¹æ®å®é™…çš„RunningçŠ¶æ€Podé¢æ•°ç›®,å·²ç»æˆåŠŸé€€å‡ºçš„Podçš„æ•°ç›®, ä»¥åŠ parallelismã€ conpletions å‚æ•°çš„å€¼å…±åŒè®¡ç®—å‡ºåœ¨è¿™ä¸ªå‘¨æœŸé‡Œï¼Œåº”è¯¥åˆ›å»ºæˆ–è€…åˆ é™¤çš„Podæ•°ç›®ï¼Œç„¶åè°ƒç”¨Kubernetes APIæ‰§è¡Œè¿™ä¸ªæ“ä½œ ","date":"2023-05-20","objectID":"/job_cronjob/:1:1","tags":["k8s"],"title":"Kubernets-Job_Cronjob","uri":"/job_cronjob/"},{"categories":["æ–‡æ¡£"],"content":"ç¬¬ä¸€ç§ï¼š å¤–éƒ¨ç®¡ç†å™¨+Jobæ¨¡æ¿ apiVersion: batch/v1 kind: Job metadata: name: process-item-$ITEM labels: jobgroup: jobexample spec: template: metadata: name: jobexample labels: jobgroup: jobexample spec: containers: - name: c image: busybox command: [\"sh\", \"-c\", \"echo Processing item $ITEM \u0026\u0026 sleep 5\"] restartPolicy: Never æ§åˆ¶è¿™ç§ Job æ—¶ï¼Œæˆ‘ä»¬åªè¦æ³¨æ„å¦‚ä¸‹ä¸¤ä¸ªæ–¹é¢å³å¯ï¼š åˆ›å»º Job æ—¶ï¼Œæ›¿æ¢æ‰ $ITEM è¿™æ ·çš„å˜é‡ï¼› æ‰€æœ‰æ¥è‡ªäºåŒä¸€ä¸ªæ¨¡æ¿çš„ Jobï¼Œéƒ½æœ‰ä¸€ä¸ª jobgroup: jobexample æ ‡ç­¾ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸€ç»„ Job ä½¿ç”¨è¿™æ ·ä¸€ä¸ªç›¸åŒçš„æ ‡è¯†ã€‚ $ mkdir ./jobs $ for i in apple banana cherry do cat job-tmpl.yaml | sed \"s/\\$ITEM/$i/\" \u003e ./jobs/job-$i.yaml done $ kubectl create -f ./jobs $ kubectl get pods -l jobgroup=jobexample NAME READY STATUS RESTARTS AGE process-item-apple-kixwv 0/1 Completed 0 4m process-item-banana-wrsf7 0/1 Completed 0 4m process-item-cherry-dnfu9 0/1 Completed 0 4m ","date":"2023-05-20","objectID":"/job_cronjob/:1:2","tags":["k8s"],"title":"Kubernets-Job_Cronjob","uri":"/job_cronjob/"},{"categories":["æ–‡æ¡£"],"content":"ç¬¬äºŒç§ï¼š æ‹¥æœ‰å›ºå®šä»»åŠ¡æ•°ç›®çš„å¹¶è¡ŒJob apiVersion: batch/v1 kind: Job metadata: name: job-wq-1 spec: completions: 8 parallelism: 2 template: metadata: name: job-wq-1 spec: containers: - name: c image: myrepo/job-wq-1 env: - name: BROKER_URL value: amqp://guest:guest@rabbitmq-service:5672 - name: QUEUE value: job1 restartPolicy: OnFailure ","date":"2023-05-20","objectID":"/job_cronjob/:1:3","tags":["k8s"],"title":"Kubernets-Job_Cronjob","uri":"/job_cronjob/"},{"categories":["æ–‡æ¡£"],"content":"ç¬¬ä¸‰ç§ï¼š æŒ‡å®šå¹¶è¡Œåº¦ï¼ˆparallelismï¼‰ï¼Œ ä½†ä¸è®¾ç½®å›ºå®šçš„completions è¿™ç§æƒ…å†µ ï¼Œ ä»»åŠ¡çš„æ€»æ•°æ˜¯æœªçŸ¥çš„ï¼Œ æ‰€ä»¥ä¸ä»…éœ€è¦ä¸€ä¸ªå·¥ä½œé˜Ÿåˆ—æ¥è´Ÿè´£ä»»åŠ¡åˆ†å‘ï¼Œ è¿˜éœ€è¦åˆ¤æ–­å·¥ä½œåˆ—è¡¨å·²ç»ä¸ºç©ºã€‚ apiVersion: batch/v1 kind: Job metadata: name: job-wq-2 spec: parallelism: 2 template: metadata: name: job-wq-2 spec: containers: - name: c image: gcr.io/myproject/job-wq-2 env: - name: BROKER_URL value: amqp://guest:guest@rabbitmq-service:5672 - name: QUEUE value: job2 restartPolicy: OnFailure ","date":"2023-05-20","objectID":"/job_cronjob/:1:4","tags":["k8s"],"title":"Kubernets-Job_Cronjob","uri":"/job_cronjob/"},{"categories":["æ–‡æ¡£"],"content":"CronJobï¼ˆå®šæ—¶ä»»åŠ¡ï¼‰ CronJobæ˜¯ä¸€ä¸ªä¸“é—¨ç”¨æ¥ç®¡ç†Jobå¯¹è±¡çš„æ§åˆ¶å™¨ï¼Œ å®ƒçš„åˆ›å»ºå’Œåˆ é™¤jobçš„ä¾æ®ï¼Œ æ˜¯scheduleå­—æ®µçš„å®šä¹‰ä¸€ä¸ªæ ‡å‡†çš„Unix Cronæ ¼å¼çš„è¡¨è¾¾å¼ã€‚ apiVersion: batch/v1beta1 kind: CronJob metadata: name: hello spec: schedule: \"*/1 * * * *\" jobTemplate: spec: template: spec: containers: - name: hello image: busybox args: - /bin/sh - -c - date; echo Hello from the Kubernetes cluster restartPolicy: OnFailure ç”±äºå®šæ—¶ä»»åŠ¡çš„ç‰¹æ®Šæ€§ï¼Œ æŸä¸ªjobè¿˜æ²¡æœ‰æ‰§è¡Œå®Œï¼Œ å¦ä¸€ä¸ªæ–°çš„jobå°±äº§ç”Ÿäº†ï¼Œ é€šè¿‡spec.concurrencyPolicy å­—æ®µæ¥å®šä¹‰å…·ä½“çš„å¤„ç†ç­–ç•¥ concurrencyPolicy=Allowï¼Œ é»˜è®¤æƒ…å†µï¼Œ æ„å‘³ç€è¿™äº›jobå¯ä»¥åŒæ—¶å­˜åœ¨ concurrencyPolicy=Forbidï¼Œ æ„å‘³ç€ä¸ä¼šåˆ›å»ºæ–°çš„podï¼Œ è¯¥åˆ›å»ºå‘¨æœŸè¢«è·³è¿‡ concurrencyPolicy=Replaceï¼Œ æ„å‘³ç€æ–°äº§ç”Ÿçš„jobä¼šæ›¿æ¢æ—§çš„ã€æ²¡æœ‰æ‰§è¡Œå®Œçš„job å¦‚æœæŸä¸€æ¬¡ Job åˆ›å»ºå¤±è´¥ï¼Œè¿™æ¬¡åˆ›å»ºå°±ä¼šè¢«æ ‡è®°ä¸ºâ€œmissâ€ã€‚å½“åœ¨æŒ‡å®šçš„æ—¶é—´çª—å£å†…ï¼Œmiss çš„æ•°ç›®è¾¾åˆ° 100 æ—¶ï¼Œé‚£ä¹ˆ CronJob ä¼šåœæ­¢å†åˆ›å»ºè¿™ä¸ª Job è¿™ä¸ªæ—¶é—´çª—å£ï¼Œå¯ä»¥ç”± spec.startingDeadlineSeconds å­—æ®µæŒ‡å®šã€‚æ¯”å¦‚ startingDeadlineSeconds=200ï¼Œæ„å‘³ç€åœ¨è¿‡å» 200 s é‡Œï¼Œå¦‚æœ miss çš„æ•°ç›®è¾¾åˆ°äº† 100 æ¬¡ï¼Œé‚£ä¹ˆè¿™ä¸ª Job å°±ä¸ä¼šè¢«åˆ›å»ºæ‰§è¡Œäº†ã€‚ ","date":"2023-05-20","objectID":"/job_cronjob/:2:0","tags":["k8s"],"title":"Kubernets-Job_Cronjob","uri":"/job_cronjob/"},{"categories":["æ–‡æ¡£"],"content":"StatefulSet ","date":"2023-05-20","objectID":"/stateful/:0:0","tags":["k8s"],"title":"Kubernets-StatefulSet","uri":"/stateful/"},{"categories":["æ–‡æ¡£"],"content":"æ¦‚å¿µ StatefulSet çš„è®¾è®¡å…¶å®éå¸¸å®¹å™¨ç†è§£ï¼Œ å®ƒæŠŠçœŸå®ä¸–ç•Œé‡Œçš„åº”ç”¨çŠ¶æ€ï¼Œ æŠ½è±¡ä¸ºä¸¤ä¸ªæƒ…å†µ æ‹“æ‰‘çŠ¶æ€ï¼šè¿™ç§æƒ…å†µæ„å‘³ç€ï¼Œ åº”ç”¨çš„å¤šä¸ªå®ä¾‹ä¹‹é—´ä¸æ˜¯å®Œå…¨å¯¹ç­‰çš„å…³ç³»ï¼Œ è¿™äº›åº”ç”¨å®ä¾‹ï¼Œ ä¸è¡ŒæŒ‰ç…§æŸäº›é¡ºåºå¯åŠ¨ï¼Œæ¯”å¦‚åº”ç”¨çš„ä¸»èŠ‚ç‚¹Aè¦å…ˆäºèŠ‚ç‚¹Bå¯åŠ¨ï¼Œ è€Œå¦‚æœä½ æŠŠAå’ŒBä¸¤ä¸ªPodåˆ é™¤è°ƒï¼Œ ä»–ä»¬å†æ¬¡è¢«åˆ›å»ºå‡ºæ¥ä¹Ÿå¿…é¡»ä¸¥æ ¼å®‰è£…è¿™ä¸ªé¡ºåºæ‰è¡Œï¼Œ å¹¶ä¸”ï¼Œ æ–°åˆ›å»ºå‡ºæ¥çš„Podï¼Œå¿…é¡»å’ŒåŸç†çš„Podçš„ç½‘ç»œæ ‡è¯†ä¸€æ ·ï¼Œ è¿™æ ·åŸå…ˆçš„è®¿é—®è€…æ‰èƒ½ä½¿ç”¨åŒæ ·çš„æ–¹æ³•ï¼Œ è®¿é—®åˆ°è¿™ä¸ªæ–°Podã€‚ å­˜å‚¨çŠ¶æ€ï¼šè¿™ç§æƒ…å†µï¼Œ åº”ç”¨çš„å¤šä¸ªå®ä¾‹åˆ†åˆ«ç»‘å®šäº†ä¸åŒçš„å­˜å‚¨æ•°æ®ï¼Œ å¯¹äºè¿™äº›åº”ç”¨å®ä¾‹æ¥è¯´ï¼ŒPod Aç¬¬ä¸€æ¬¡è¯»å–åˆ°çš„æ•°æ®ï¼Œ å’Œéš”äº†ååˆ†é’Ÿä¹‹åå†æ¬¡è¯»å–åˆ°çš„æ•°æ®ï¼Œ åº”è¯¥æ˜¯åŒä¸€ä»½ï¼Œå“ªæ€•å†æ¬¡æœŸé—´Pod Aè¢«é‡æ–°åˆ›å»ºè¿‡ï¼Œ è¿™ä¸ªæƒ…å†µ å°±æ˜¯ä¸€ä¸ªæ•°æ®åº“åº”ç”¨çš„å¤šä¸ªå­˜å‚¨å®ä¾‹ StatefulSetçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œ å°±æ˜¯é€šè¿‡æŸç§æ–¹å¼è®°å½•è¿™äº›çŠ¶æ€ï¼Œç„¶åå†Podè¢«é‡æ–°åˆ›å»ºæ—¶ï¼Œ èƒ½å¤Ÿä¸ºæ–°çš„Podæ¢å¤è¿™äº›çŠ¶æ€ ","date":"2023-05-20","objectID":"/stateful/:0:1","tags":["k8s"],"title":"Kubernets-StatefulSet","uri":"/stateful/"},{"categories":["æ–‡æ¡£"],"content":"Headless Service Serviceçš„VIPæ–¹å¼ï¼šå½“æˆ‘è®¿é—® 10.0.23.1 è¿™ä¸ª Service çš„ IP åœ°å€æ—¶ï¼Œ10.0.23.1 å…¶å®å°±æ˜¯ä¸€ä¸ª VIPï¼Œå®ƒä¼šæŠŠè¯·æ±‚è½¬å‘åˆ°è¯¥ Service æ‰€ä»£ç†çš„æŸä¸€ä¸ª Pod ä¸Š **Serviceçš„DNSæ–¹å¼ï¼š**è¿™æ—¶å€™ï¼Œåªè¦æˆ‘è®¿é—®â€œmy-svc.my-namespace.svc.cluster.localâ€è¿™æ¡ DNS è®°å½•ï¼Œå°±å¯ä»¥è®¿é—®åˆ°åå« my-svc çš„ Service æ‰€ä»£ç†çš„æŸä¸€ä¸ª Podã€‚ Normal Serviceï¼š ä½ è®¿é—®â€œmy-svc.my-namespace.svc.cluster.localâ€è§£æåˆ°çš„ï¼Œæ­£æ˜¯ my-svc è¿™ä¸ª Service çš„ VIP Headless Serviceï¼š ä½ è®¿é—®â€œmy-svc.my-namespace.svc.cluster.localâ€è§£æåˆ°çš„ï¼Œå°±æ˜¯my-svcä»£ç†çš„æŸä¸ªPodçš„IPåœ°å€ï¼Œ åŒºåˆ«åœ¨äºHeadless Serviceä¸éœ€è¦åˆ†é…ä¸€ä¸ªVIPï¼Œ è€Œæ˜¯ç›´æ¥ä»¥DNSè®°å½•æ–¹å¼è§£æå‡ºè¢«ä»£ç†çš„Podçš„IPåœ°å€ ","date":"2023-05-20","objectID":"/stateful/:0:2","tags":["k8s"],"title":"Kubernets-StatefulSet","uri":"/stateful/"},{"categories":["æ–‡æ¡£"],"content":"Headless Service å¯¹åº”çš„ YAML æ–‡ä»¶ï¼š apiVersion: v1 kind: Service metadata: name: nginx labels: app: nginx spec: ports: - port: 80 name: web clusterIP: None selector: app: nginx Headless Service \u003cpod-name\u003e.\u003csvc-name\u003e.\u003cnamespace\u003e.svc.cluster.local ","date":"2023-05-20","objectID":"/stateful/:0:3","tags":["k8s"],"title":"Kubernets-StatefulSet","uri":"/stateful/"},{"categories":["æ–‡æ¡£"],"content":"StatefulSet åˆæ˜¯å¦‚ä½•ä½¿ç”¨è¿™ä¸ªDNSè®°å½•æ¥ç»´æŒPodçš„æ‹“æ‰‘çŠ¶æ€çš„ï¼Ÿ apiVersion: apps/v1 kind: StatefulSet metadata: name: web spec: serviceName: \"nginx\" replicas: 2 selector: matchLabels: app: nginx template: metadata: labels: app: nginx spec: containers: - name: nginx image: nginx:1.9.1 ports: - containerPort: 80 name: web serviceName=nginx å­—æ®µï¼Œå‘Šè¯‰ StatefulSetæ§åˆ¶å™¨ï¼Œ åœ¨æ‰§è¡Œæ§åˆ¶å¾ªç¯ï¼ˆControl Loopï¼‰çš„æ—¶å€™ï¼Œ è¯·ä½¿ç”¨nginx è¿™ä¸ª Headless Service æ¥ä¿è¯ Pod çš„â€œå¯è§£æèº«ä»½â€ã€‚ $ kubectl run -i --tty --image busybox dns-test --restart=Never --rm /bin/sh $ nslookup web-0.nginx Server: 10.0.0.10 Address 1: 10.0.0.10 kube-dns.kube-system.svc.cluster.local Name: web-0.nginx Address 1: 10.244.1.8 $ nslookup web-1.nginx Server: 10.0.0.10 Address 1: 10.0.0.10 kube-dns.kube-system.svc.cluster.local Name: web-1.nginx Address 1: 10.244.2.8 Kubernetes å°±æ˜¯æˆåŠŸåœ°å°†Podçš„æ‹“æ‰‘çŠ¶æ€ï¼ˆæ¯”å¦‚ï¼šå“ªä¸ªèŠ‚ç‚¹å…ˆå¯åŠ¨ï¼Œå“ªä¸ªèŠ‚ç‚¹åå¯åŠ¨ï¼‰ï¼ŒæŒ‰ç…§ Pod çš„â€œåå­— + ç¼–å·â€çš„æ–¹å¼å›ºå®šäº†ä¸‹æ¥ ","date":"2023-05-20","objectID":"/stateful/:0:4","tags":["k8s"],"title":"Kubernets-StatefulSet","uri":"/stateful/"},{"categories":["æ–‡æ¡£"],"content":"æ€»ç»“ StatefulSet è¿™ä¸ªæ§åˆ¶å™¨ä¸»è¦ä½œç”¨ä¹‹ä¸€ï¼š å°±æ˜¯ä½¿ç”¨Podæ¨¡æ¿åˆ›å»ºPodçš„æ—¶å€™ï¼Œå¯¹ä»–ä»¬è¿›è¡Œç¼–å·ï¼Œ å¹¶ä¸”æŒ‰ç…§ç¼–å·é¡ºåºé€ä¸€å®Œæˆåˆ›å»ºå·¥ä½œï¼Œ è€Œå½“StatefulSet çš„â€æ§åˆ¶å¾ªç¯â€å‘ç°Podçš„â€œå®é™…çŠ¶æ€â€ä¸â€œæœŸæœ›çŠ¶æ€â€ä¸ä¸€è‡´ï¼Œ éœ€è¦æ–°å»ºæˆ–è€…åˆ é™¤Podè¿›è¡Œ â€œè°ƒè°â€çš„æ—¶å€™ï¼Œå®ƒä¼šä¸¥æ ¼æŒ‰ç…§è¿™äº› Pod ç¼–å·çš„é¡ºåºï¼Œé€ä¸€å®Œæˆè¿™äº›æ“ä½œã€‚ æ·±å…¥ç†è§£StatefulSetï¼ˆäºŒï¼‰ï¼šå­˜å‚¨çŠ¶æ€ ","date":"2023-05-20","objectID":"/stateful/:0:5","tags":["k8s"],"title":"Kubernets-StatefulSet","uri":"/stateful/"},{"categories":["æ–‡æ¡£"],"content":"å·¥ä½œåŸç† é¦–ä¿¡ï¼Œ StatefulSetçš„æ§åˆ¶å™¨ç›´æ¥ç®¡ç†çš„æ˜¯Podï¼Œ ï¼Œ å› ä¸ºStatefulSeté‡Œçš„ä¸åŒçš„Podå®ä¾‹ï¼Œ ä¸æƒ³ReplicaSetä¸­é‚£æ ·éƒ½æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œ è€Œæ˜¯æœ‰äº†ç»†å¾®åŒºåˆ«çš„ï¼Œ æ¯”å¦‚ï¼Œ æ¯ä¸ªPodçš„hostanmeã€åå­—ç­‰éƒ½æ˜¯ä¸åŒçš„ï¼Œ æºå¸¦äº†æ ‡çº¢ã€‚ è€ŒstatefulSetï¼ŒåŒºåˆ†è¿™äº›å®ä¾‹çš„æ–¹å¼ï¼Œ é€šè¿‡åœ¨Podçš„åå­—é‡ŒåŠ ä¸Šäº‹å…ˆçº¦å®šå·çš„ç¼–å·ã€‚ å…¶æ¬¡ï¼Œ Kubernetesé€šè¿‡headless ï¼Œ ä¸ºè¿™äº›æœ‰ç¼–å·çš„Podï¼Œ åœ¨DNSæœåŠ¡å™¨ä¸­ç”Ÿæˆå¸¦æœ‰åŒæ ·æ ‡çº¢çš„DNSè®°å½•ï¼Œ åªæœ‰StatefulSetèƒ½å¤Ÿä¿è¯è¿™äº›Podçš„åå­—çš„ç¼–å·ä¸å˜ï¼Œ é‚£ä¹ˆServiceé‡Œç±»ä¼¼äº web-0.nginx.default.svc.cluster.local è¿™æ ·çš„ DNS è®°å½•ä¹Ÿå°±ä¸ä¼šå˜ï¼Œ è€Œè¿™æ¡è®°å½•è§£æå‡ºæ¥çš„Podçš„IPåœ°å€ï¼Œ åˆ™ä¼šéšç€åç«¯Podçš„åˆ é™¤å’Œå†åˆ›å»ºè€Œè‡ªåŠ¨æ›´æ–°ï¼Œ è¿™å½“ç„¶æ˜¯Serviceæœºåˆ¶æœ¬èº«çš„èƒ½åŠ›ï¼Œ ä¸éœ€è¦StatefulSetæ“å¿ƒ æœ€åï¼Œ StatefulSet è¿˜ä¸ºæ¯ä¸ªPodåˆ†é…å¹¶åˆ›å»ºä¸€ä¸ªåŒæ ·ç¼–å·çš„PVCï¼Œï¼Œ è¿™æ · kubernetes å°±å¯ä»¥é€šè¿‡Persistent Volume æœºåˆ¶ä¸ºè¿™ä¸ªPVCç»‘å®šä¸Šæ¯’è¯çš„PVï¼Œ ä»è€Œä¿è¯äº†æ¯ä¸ªPodeéƒ½æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„Volume ","date":"2023-05-20","objectID":"/stateful/:0:6","tags":["k8s"],"title":"Kubernets-StatefulSet","uri":"/stateful/"},{"categories":["æ–‡æ¡£"],"content":"æ€»ç»“ StatefulSet å…¶å®å°±æ˜¯ä¸€ç§ç‰¹æ®Šçš„ Deploymentï¼Œè€Œå…¶ç‹¬ç‰¹ä¹‹å¤„åœ¨äºï¼Œå®ƒçš„æ¯ä¸ª Pod éƒ½è¢«ç¼–å·äº†ã€‚è€Œä¸”ï¼Œè¿™ä¸ªç¼–å·ä¼šä½“ç°åœ¨ Pod çš„åå­—å’Œ hostname ç­‰æ ‡è¯†ä¿¡æ¯ä¸Šï¼Œè¿™ä¸ä»…ä»£è¡¨äº† Pod çš„åˆ›å»ºé¡ºåºï¼Œä¹Ÿæ˜¯ Pod çš„é‡è¦ç½‘ç»œæ ‡è¯†ï¼ˆå³ï¼šåœ¨æ•´ä¸ªé›†ç¾¤é‡Œå”¯ä¸€çš„ã€å¯è¢«çš„è®¿é—®èº«ä»½ï¼‰ã€‚ æœ‰äº†è¿™ä¸ªç¼–å·åï¼ŒStatefulSet å°±ä½¿ç”¨ Kubernetes é‡Œçš„ä¸¤ä¸ªæ ‡å‡†åŠŸèƒ½ï¼šHeadless Service å’Œ PV/PVCï¼Œå®ç°äº†å¯¹ Pod çš„æ‹“æ‰‘çŠ¶æ€å’Œå­˜å‚¨çŠ¶æ€çš„ç»´æŠ¤ã€‚ ","date":"2023-05-20","objectID":"/stateful/:0:7","tags":["k8s"],"title":"Kubernets-StatefulSet","uri":"/stateful/"},{"categories":["æ–‡æ¡£"],"content":"DaemonSet ","date":"2023-05-20","objectID":"/daemonset/:0:0","tags":["k8s"],"title":"Kubernets-DaemonSet","uri":"/daemonset/"},{"categories":["æ–‡æ¡£"],"content":"ä¸»è¦ä½œç”¨ åœ¨kubernetesé›†ç¾¤é‡Œï¼Œ è¿è¡Œä¸€ä¸ªDaemon Podï¼Œ æ‰€ä»¥ï¼Œ è¿™ä¸ªPodæœ‰å¦‚ä¸‹ä¸‰ä¸ªç‰¹å¾ è¿™ä¸ªPodè¿è½½kubernetesé›†ç¾¤é‡Œçš„æ¯ä¸ªèŠ‚ç‚¹ï¼ˆNodeï¼‰ ä¸Š æ¯ä¸ªèŠ‚ç‚¹ä¸Šåªæœ‰ä¸€ä¸ªè¿™æ ·çš„Podå®ä¾‹ å½“æœ‰æ–°çš„èŠ‚ç‚¹åŠ å…¥Kubernetesé›†ç¾¤åï¼Œ è¯¥Pod ä¼šè‡ªåŠ¨çš„å†æ–°èŠ‚ç‚¹ä¸Šè¢«åˆ›å»ºå‡ºæ¥ï¼Œ è€Œå½“èŠ‚ç‚¹è¢«åˆ é™¤åï¼Œ å®ƒä¸Šé¢çš„Podä¹Ÿç›¸åº”ä¼šè¢«å›æ”¶è°ƒã€‚ ","date":"2023-05-20","objectID":"/daemonset/:0:1","tags":["k8s"],"title":"Kubernets-DaemonSet","uri":"/daemonset/"},{"categories":["æ–‡æ¡£"],"content":"Daemon Pod çš„ä¾‹å­ å„ç§ç½‘ç»œæ’ä»¶çš„Agentç»„ä»¶ï¼Œ éƒ½å¿…é¡»è¿è¡Œåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šï¼Œ ç”¨æ¥å¤„ç†è¿™ä¸ªèŠ‚ç‚¹ä¸Šçš„å®¹å™¨ç½‘ç»œ å„ç§å­˜å‚¨çš„æ’ä»¶çš„Agentç»„ä»¶ï¼Œ ä¹Ÿå¿…é¡»è¿è¡Œåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šï¼Œ ç”¨æ¥åœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸ŠæŒ‚è½½è¿œç¨‹å­˜å‚¨ç›®å½•ï¼Œæ“ä½œå®¹å™¨çš„Volumeç›®å½• å„ç§ç›‘æ§ç»„ä»¶å’Œæ—¥å¿—ç»„ä»¶ï¼Œ ä¹Ÿå¿…é¡»è¿è¡Œåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šï¼Œå¤åˆ¶è¿™ä¸ªèŠ‚ç‚¹ä¸Šç›‘æ§ä¿¡æ¯å’Œæ—¥å¿—æœç´¢ API apiVersion: apps/v1 kind: DaemonSet metadata: name: fluentd-elasticsearch namespace: kube-system labels: k8s-app: fluentd-logging spec: selector: matchLabels: name: fluentd-elasticsearch template: metadata: labels: name: fluentd-elasticsearch spec: tolerations: - key: node-role.kubernetes.io/master effect: NoSchedule containers: - name: fluentd-elasticsearch image: k8s.gcr.io/fluentd-elasticsearch:1.20 resources: limits: memory: 200Mi requests: cpu: 100m memory: 200Mi volumeMounts: - name: varlog mountPath: /var/log - name: varlibdockercontainers mountPath: /var/lib/docker/containers readOnly: true terminationGracePeriodSeconds: 30 volumes: - name: varlog hostPath: path: /var/log - name: varlibdockercontainers hostPath: path: /var/lib/docker/containers ","date":"2023-05-20","objectID":"/daemonset/:0:2","tags":["k8s"],"title":"Kubernets-DaemonSet","uri":"/daemonset/"},{"categories":["æ–‡æ¡£"],"content":"Daemonset å¦‚ä½•ç¡®ä¿æ¯ä¸ªNodeä¸Šæœ‰ä¸”åªæœ‰ä¸€ä¸ªè¢«ç®¡ç†çš„Podï¼Ÿ Daemonset Controller ï¼Œ é¦–å…ˆä»Etcd é‡Œè·å–æ‰€æœ‰çš„Nodeåˆ—è¡¨ï¼Œç„¶åéå†æ‰€æœ‰çš„Nodeï¼Œ è¿™æ—¶ï¼Œ å®ƒå°±å¯ä»¥å¾ˆå®¹å™¨çš„å»æ£€æŸ¥ï¼Œ å½“å‰è¿™ä¸ªNodeä¸Šæ˜¯ä¸æ˜¯æºå¸¦äº†name=fluentd-elasticsearch æ ‡ç­¾çš„ Pod åœ¨è¿è¡Œã€‚ æ£€æŸ¥ç»“æœæœ‰ä¸‰ç§æƒ…å†µ æ²¡æœ‰æ¯ç§Podï¼Œ é‚£ä¹ˆå°±æ„å‘³ç€è¿™ä¸ªNodeåˆ›å»ºè¿™æ ·ä¸€ä¸ªPod æœ‰è¿™ç§Podï¼Œ ä½†æ˜¯æ•°é‡å¤§äº1ï¼Œ é‚£å°±è¯´æ˜ å¤šä½™çš„Podä»è¿™ä¸ªNodeåˆ é™¤æ‰ æ­£å¥½åªæœ‰ä¸€ä¸ªè¿™ç§Podï¼Œ è¯´æ˜è¿™ä¸ªèŠ‚ç‚¹æ˜¯æ­£å¸¸çš„ ","date":"2023-05-20","objectID":"/daemonset/:1:0","tags":["k8s"],"title":"Kubernets-DaemonSet","uri":"/daemonset/"},{"categories":["æ–‡æ¡£"],"content":"nodeAffinity apiVersion: v1 kind: Pod metadata: name: with-node-affinity spec: affinity: nodeAffinity: requiredDuringSchedulingIgnoredDuringExecution: nodeSelectorTerms: - matchExpressions: - key: metadata.name operator: In values: - node-geektime ","date":"2023-05-20","objectID":"/daemonset/:2:0","tags":["k8s"],"title":"Kubernets-DaemonSet","uri":"/daemonset/"},{"categories":["æ–‡æ¡£"],"content":"å«ä¹‰ requiredDuringSchedulingIgnoredDuringExecutionï¼šè¿™ä¸ªnodeAffunuty å¿…é¡»åœ¨æ¯ä¸ªè°ƒåº¦çš„æ—¶å€™ç»™äºˆè€ƒè™‘ï¼Œ åŒæ—¶ æ„å‘³ç€å¯ä»¥è®¾ç½®åœ¨æŸä¸ªæƒ…å†µä¸‹ä¸è€ƒè™‘è¿™ä¸ªnodeAffinity è¿™ä¸ªPod, å°†æ¥åªå…è®¸å…è®¸åœ¨â€œmetadata.nameæ˜¯â€œnode-geektimeâ€çš„èŠ‚ç‚¹ä¸Š Daemonset Controller ä¼šåœ¨åˆ›å»ºPodçš„æ—¶å€™ï¼Œ è‡ªåŠ¨åœ¨è¿™ä¸ªPodçš„APIå¯¹è±¡é‡Œï¼Œ åŠ ä¸Šè¿™æ ·ä¸€ä¸ªnodeAffinityå®šä¹‰ ","date":"2023-05-20","objectID":"/daemonset/:2:1","tags":["k8s"],"title":"Kubernets-DaemonSet","uri":"/daemonset/"},{"categories":["æ–‡æ¡£"],"content":"tolerations è¿™ä¸ªå­—æ®µï¼š æ„å‘³ç€è¿™ä¸ªPodï¼Œ ä¼šâ€œå®¹å¿â€ï¼ˆTolerationï¼‰æŸäº›Nodeçš„æ±¡ç‚¹ï¼ˆTaintï¼‰ apiVersion: v1 kind: Pod metadata: name: with-toleration spec: tolerations: - key: node.kubernetes.io/unschedulable operator: Exists effect: NoSchedule ","date":"2023-05-20","objectID":"/daemonset/:3:0","tags":["k8s"],"title":"Kubernets-DaemonSet","uri":"/daemonset/"},{"categories":["æ–‡æ¡£"],"content":"å«ä¹‰ tolerationï¼š â€œå®¹å¿â€æ‰€æœ‰è¢«æ ‡è®°ä¸ºunschedulableâ€œæ±¡ç‚¹â€çš„Nodeï¼Œ â€œå®¹å¿â€çš„æ•ˆæœæ˜¯å…è®¸è°ƒåº¦ åœ¨ Kubernetes é¡¹ç›®ä¸­ï¼Œå½“ä¸€ä¸ªèŠ‚ç‚¹çš„ç½‘ç»œæ’ä»¶å°šæœªå®‰è£…æ—¶ï¼Œè¿™ä¸ªèŠ‚ç‚¹å°±ä¼šè¢«è‡ªåŠ¨åŠ ä¸Šåä¸ºnode.kubernetes.io/network-unavailableçš„â€œæ±¡ç‚¹â€ã€‚ è€Œé€šè¿‡è¿™æ ·ä¸€ä¸ª Tolerationï¼Œè°ƒåº¦å™¨åœ¨è°ƒåº¦è¿™ä¸ª Pod çš„æ—¶å€™ï¼Œå°±ä¼šå¿½ç•¥å½“å‰èŠ‚ç‚¹ä¸Šçš„â€œæ±¡ç‚¹â€ï¼Œä»è€ŒæˆåŠŸåœ°å°†ç½‘ç»œæ’ä»¶çš„ Agent ç»„ä»¶è°ƒåº¦åˆ°è¿™å°æœºå™¨ä¸Šå¯åŠ¨èµ·æ¥ã€‚ ","date":"2023-05-20","objectID":"/daemonset/:3:1","tags":["k8s"],"title":"Kubernets-DaemonSet","uri":"/daemonset/"},{"categories":["æ–‡æ¡£"],"content":"Deployment ","date":"2023-05-20","objectID":"/deployment/:0:0","tags":["k8s"],"title":"Kubernets-Deployment","uri":"/deployment/"},{"categories":["æ–‡æ¡£"],"content":"Deployment Pod çš„ â€œæ°´å¹³æ‰©å±•ã€æ”¶ç¼©â€ ","date":"2023-05-20","objectID":"/deployment/:0:1","tags":["k8s"],"title":"Kubernets-Deployment","uri":"/deployment/"},{"categories":["æ–‡æ¡£"],"content":"ReplicaSet apiVersion: apps/v1 kind: ReplicaSet metadata: name: nginx-set labels: app: nginx spec: replicas: 3 selector: matchLabels: app: nginx template: metadata: labels: app: nginx spec: containers: - name: nginx image: nginx:1.7.9 ä¸€ä¸ªReplicaSetå¯¹è±¡ï¼Œ å…¶å®å°±æ˜¯ç”±å‰¯æœ¬æ•°ç›®çš„å®šä¹‰å’Œä¸€ä¸ªPodæ¨¡æ¿ç»„åˆï¼Œ æ›´é‡è¦çš„æ˜¯ Deploymentæ§åˆ¶å™¨å®é™…æ“çºµçš„ï¼Œ æ­£æ˜¯ReplicasSetå¯¹è±¡ï¼Œ è€Œä¸æ˜¯Podå¯¹è±¡ ","date":"2023-05-20","objectID":"/deployment/:0:2","tags":["k8s"],"title":"Kubernets-Deployment","uri":"/deployment/"},{"categories":["æ–‡æ¡£"],"content":"Deployment apiVersion: apps/v1 kind: Deployment metadata: name: nginx-deployment labels: app: nginx spec: replicas: 3 selector: matchLabels: app: nginx template: metadata: labels: app: nginx spec: containers: - name: nginx image: nginx:1.7.9 ports: - containerPort: 80 ","date":"2023-05-20","objectID":"/deployment/:0:3","tags":["k8s"],"title":"Kubernets-Deployment","uri":"/deployment/"},{"categories":["æ–‡æ¡£"],"content":"Deployment ã€ ReplicaSetã€ Podçš„å…³ç³» ","date":"2023-05-20","objectID":"/deployment/:0:4","tags":["k8s"],"title":"Kubernets-Deployment","uri":"/deployment/"},{"categories":["æ–‡æ¡£"],"content":"æ°´å¹³æ‰©å±•ã€æ”¶ç¼©çš„æ“ä½œ $ kubectl scale deployment nginx-deployment --replicas=4 deployment.apps/nginx-deployment scaled ","date":"2023-05-20","objectID":"/deployment/:0:5","tags":["k8s"],"title":"Kubernets-Deployment","uri":"/deployment/"},{"categories":["æ–‡æ¡£"],"content":"æ»šåŠ¨æ›´æ–° $ kubectl create -f nginx-deployment.yaml --record -record å‚æ•°ï¼š è®°å½•æ¯æ¬¡æ“ä½œçš„æ‰§è¡Œå‘½ä»¤ï¼Œ æ–¹ä¾¿åé¢æŸ¥çœ‹ æ£€æŸ¥ä¸€ä¸‹ nginx-deployment åˆ›å»ºåçš„çŠ¶æ€ä¿¡æ¯ $ kubectl get deployments NAME DESIRED CURRENT UP-TO-DATE AVAILABLE AGE nginx-deployment 3 0 0 0 1s çŠ¶æ€å«ä¹‰ DESIERDï¼šç”¨æˆ·æœŸæœ›çš„Pod å‰¯æœ¬ä¸ªæ•° CURRENTï¼šå½“å‰å¤„äºRunningçŠ¶æ€çš„Podçš„ä¸ªæ•° UP-TO-DATEï¼š å½“å‰å¤„äºæœ€æ–°ç‰ˆçš„Podçš„ä¸ªæ•°ï¼Œ ï¼ˆPodçš„Specéƒ¨åˆ†ä¸Deploymentçš„Podæ¨¡æ¿çš„å®šä¹‰çš„ä¸€è‡´ï¼‰ AVALABLEï¼š å½“å‰å·²ç»å¯ç”¨çš„Podçš„ä¸ªæ•°ï¼Œ æ—¢æ˜¯ Running çŠ¶æ€ï¼Œåˆæ˜¯æœ€æ–°ç‰ˆæœ¬ï¼Œå¹¶ä¸”å·²ç»å¤„äº Readyï¼ˆå¥åº·æ£€æŸ¥æ­£ç¡®ï¼‰çŠ¶æ€çš„ Pod çš„ä¸ªæ•°ã€‚ æŸ¥çœ‹Deploymentå¯¹è±¡çš„çŠ¶æ€å˜åŒ–kubectl rollout status $ kubectl rollout status deployment/nginx-deployment Waiting for rollout to finish: 2 out of 3 new replicas have been updated... deployment.apps/nginx-deployment successfully rolled out ","date":"2023-05-20","objectID":"/deployment/:0:6","tags":["k8s"],"title":"Kubernets-Deployment","uri":"/deployment/"},{"categories":["æ–‡æ¡£"],"content":"Deploymentå¯¹åº”è¿›è¡Œç‰ˆæœ¬æ§åˆ¶çš„å…·ä½“åŸç† è¿™ä¸ªé•œåƒåå­—ä¿®æ”¹æˆä¸ºäº†ä¸€ä¸ªé”™è¯¯çš„åå­—ï¼Œæ¯”å¦‚ï¼šnginx:1.91ã€‚è¿™æ ·ï¼Œè¿™ä¸ª Deployment å°±ä¼šå‡ºç°ä¸€ä¸ªå‡çº§å¤±è´¥çš„ç‰ˆæœ¬ã€‚ $ kubectl set image deployment/nginx-deployment nginx=nginx:1.91 deployment.extensions/nginx-deployment image updated ç”±äºè¿™ä¸ª nginx:1.91 é•œåƒåœ¨ Docker Hub ä¸­å¹¶ä¸å­˜åœ¨ï¼Œæ‰€ä»¥è¿™ä¸ª Deployment çš„â€œæ»šåŠ¨æ›´æ–°â€è¢«è§¦å‘åï¼Œä¼šç«‹åˆ»æŠ¥é”™å¹¶åœæ­¢ã€‚ è¿™æ—¶ï¼Œæˆ‘ä»¬æ¥æ£€æŸ¥ä¸€ä¸‹ ReplicaSet çš„çŠ¶æ€ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š $ kubectl get rs NAME DESIRED CURRENT READY AGE nginx-deployment-1764197365 2 2 2 24s nginx-deployment-3167673210 0 0 0 35s nginx-deployment-2156724341 2 2 0 7s å›æ»šåˆ°ä¸€èµ·çš„æ—§ç‰ˆæœ¬ $ kubectl rollout undo deployment/nginx-deployment deployment.extensions/nginx-deployment è¦ä½¿ç”¨ kubectl rollout history å‘½ä»¤ï¼ŒæŸ¥çœ‹æ¯æ¬¡ Deployment å˜æ›´å¯¹åº”çš„ç‰ˆæœ¬ $ kubectl rollout history deployment/nginx-deployment deployments \"nginx-deployment\" REVISION CHANGE-CAUSE 1 kubectl create -f nginx-deployment.yaml --record 2 kubectl edit deployment/nginx-deployment 3 kubectl set image deployment/nginx-deployment nginx=nginx:1.91 æŸ¥çœ‹æ¯ä¸ªç‰ˆæœ¬å¯¹åº”çš„Deploymentçš„APIå¯¹è±¡çš„ç»†èŠ‚ $ kubectl rollout history deployment/nginx-deployment --revision=2 å¯ä»¥åœ¨kubectl roolout undo å‘½ä»¤åŠ ä¸Šå›æ»šçš„ç‰ˆæœ¬å·ï¼Œ æŒ‡å®šç‰ˆæœ¬å›æ»š $ kubectl rollout undo deployment/nginx-deployment --to-revision=2 deployment.extensions/nginx-deployment å¯¹Deploymentçš„å¤šæ¬¡æ›´æ–°æ“ä½œï¼Œ æœ€ååªç”Ÿæˆä¸€ä¸ªReplicaSetï¼Œ $ kubectl rollout pause deployment/nginx-deployment deployment.extensions/nginx-deployment paused æ˜¯Deploymentè¿›å…¥ä¸€ä¸ªæš‚å®šçŠ¶æ€ï¼Œ å¯ä»¥éšæ„ä½¿ç”¨ kubectl edit æˆ–è€… kubectl set image æŒ‡ä»¤ï¼Œä¿®æ”¹è¿™ä¸ª Deployment çš„å†…å®¹äº†ã€‚ æ“ä½œå®Œæˆä¹‹åå°†Deployment æ¢å¤å›æ¥ $ kubectl rollout resume deploy/nginx-deployment deployment.extensions/nginx-deployment resumed ","date":"2023-05-20","objectID":"/deployment/:0:7","tags":["k8s"],"title":"Kubernets-Deployment","uri":"/deployment/"},{"categories":["æ–‡æ¡£"],"content":"å¦‚ä½•æ§åˆ¶â€œå†å²çš„â€ ReplicaSetæ•°é‡ Deployment å¯¹è±¡æœ‰ä¸€ä¸ªå­—æ®µï¼Œå«ä½œ spec.revisionHistoryLimitï¼Œå°±æ˜¯ Kubernetes ä¸º Deployment ä¿ç•™çš„â€œå†å²ç‰ˆæœ¬â€ä¸ªæ•°ã€‚æ‰€ä»¥ï¼Œå¦‚æœæŠŠå®ƒè®¾ç½®ä¸º 0ï¼Œä½ å°±å†ä¹Ÿä¸èƒ½åšå›æ»šæ“ä½œäº† ","date":"2023-05-20","objectID":"/deployment/:0:8","tags":["k8s"],"title":"Kubernets-Deployment","uri":"/deployment/"},{"categories":["æ–‡æ¡£"],"content":"pod ","date":"2023-05-17","objectID":"/pod/:0:0","tags":["k8s"],"title":"Kubernets-Pod","uri":"/pod/"},{"categories":["æ–‡æ¡£"],"content":"pod çš„å±æ€§ å‡¡æ˜¯è°ƒåº¦ã€ç½‘ç»œã€å­˜å‚¨ã€ä»¥åŠå®‰å…¨ç›¸å…³çš„å±æ€§ï¼Œ éƒ½æ˜¯podçº§åˆ«çš„ ","date":"2023-05-17","objectID":"/pod/:0:1","tags":["k8s"],"title":"Kubernets-Pod","uri":"/pod/"},{"categories":["æ–‡æ¡£"],"content":"NodeSelector ç”¨æˆ·å°†Pod ä¸Nodeè¿›è¡Œç»‘å®šçš„å­—æ®µ apiVersion: v1 kind: Pod ... spec: nodeSelector: disktype: ssd ","date":"2023-05-17","objectID":"/pod/:0:2","tags":["k8s"],"title":"Kubernets-Pod","uri":"/pod/"},{"categories":["æ–‡æ¡£"],"content":"NodeName ä¸€æ—¦pod è¿™ä¸ªå­—æ®µè¢«èµ‹å€¼ï¼Œ Kubernetesé¡¹ç›®å°±ä¼šè¢«è®¤ä¸ºè¿™ä¸ªPOdä»¥åŠç»è¿‡è°ƒåº¦ï¼Œ è°ƒåº¦çš„ç»“æœå°±æ˜¯å¤åˆ¶çš„èŠ‚ç‚¹åå­— ","date":"2023-05-17","objectID":"/pod/:0:3","tags":["k8s"],"title":"Kubernets-Pod","uri":"/pod/"},{"categories":["æ–‡æ¡£"],"content":"HostAliases å®šä¹‰äº†Podçš„Hostsæ–‡ä»¶**ï¼ˆæ¯”å¦‚ /etc/hostsï¼‰é‡Œçš„å†…å®¹**ï¼Œç”¨æ³•å¦‚ä¸‹ï¼š apiVersion: v1 kind: Pod ... spec: hostAliases: - ip: \"10.1.2.3\" hostnames: - \"foo.remote\" - \"bar.remote\" ... podå¯åŠ¨ä¹‹åã€ /etc/hosts æ–‡ä»¶å†…å®¹å¦‚ä¸‹ cat /etc/hosts # Kubernetes-managed hosts file. 127.0.0.1 localhost ... 10.244.135.10 hostaliases-pod 10.1.2.3 foo.remote 10.1.2.3 bar.remote ","date":"2023-05-17","objectID":"/pod/:0:4","tags":["k8s"],"title":"Kubernets-Pod","uri":"/pod/"},{"categories":["æ–‡æ¡£"],"content":"shareProcessNamespace=trueï¼š apiVersion: v1 kind: Pod metadata: name: nginx spec: shareProcessNamespace: true containers: - name: nginx image: nginx - name: shell image: busybox stdin: true tty: true pod çš„å®¹å™¨å…±äº« PID Namespace ","date":"2023-05-17","objectID":"/pod/:0:5","tags":["k8s"],"title":"Kubernets-Pod","uri":"/pod/"},{"categories":["æ–‡æ¡£"],"content":"ImagePullPolicy é»˜è®¤æ˜¯Always ï¼Œæ¯æ¬¡éƒ½å‡ºé‡æ–°æ‹‰å– Neverï¼š æ„å‘³ç€Podæ°¸è¿œä¸ä¼šä¸»åŠ¨æ‹‰å–è¿™ä¸ªé•œåƒï¼Œ IfNotPresentï¼š åªåœ¨å®¿ä¸»æœºä¸å­˜åœ¨è¿™ä¸ªé•œåƒæ—¶æ‰æ‹‰å– ","date":"2023-05-17","objectID":"/pod/:0:6","tags":["k8s"],"title":"Kubernets-Pod","uri":"/pod/"},{"categories":["æ–‡æ¡£"],"content":"lifecycle åœ¨å®¹å™¨å‘ç”Ÿå˜åŒ–çš„æ—¶å€™è§¦å‘ä¸€ç³»åˆ—â€œé’©å­â€ apiVersion: v1 kind: Pod metadata: name: lifecycle-demo spec: containers: - name: lifecycle-demo-container image: nginx lifecycle: postStart: exec: command: [\"/bin/sh\", \"-c\", \"echo Hello from the postStart handler \u003e /usr/share/message\"] preStop: exec: command: [\"/usr/sbin/nginx\",\"-s\",\"quit\"] ","date":"2023-05-17","objectID":"/pod/:0:7","tags":["k8s"],"title":"Kubernets-Pod","uri":"/pod/"},{"categories":["æ–‡æ¡£"],"content":"podå¯¹è±¡åœ¨kubernetesä¸­çš„ç”Ÿå‘½å‘¨æœŸ Pendingï¼šè¿™ä¸ªçŠ¶æ€æ„å‘³ç€ï¼Œ Podçš„Yaml æ–‡ä»¶ä»¥åŠæäº¤ç»™äº†kubernetesï¼Œ APIå¯¹è±¡å·²ç»è¢«åˆ›å»ºå¹¶ä¿å­˜åœ¨Etcd å½“ä¸­ï¼Œ ä½†æ˜¯ï¼Œ è¿™ä¸ªPod é‡Œæœ‰äº›å®¹å™¨å› ä¸ºæŸäº›åŸå› ä¸èƒ½è¢«é¡ºåˆ©åˆ›å»ºï¼Œ æ¯”å¦‚ï¼Œ è°ƒåº¦ä¸æˆåŠŸ Runningï¼š Podå·²ç»è°ƒåº¦æˆåŠŸï¼Œ è·Ÿä¸€ä¸ªå…·ä½“çš„èŠ‚ç‚¹ç»‘å®šï¼Œå®ƒåŒ…å«çš„å®¹å™¨å·²ç»è¢«åˆ›å»ºï¼Œå¹¶ä¸”è‡³å°‘æœ‰ä¸€ä¸ªå·²ç»è¿è¡ŒæˆåŠŸ Succeededï¼š Podçš„æ‰€æœ‰å®¹å™¨éƒ½è¿è¡ŒæˆåŠŸï¼Œ å¹¶ä¸”å·²ç»é€€å‡ºï¼Œ Failedï¼š è¿™ä¸ªçŠ¶æ€ä¸‹ï¼Œ Pod é‡Œè‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨ä»¥ä¸æ­£å¸¸çš„çŠ¶æ€é€€å‡ºï¼Œ è¿™ä¸ªç –å¤´çš„å‡ºç°ï¼Œ æ„å‘³ç€ä½ æƒ³åŠæ³•Debugè¿™ä¸ªå®¹å™¨çš„åº”ç”¨ï¼Œ unknownï¼š å¼‚å¸¸çŠ¶æ€ï¼Œ æ„å‘³ç€Podçš„çŠ¶æ€ä¸èƒ½æŒç»­çš„è¢«kubeletæ±‡æŠ¥ç»™kube-apiserverï¼Œ å¾ˆæœ‰å¯èƒ½æ˜¯ä¸»ä»èŠ‚ç‚¹çš„é€šä¿¡å‡ºç°äº†é—®é¢˜ ","date":"2023-05-17","objectID":"/pod/:0:8","tags":["k8s"],"title":"Kubernets-Pod","uri":"/pod/"},{"categories":["æ–‡æ¡£"],"content":"projected Volume å››ç§ Secret ConfigMap Downward API ServiceAccountToken ","date":"2023-05-17","objectID":"/pod/:0:9","tags":["k8s"],"title":"Kubernets-Pod","uri":"/pod/"},{"categories":["æ–‡æ¡£"],"content":"secret æŠŠPodæƒ³è¦è®¿é—®çš„åŠ å¯†æ•°æ®å­˜åœ¨Etcd ä¸­ï¼Œ å¯ä»¥é€šè¿‡Podçš„å®¹å™¨æŒ‚è½½Volumeçš„æ–¹å¼ï¼Œ è®¿é—®è¿™äº›Secret ä¿å­˜çš„ä¿¡æ¯ ","date":"2023-05-17","objectID":"/pod/:0:10","tags":["k8s"],"title":"Kubernets-Pod","uri":"/pod/"},{"categories":["æ–‡æ¡£"],"content":"configmap ä¿å­˜çš„æ˜¯ä¸éœ€è¦åŠ å¯†çš„ï¼Œ åº”ç”¨æ‰€éœ€çš„é…ç½®ä¿¡æ¯ ","date":"2023-05-17","objectID":"/pod/:0:11","tags":["k8s"],"title":"Kubernets-Pod","uri":"/pod/"},{"categories":["æ–‡æ¡£"],"content":"Downward API è®©Podé‡Œçš„å®¹å™¨èƒ½å¤Ÿç›´æ¥è·å–åˆ°è¿™ä¸ªPod APIå¯¹è±¡æœ¬èº«çš„ä¿¡æ¯ apiVersion: v1 kind: Pod metadata: name: test-downwardapi-volume labels: zone: us-est-coast cluster: test-cluster1 rack: rack-22 spec: containers: - name: client-container image: k8s.gcr.io/busybox command: [\"sh\", \"-c\"] args: - while true; do if [[ -e /etc/podinfo/labels ]]; then echo -en '\\n\\n'; cat /etc/podinfo/labels; fi; sleep 5; done; volumeMounts: - name: podinfo mountPath: /etc/podinfo readOnly: false volumes: - name: podinfo projected: sources: - downwardAPI: items: - path: \"labels\" fieldRef: fieldPath: metadata.labels æ”¯æŒçš„å­—æ®µ spec.nodeName - å®¿ä¸»æœºåå­— status.hostIP - å®¿ä¸»æœº IP metadata.name - Pod çš„åå­— metadata.namespace - Pod çš„ Namespace status.podIP - Pod çš„ IP ","date":"2023-05-17","objectID":"/pod/:0:12","tags":["k8s"],"title":"Kubernets-Pod","uri":"/pod/"},{"categories":["æ–‡æ¡£"],"content":"Service Account Service Account å¯¹è±¡çš„ä½œç”¨ï¼Œå°±æ˜¯ Kubernetes ç³»ç»Ÿå†…ç½®çš„ä¸€ç§â€œæœåŠ¡è´¦æˆ·â€ï¼Œå®ƒæ˜¯ Kubernetes è¿›è¡Œæƒé™åˆ†é…çš„å¯¹è±¡ Service Account çš„æˆæƒä¿¡æ¯å’Œæ–‡ä»¶ï¼Œå®é™…ä¸Šä¿å­˜åœ¨å®ƒæ‰€ç»‘å®šçš„ä¸€ä¸ªç‰¹æ®Šçš„ Secret å¯¹è±¡é‡Œçš„ã€‚è¿™ä¸ªç‰¹æ®Šçš„ Secret å¯¹è±¡ï¼Œå°±å«ä½œServiceAccountToken è¿™ç§æŠŠ Kubernetes å®¢æˆ·ç«¯ä»¥å®¹å™¨çš„æ–¹å¼è¿è¡Œåœ¨é›†ç¾¤é‡Œï¼Œç„¶åä½¿ç”¨ default Service Account è‡ªåŠ¨æˆæƒçš„æ–¹å¼ï¼Œè¢«ç§°ä½œâ€œInClusterConfigâ€ï¼Œä¹Ÿæ˜¯æˆ‘æœ€æ¨èçš„è¿›è¡Œ Kubernetes API ç¼–ç¨‹çš„æˆæƒæ–¹å¼ã€‚ ","date":"2023-05-17","objectID":"/pod/:0:13","tags":["k8s"],"title":"Kubernets-Pod","uri":"/pod/"},{"categories":["æ–‡æ¡£"],"content":"å®¹å™¨çš„å¥åº·æ£€æŸ¥å’Œæ¢å¤æœºåˆ¶ å®¹å™¨å®šä¹‰ä¸€ä¸ªç›‘æ§æ£€æŸ¥â€œæ¢é’ˆâ€ï¼Œ kubeletå°±ä¼šæ ¹æ®è¿™ä¸ªProbeçš„è¿”å›å€¼å†³å®šè¿™ä¸ªå®¹å™¨çš„çŠ¶æ€ï¼Œè€Œä¸æ˜¯ç›´æ¥ä»¥å®¹å™¨è¿›è¡Œæ˜¯å¦è¿è¡Œï¼ˆæ¥è‡ª Docker è¿”å›çš„ä¿¡æ¯ï¼‰ä½œä¸ºä¾æ®ã€‚è¿™ç§æœºåˆ¶ï¼Œæ˜¯ç”Ÿäº§ç¯å¢ƒä¸­ä¿è¯åº”ç”¨å¥åº·å­˜æ´»çš„é‡è¦æ‰‹æ®µã€‚ apiVersion: v1 kind: Pod metadata: labels: test: liveness name: test-liveness-exec spec: containers: - name: liveness image: busybox args: - /bin/sh - -c - touch /tmp/healthy; sleep 30; rm -rf /tmp/healthy; sleep 600 livenessProbe: exec: command: - cat - /tmp/healthy initialDelaySeconds: 5 ## åœ¨å®¹å™¨å¯åŠ¨å5såå¼€å§‹æ‰§è¡Œ periodSeconds: 5 ## æ¯5sæ‰§è¡Œä¸€æ¬¡ Kubernetes é‡Œçš„Pod æ¢å¤æœºåˆ¶ï¼Œä¹Ÿå« restartPolicy ","date":"2023-05-17","objectID":"/pod/:0:14","tags":["k8s"],"title":"Kubernets-Pod","uri":"/pod/"},{"categories":["æ–‡æ¡£"],"content":"åŸºæœ¬åŸç† åªæœ‰Pod çš„ restartPolicy æŒ‡å®šçš„ç­–ç•¥å…è®¸é‡å¯çš„å®¹å™¨ï¼Œ é‚£ä¹ˆè¿™ä¸ªPodå°±ä¼šä¿æŒRunningçŠ¶æ€ï¼Œå¹¶è¿›è¡Œå®¹å™¨é‡å¯ å¯¹äºåŒ…å«å¤šä¸ªå®¹å™¨çš„Podï¼Œåªæœ‰å®ƒé‡Œé¢æ‰€æœ‰çš„å®¹å™¨éƒ½è¿›å…¥å¼‚å¸¸çŠ¶æ€åï¼ŒPod æ‰ä¼šè¿›å…¥ Failed çŠ¶æ€ ã€‚åœ¨æ­¤ä¹‹å‰ï¼ŒPod éƒ½æ˜¯ Running çŠ¶æ€ã€‚æ­¤æ—¶ï¼ŒPod çš„ READY å­—æ®µä¼šæ˜¾ç¤ºæ­£å¸¸å®¹å™¨çš„ä¸ªæ•° ","date":"2023-05-17","objectID":"/pod/:0:15","tags":["k8s"],"title":"Kubernets-Pod","uri":"/pod/"},{"categories":["æ–‡æ¡£"],"content":"PodPreset PodPreseté‡Œå®šä¹‰çš„å†…å®¹ï¼Œ åªä¼šåœ¨Pod APIå¯¹è±¡è¢«åˆ›å»ºä¹‹å‰è¿½åŠ è¿™ä¸ªå¯¹è±¡æœ¬èº«ä¸Šï¼Œ è€Œä¸ä¼šå½±å“çƒ­æ²³Podçš„æ§åˆ¶çš„å®šä¹‰ PodPreset è¿™æ ·ä¸“é—¨ç”¨æ¥å¯¹ Pod è¿›è¡Œæ‰¹é‡åŒ–ã€è‡ªåŠ¨åŒ–ä¿®æ”¹çš„å·¥å…·å¯¹è±¡ ","date":"2023-05-17","objectID":"/pod/:0:16","tags":["k8s"],"title":"Kubernets-Pod","uri":"/pod/"}]